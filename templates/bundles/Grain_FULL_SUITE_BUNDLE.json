[
  {
    "name": "Grain Client Reporting Dashboard v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-fd1ijpmos",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 8 * * 1"
              }
            ]
          }
        },
        "id": "weekly-report",
        "name": "Weekly Report",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          200,
          400
        ],
        "typeVersion": 1.1
      },
      {
        "parameters": {},
        "id": "webhook-report",
        "name": "Manual Report",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          200,
          600
        ],
        "webhookId": "generate-report"
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Clients"
          },
          "options": {}
        },
        "id": "get-clients",
        "name": "Get Clients",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          400,
          400
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "method": "GET",
          "url": "=https://www.googleapis.com/analytics/v4/reports:batchGet",
          "authentication": "oAuth2",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"reportRequests\": [{\n    \"viewId\": \"{{ $json.ga4_property_id }}\",\n    \"dateRanges\": [{ \"startDate\": \"7daysAgo\", \"endDate\": \"today\" }],\n    \"metrics\": [\n      { \"expression\": \"ga:sessions\" },\n      { \"expression\": \"ga:users\" },\n      { \"expression\": \"ga:pageviews\" },\n      { \"expression\": \"ga:bounceRate\" }\n    ]\n  }]\n}"
        },
        "id": "get-ga4-data",
        "name": "Get GA4 Data",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          600,
          400
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "method": "GET",
          "url": "=https://graph.facebook.com/v18.0/act_{{ $json.fb_ad_account_id }}/insights",
          "authentication": "oAuth2",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "date_preset",
                "value": "last_7d"
              },
              {
                "name": "fields",
                "value": "spend,impressions,clicks,cpc,ctr,conversions"
              }
            ]
          }
        },
        "id": "get-meta-ads",
        "name": "Get Meta Ads",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          600,
          600
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "jsCode": "const client = $input.item.json;\nconst ga4 = $('Get GA4 Data').first()?.json?.reports?.[0]?.data?.totals?.[0]?.values || [];\nconst metaAds = $('Get Meta Ads').first()?.json?.data?.[0] || {};\n\nreturn {\n  json: {\n    client_name: client.name,\n    client_email: client.email,\n    period: 'Last 7 Days',\n    analytics: {\n      sessions: parseInt(ga4[0]) || 0,\n      users: parseInt(ga4[1]) || 0,\n      pageviews: parseInt(ga4[2]) || 0,\n      bounce_rate: parseFloat(ga4[3]) || 0\n    },\n    advertising: {\n      spend: parseFloat(metaAds.spend) || 0,\n      impressions: parseInt(metaAds.impressions) || 0,\n      clicks: parseInt(metaAds.clicks) || 0,\n      cpc: parseFloat(metaAds.cpc) || 0,\n      ctr: parseFloat(metaAds.ctr) || 0\n    }\n  }\n};"
        },
        "id": "merge-data",
        "name": "Merge Data",
        "type": "n8n-nodes-base.code",
        "position": [
          800,
          500
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "model": "gpt-4o-mini",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Dijital pazarlama uzmanÄ±sÄ±n. MÃ¼ÅŸteri performans verisini analiz et ve kÄ±sa Ã¶zet yaz. Ä°yi, kÃ¶tÃ¼ ve geliÅŸtirme Ã¶nerisi iÃ§ersin. Max 200 kelime."
              },
              {
                "role": "user",
                "content": "=Client: {{ $json.client_name }}\nPeriod: {{ $json.period }}\n\nAnalytics:\n- Sessions: {{ $json.analytics.sessions }}\n- Users: {{ $json.analytics.users }}\n- Bounce: {{ $json.analytics.bounce_rate }}%\n\nAds:\n- Spend: ${{ $json.advertising.spend }}\n- Clicks: {{ $json.advertising.clicks }}\n- CTR: {{ $json.advertising.ctr }}%"
              }
            ]
          }
        },
        "id": "ai-insights",
        "name": "AI Insights",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          1000,
          500
        ],
        "typeVersion": 1.4
      },
      {
        "parameters": {
          "sendTo": "={{ $json.client_email }}",
          "subject": "=HaftalÄ±k Performans Raporu - {{ $json.client_name }}",
          "message": "=Merhaba,\n\n{{ $json.period }} dÃ¶nemi performans Ã¶zetiniz:\n\nðŸ“Š *Web Sitesi*\nâ€¢ Oturum: {{ $json.analytics.sessions }}\nâ€¢ KullanÄ±cÄ±: {{ $json.analytics.users }}\nâ€¢ Sayfa GÃ¶rÃ¼ntÃ¼leme: {{ $json.analytics.pageviews }}\n\nðŸ’° *Reklamlar*\nâ€¢ Harcama: ${{ $json.advertising.spend }}\nâ€¢ TÄ±klama: {{ $json.advertising.clicks }}\nâ€¢ CTR: {{ $json.advertising.ctr }}%\n\nðŸ’¡ *AI DeÄŸerlendirmesi*\n{{ $('AI Insights').first().json.message.content }}\n\nSorularÄ±nÄ±z iÃ§in bize ulaÅŸÄ±n.\n\nSaygÄ±larÄ±mÄ±zla",
          "options": {}
        },
        "id": "send-report",
        "name": "Send Report",
        "type": "n8n-nodes-base.gmail",
        "position": [
          1200,
          500
        ],
        "typeVersion": 2.1
      },
      {
        "parameters": {
          "channel": "#client-reports",
          "text": "=ðŸ“Š *Rapor GÃ¶nderildi*\n\nClient: {{ $json.client_name }}\nPeriod: {{ $json.period }}\n\nKey Metrics:\nâ€¢ Sessions: {{ $json.analytics.sessions }}\nâ€¢ Ad Spend: ${{ $json.advertising.spend }}\nâ€¢ CTR: {{ $json.advertising.ctr }}%",
          "otherOptions": {}
        },
        "id": "notify-team",
        "name": "Notify Team",
        "type": "n8n-nodes-base.slack",
        "position": [
          1200,
          700
        ],
        "typeVersion": 2.1
      }
    ],
    "connections": {
      "Weekly Report": {
        "main": [
          [
            {
              "node": "Get Clients",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Manual Report": {
        "main": [
          [
            {
              "node": "Get Clients",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Clients": {
        "main": [
          [
            {
              "node": "Get GA4 Data",
              "type": "main",
              "index": 0
            },
            {
              "node": "Get Meta Ads",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get GA4 Data": {
        "main": [
          [
            {
              "node": "Merge Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Meta Ads": {
        "main": [
          [
            {
              "node": "Merge Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge Data": {
        "main": [
          [
            {
              "node": "AI Insights",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Insights": {
        "main": [
          [
            {
              "node": "Send Report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send Report": {
        "main": [
          [
            {
              "node": "Notify Team",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "tags": [
      {
        "name": "agency"
      },
      {
        "name": "reporting"
      },
      {
        "name": "analytics"
      }
    ]
  },
  {
    "name": "Grain Lead Conversion Funnel v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-237j4v2o4",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "new-lead",
          "options": {}
        },
        "id": "webhook-lead",
        "name": "New Lead Trigger",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          300
        ],
        "webhookId": "grain-lead-funnel"
      },
      {
        "parameters": {
          "jsCode": "const lead = $input.item.json;\n// Mock Enrichment (Normally use Clearbit/Apollo API here)\nreturn {\n  json: {\n    ...lead,\n    enrichment: {\n      company_size: \"50-200\",\n      industry: \"SaaS\",\n      tech_stack: [\"HubSpot\", \"Slack\", \"AWS\"],\n      linkedin_url: `https://linkedin.com/in/${lead.email.split('@')[0]}`\n    }\n  }\n};"
        },
        "id": "enrich-lead",
        "name": "Enrich Lead Data",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          450,
          300
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are a Sales Qualification AI. Score this lead (0-100) and segment them (HOT/WARM/COLD) based on their profile.\n\nCriteria:\n- Match Industry: SaaS, Agency (High Score)\n- Tech Stack overlaps (High Score)\n- Size Match\n\nOutput JSON:\n{\n  \"score\": 85,\n  \"segment\": \"HOT\",\n  \"personalization_points\": [\"Uses HubSpot\", \"Scaling phase\"]\n}"
              },
              {
                "role": "user",
                "content": "Lead Profile: {{ JSON.stringify($json) }}"
              }
            ]
          },
          "jsonOutput": true
        },
        "id": "ai-lead-score",
        "name": "AI Score Lead",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          650,
          300
        ]
      },
      {
        "parameters": {
          "dataType": "string",
          "value1": "={{ $json.segment }}",
          "rules": {
            "rules": [
              {
                "value2": "HOT",
                "output": 0
              },
              {
                "value2": "WARM",
                "output": 1
              }
            ]
          },
          "fallbackOutput": 2
        },
        "id": "segment-router",
        "name": "Segment Router",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          900,
          300
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Write a personalized cold email for a HOT lead. Keep it under 150 words. Focus on pain points related to {{ $json.enrichment.industry }}. Use a friendly, professional tone."
              },
              {
                "role": "user",
                "content": "Lead Data: {{ JSON.stringify($json) }}"
              }
            ]
          },
          "jsonOutput": false
        },
        "id": "gen-email-hot",
        "name": "Analyze & Write (Hot)",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          1150,
          150
        ]
      },
      {
        "parameters": {
          "sendTo": "={{ $json.email }}",
          "subject": "Question about your automation stack",
          "message": "={{ $json.message.content }}",
          "options": {}
        },
        "id": "gmail-send",
        "name": "Send Email (Draft)",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          1400,
          150
        ]
      },
      {
        "parameters": {
          "channel": "crm-updates",
          "text": "=ðŸ§Š **Cold Lead Archived**\nLead: {{ $json.email }}\nScore: {{ $json.score }}",
          "otherOptions": {}
        },
        "id": "slack-notify-cold",
        "name": "Notify Archive",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1150,
          500
        ]
      }
    ],
    "connections": {
      "New Lead Trigger": {
        "main": [
          [
            {
              "node": "Enrich Lead Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Enrich Lead Data": {
        "main": [
          [
            {
              "node": "AI Score Lead",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Score Lead": {
        "main": [
          [
            {
              "node": "Segment Router",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Segment Router": {
        "main": [
          [
            {
              "node": "Analyze & Write (Hot)",
              "type": "main",
              "index": 0
            }
          ],
          [],
          [
            {
              "node": "Notify Archive",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Analyze & Write (Hot)": {
        "main": [
          [
            {
              "node": "Send Email (Draft)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Meeting Intelligence Hub v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-yz1mpbvz0",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "meeting-complete",
          "options": {}
        },
        "id": "webhook-meeting",
        "name": "Meeting Completed",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          300
        ],
        "webhookId": "meeting-intelligence"
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Extract from meeting transcript:\n1. Summary (3 sentences)\n2. Action Items (list)\n3. Key Decisions\n4. Follow-up Required (yes/no)\n5. Sentiment (positive/neutral/negative)\n\nOutput JSON."
              },
              {
                "role": "user",
                "content": "Transcript: {{ $json.transcript }}"
              }
            ]
          },
          "jsonOutput": true
        },
        "id": "ai-extract",
        "name": "AI Extract Insights",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          500,
          300
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Meeting_Notes"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "date": "={{ $now.toFormat('yyyy-MM-dd') }}",
              "summary": "={{ $json.summary }}",
              "action_items": "={{ JSON.stringify($json.action_items) }}",
              "sentiment": "={{ $json.sentiment }}"
            }
          }
        },
        "id": "save-notes",
        "name": "Save Meeting Notes",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          750,
          300
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Write a professional follow-up email based on meeting summary and action items. Keep it concise."
              },
              {
                "role": "user",
                "content": "Summary: {{ $json.summary }}\nAction Items: {{ JSON.stringify($json.action_items) }}"
              }
            ]
          },
          "jsonOutput": false
        },
        "id": "ai-followup",
        "name": "Generate Follow-up",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          1000,
          300
        ]
      },
      {
        "parameters": {
          "channel": "sales-meetings",
          "text": "=ðŸ“ **Meeting Summary**\n\n{{ $json.summary }}\n\nðŸ“‹ Action Items:\n{{ $json.action_items.map(a => 'â€¢ ' + a).join('\\n') }}",
          "otherOptions": {}
        },
        "id": "slack-summary",
        "name": "Post to Slack",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1000,
          500
        ]
      }
    ],
    "connections": {
      "Meeting Completed": {
        "main": [
          [
            {
              "node": "AI Extract Insights",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Extract Insights": {
        "main": [
          [
            {
              "node": "Save Meeting Notes",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Save Meeting Notes": {
        "main": [
          [
            {
              "node": "Generate Follow-up",
              "type": "main",
              "index": 0
            },
            {
              "node": "Post to Slack",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Proposal Contract Generator v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-egilytudg",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "generate-proposal",
          "options": {}
        },
        "id": "webhook-proposal",
        "name": "Proposal Request",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          300
        ],
        "webhookId": "proposal-generator"
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Generate a professional business proposal with sections:\n1. Executive Summary\n2. Scope of Work\n3. Deliverables\n4. Timeline\n5. Pricing\n6. Terms & Conditions\n\nOutput in Markdown format."
              },
              {
                "role": "user",
                "content": "Client: {{ $json.client_name }}\nProject: {{ $json.project_description }}\nBudget: {{ $json.budget }}\nTimeline: {{ $json.timeline }}"
              }
            ]
          },
          "jsonOutput": false
        },
        "id": "ai-proposal",
        "name": "AI Generate Proposal",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          500,
          300
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Proposals"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "client": "={{ $json.client_name }}",
              "project": "={{ $json.project_description }}",
              "status": "draft",
              "created_at": "={{ $now.toISO() }}"
            }
          }
        },
        "id": "save-proposal",
        "name": "Save Proposal",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          750,
          300
        ]
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={ \"proposal_markdown\": \"{{ $json.message.content }}\", \"status\": \"generated\" }",
          "options": {}
        },
        "id": "return-proposal",
        "name": "Return Proposal",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1,
        "position": [
          1000,
          300
        ]
      }
    ],
    "connections": {
      "Proposal Request": {
        "main": [
          [
            {
              "node": "AI Generate Proposal",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Generate Proposal": {
        "main": [
          [
            {
              "node": "Save Proposal",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Save Proposal": {
        "main": [
          [
            {
              "node": "Return Proposal",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain RevOps Hub v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-ycxqck6wd",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "hours",
                "hoursInterval": 4
              }
            ]
          }
        },
        "id": "schedule-revops",
        "name": "Every 4 Hours",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.1,
        "position": [
          250,
          300
        ]
      },
      {
        "parameters": {
          "content": "## Mock CRM Data Fetch\nIn production, replace this with a HubSpot/Salesforce 'Get All Deals' node.",
          "height": 100,
          "width": 300
        },
        "id": "crm-note",
        "name": "CRM Stickey Note",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          450,
          200
        ]
      },
      {
        "parameters": {
          "jsCode": "return [\n  { json: { deal_id: \"D-101\", stage: \"negotiation\", amount: 5000, last_activity: \"2025-01-01\", owner: \"John\" } },\n  { json: { deal_id: \"D-102\", stage: \"qualified\", amount: 12000, last_activity: \"2024-12-15\", owner: \"Sarah\" } },\n  { json: { deal_id: \"D-103\", stage: \"proposal\", amount: 3500, last_activity: \"2025-01-05\", owner: \"Mike\" } }\n];"
        },
        "id": "fetch-deals",
        "name": "Fetch CRM Deals",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          450,
          300
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are a Revenue Operations Intelligence AI. Analyze the deal health based on amount, stage, and last activity date (Current Date: {{ $now.toFormat('yyyy-MM-dd') }}).\n\nOutput JSON:\n{\n  \"health_score\": 0-100,\n  \"risk_level\": \"low/medium/high\",\n  \"prediction\": \"close/lost/stalled\",\n  \"reasoning\": \"brief explanation\",\n  \"action_item\": \"suggested next step\"\n}"
              },
              {
                "role": "user",
                "content": "Deal Data: {{ JSON.stringify($json) }}"
              }
            ]
          },
          "jsonOutput": true
        },
        "id": "ai-deal-analysis",
        "name": "AI Analyze Pipeline",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          650,
          300
        ]
      },
      {
        "parameters": {
          "dataType": "string",
          "value1": "={{ $json.risk_level }}",
          "rules": {
            "rules": [
              {
                "value2": "high",
                "output": 0
              },
              {
                "value2": "medium",
                "output": 1
              }
            ]
          },
          "fallbackOutput": 2
        },
        "id": "risk-router",
        "name": "Risk Router",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          900,
          300
        ]
      },
      {
        "parameters": {
          "channel": "sales-alerts",
          "text": "=ðŸš¨ **High Risk Deal Alert**\n\nDeal: {{ $json.deal_id }} ($ {{ $json.amount }})\nOwner: {{ $json.owner }}\nRisk Level: {{ $json.risk_level }}\nReason: {{ $json.reasoning }}\n\nðŸ‘‰ Action: {{ $json.action_item }}",
          "otherOptions": {}
        },
        "id": "slack-alert-high",
        "name": "Alert High Risk",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1150,
          150
        ]
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Weekly_Forecast"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "deal_id": "={{ $json.deal_id }}",
              "forecast_score": "={{ $json.health_score }}",
              "predicted_close": "={{ $json.prediction }}",
              "last_updated": "={{ $now.toISO() }}"
            }
          }
        },
        "id": "update-forecast",
        "name": "Update Forecast Sheet",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          1150,
          400
        ]
      }
    ],
    "connections": {
      "Every 4 Hours": {
        "main": [
          [
            {
              "node": "Fetch CRM Deals",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch CRM Deals": {
        "main": [
          [
            {
              "node": "AI Analyze Pipeline",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Analyze Pipeline": {
        "main": [
          [
            {
              "node": "Risk Router",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Risk Router": {
        "main": [
          [
            {
              "node": "Alert High Risk",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Update Forecast Sheet",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Update Forecast Sheet",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Agentic AI Orchestrator v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-ywrvcgbii",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "orchestrator",
          "options": {}
        },
        "id": "webhook-orch",
        "name": "Orchestrator Trigger",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          400
        ],
        "webhookId": "ai-orchestrator"
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are the MASTER AGENT. Breakdown the user request into sub-tasks for specialized agents.\n\nAvailable Agents:\n1. ENRICHMENT (Data gathering)\n2. SENTIMENT (Analysis)\n3. CONTENT (Writing/Visuals)\n4. CRM (Database update)\n\nReturn JSON Plan:\n{ \"plan\": [ { \"agent\": \"ENRICHMENT\", \"task\": \"...\" }, { \"agent\": \"CONTENT\", \"task\": \"...\" } ] }"
              },
              {
                "role": "user",
                "content": "Goal: {{ $json.body.goal }}"
              }
            ]
          },
          "jsonOutput": true
        },
        "id": "master-planner",
        "name": "Master Planner AI",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          450,
          400
        ]
      },
      {
        "parameters": {
          "fieldToSplitOut": "plan",
          "options": {}
        },
        "id": "split-tasks",
        "name": "Split Tasks",
        "type": "n8n-nodes-base.itemLists",
        "typeVersion": 3,
        "position": [
          650,
          400
        ]
      },
      {
        "parameters": {
          "dataType": "string",
          "value1": "={{ $json.agent }}",
          "rules": {
            "rules": [
              {
                "value2": "ENRICHMENT",
                "output": 0
              },
              {
                "value2": "CONTENT",
                "output": 1
              },
              {
                "value2": "CRM",
                "output": 2
              }
            ]
          },
          "fallbackOutput": 3
        },
        "id": "agent-router",
        "name": "Agent Router",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          850,
          400
        ]
      },
      {
        "parameters": {
          "url": "https://api.apollo.io/v1/enrichment",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Cache-Control",
                "value": "no-cache"
              }
            ]
          },
          "options": {}
        },
        "id": "agent-enrichment",
        "name": "Agent: Enrichment",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1100,
          200
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are the CONTENT AGENT. Execute task: {{ $json.task }}"
              }
            ]
          },
          "jsonOutput": true
        },
        "id": "agent-content",
        "name": "Agent: Content",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          1100,
          400
        ]
      },
      {
        "parameters": {
          "operation": "create",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "CRM_Logs"
          }
        },
        "id": "agent-crm",
        "name": "Agent: CRM",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          1100,
          600
        ]
      },
      {
        "parameters": {
          "channel": "approvals",
          "text": "=ðŸ¤– **Approval Needed**\n\nPlan: {{ $json.plan_summary }}\nTask Output: {{ $json.output }}\n\nReply 'APPROVE' to execute.",
          "otherOptions": {}
        },
        "id": "slack-hitl",
        "name": "HITL Approval",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1400,
          400
        ]
      },
      {
        "parameters": {
          "resource": "channel",
          "operation": "history",
          "channelId": "approvals",
          "limit": 1
        },
        "id": "wait-for-approval",
        "name": "Wait for Approval (Logic)",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1600,
          400
        ]
      }
    ],
    "connections": {
      "Orchestrator Trigger": {
        "main": [
          [
            {
              "node": "Master Planner AI",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Master Planner AI": {
        "main": [
          [
            {
              "node": "Split Tasks",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split Tasks": {
        "main": [
          [
            {
              "node": "Agent Router",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Agent Router": {
        "main": [
          [
            {
              "node": "Agent: Enrichment",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Agent: Content",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Agent: CRM",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Agent: Content": {
        "main": [
          [
            {
              "node": "HITL Approval",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "HITL Approval": {
        "main": [
          [
            {
              "node": "Wait for Approval (Logic)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain AI Visual Content Generator v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-ju8rbwcdi",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "generate-visual",
          "options": {}
        },
        "id": "webhook-visual",
        "name": "Visual Gen Request",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          300
        ],
        "webhookId": "visual-gen-webhook"
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Analyze the prompt and select the BEST AI provider.\n\nProviders:\n- FLUX (Image, Fast)\n- KLING (Video, Motion)\n- RUNWAY (Video, Cinematic)\n- PIKA (Video, Animation)\n- LUMA (Video, 3D)\n- HIGGSFIELD (Video, Human)\n- VEO (Video, High Quality)\n\nOutput JSON:\n{ \"provider\": \"KLING\", \"optimized_prompt\": \"...\" }"
              },
              {
                "role": "user",
                "content": "Request: {{ $json.body.prompt }}\nType: {{ $json.body.type }}"
              }
            ]
          },
          "jsonOutput": true
        },
        "id": "ai-selector",
        "name": "AI Select Provider",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          450,
          300
        ]
      },
      {
        "parameters": {
          "dataType": "string",
          "value1": "={{ $json.provider }}",
          "rules": {
            "rules": [
              {
                "value2": "FLUX",
                "output": 0
              },
              {
                "value2": "KLING",
                "output": 1
              },
              {
                "value2": "RUNWAY",
                "output": 2
              }
            ]
          },
          "fallbackOutput": 3
        },
        "id": "provider-router",
        "name": "Provider Router",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          700,
          300
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.piapi.ai/v1/flux/generate",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "x-api-key",
                "value": "={{ $env.PIAPI_KEY }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={ \"prompt\": \"{{ $json.optimized_prompt }}\" }"
        },
        "id": "gen-flux",
        "name": "Generate FLUX",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1000,
          100
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.klingai.com/v1/videos",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Bearer {{ $env.KLING_API_KEY }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={ \"model\": \"kling-v1\", \"prompt\": \"{{ $json.optimized_prompt }}\" }"
        },
        "id": "gen-kling",
        "name": "Generate KLING",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1000,
          300
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.runwayml.com/v1/deploy/generate",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Bearer {{ $env.RUNWAY_API_KEY }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={ \"prompt\": \"{{ $json.optimized_prompt }}\" }"
        },
        "id": "gen-runway",
        "name": "Generate RUNWAY",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1000,
          500
        ]
      },
      {
        "parameters": {},
        "id": "merge-outputs",
        "name": "Merge Outputs",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          1300,
          300
        ]
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={ \"status\": \"started\", \"task_id\": \"{{ $json.id }}\", \"provider\": \"{{ $json.provider }}\" }",
          "options": {}
        },
        "id": "respond-api",
        "name": "Respond to API",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1,
        "position": [
          1500,
          300
        ]
      }
    ],
    "connections": {
      "Visual Gen Request": {
        "main": [
          [
            {
              "node": "AI Select Provider",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Select Provider": {
        "main": [
          [
            {
              "node": "Provider Router",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Provider Router": {
        "main": [
          [
            {
              "node": "Generate FLUX",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Generate KLING",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Generate RUNWAY",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate FLUX": {
        "main": [
          [
            {
              "node": "Merge Outputs",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate KLING": {
        "main": [
          [
            {
              "node": "Merge Outputs",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate RUNWAY": {
        "main": [
          [
            {
              "node": "Merge Outputs",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge Outputs": {
        "main": [
          [
            {
              "node": "Respond to API",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Knowledge Base AI Search v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-8rq9dan6a",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "content": "## ðŸ“š Knowledge Base AI Search\nRAG-powered semantic search across your documentation with AI-generated answers.",
          "height": 100,
          "width": 350,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "kb-search",
          "options": {}
        },
        "id": "webhook-search",
        "name": "Search Request",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          400
        ],
        "webhookId": "kb-search"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.openai.com/v1/embeddings",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Bearer {{ $env.OPENAI_API_KEY }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={ \"model\": \"text-embedding-3-small\", \"input\": \"{{ $json.query }}\" }"
        },
        "id": "embed-query",
        "name": "Embed Query",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $env.PINECONE_URL }}/query",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Api-Key",
                "value": "={{ $env.PINECONE_API_KEY }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"vector\": {{ JSON.stringify($json.data[0].embedding) }},\n  \"topK\": 5,\n  \"includeMetadata\": true\n}"
        },
        "id": "vector-search",
        "name": "Vector Search",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          400
        ]
      },
      {
        "parameters": {
          "jsCode": "const matches = $input.item.json.matches || [];\nconst context = matches.map(m => m.metadata?.text || '').join('\\n\\n---\\n\\n');\nconst sources = matches.map(m => ({\n  title: m.metadata?.title,\n  url: m.metadata?.url,\n  score: m.score\n}));\n\nreturn {\n  json: {\n    query: $('Search Request').first().json.query,\n    context: context,\n    sources: sources,\n    has_results: matches.length > 0\n  }\n};"
        },
        "id": "prepare-context",
        "name": "Prepare Context",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1000,
          400
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are a helpful assistant that answers questions based on the provided knowledge base context. If the answer is not in the context, say so. Be concise and cite sources when possible."
              },
              {
                "role": "user",
                "content": "Question: {{ $json.query }}\n\nKnowledge Base Context:\n{{ $json.context }}"
              }
            ]
          },
          "jsonOutput": false
        },
        "id": "ai-answer",
        "name": "AI Generate Answer",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          1250,
          400
        ]
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={\n  \"answer\": \"{{ $json.message.content }}\",\n  \"sources\": {{ JSON.stringify($('Prepare Context').first().json.sources) }},\n  \"query\": \"{{ $('Search Request').first().json.query }}\"\n}",
          "options": {}
        },
        "id": "respond",
        "name": "Respond",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1,
        "position": [
          1500,
          400
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "kb-index",
          "options": {}
        },
        "id": "webhook-index",
        "name": "Index Document",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          650
        ],
        "webhookId": "kb-index"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.openai.com/v1/embeddings",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Bearer {{ $env.OPENAI_API_KEY }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={ \"model\": \"text-embedding-3-small\", \"input\": \"{{ $json.text }}\" }"
        },
        "id": "embed-doc",
        "name": "Embed Document",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          650
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $env.PINECONE_URL }}/vectors/upsert",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Api-Key",
                "value": "={{ $env.PINECONE_API_KEY }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"vectors\": [{\n    \"id\": \"{{ $('Index Document').first().json.doc_id }}\",\n    \"values\": {{ JSON.stringify($json.data[0].embedding) }},\n    \"metadata\": {\n      \"title\": \"{{ $('Index Document').first().json.title }}\",\n      \"text\": \"{{ $('Index Document').first().json.text.substring(0, 1000) }}\",\n      \"url\": \"{{ $('Index Document').first().json.url }}\"\n    }\n  }]\n}"
        },
        "id": "upsert-vector",
        "name": "Upsert to Pinecone",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          650
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          750,
          850
        ]
      },
      {
        "parameters": {
          "channel": "#system-alerts",
          "text": "=ðŸš¨ KB Search Error\n\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1000,
          850
        ]
      }
    ],
    "connections": {
      "Search Request": {
        "main": [
          [
            {
              "node": "Embed Query",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Embed Query": {
        "main": [
          [
            {
              "node": "Vector Search",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Vector Search": {
        "main": [
          [
            {
              "node": "Prepare Context",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepare Context": {
        "main": [
          [
            {
              "node": "AI Generate Answer",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Generate Answer": {
        "main": [
          [
            {
              "node": "Respond",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Index Document": {
        "main": [
          [
            {
              "node": "Embed Document",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Embed Document": {
        "main": [
          [
            {
              "node": "Upsert to Pinecone",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Trigger": {
        "main": [
          [
            {
              "node": "Error Alert",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Prompt Engineering Studio v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-b8g4l9aou",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "prompt-studio",
          "options": {}
        },
        "id": "webhook-trigger",
        "name": "Prompt Request",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          300
        ],
        "webhookId": "prompt-studio"
      },
      {
        "parameters": {
          "jsCode": "const input = $input.item.json;\n\nreturn {\n  json: {\n    request_id: input.request_id || `PRM-${Date.now()}`,\n    raw_prompt: input.prompt || input.raw_prompt,\n    task_type: input.task_type || 'general',\n    target_platform: input.target_platform || 'any',\n    tone: input.tone || 'professional',\n    use_chain_of_thought: input.use_chain_of_thought !== false,\n    generate_variants: input.generate_variants || 3\n  }\n};"
        },
        "id": "normalize-input",
        "name": "Normalize Request",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          450,
          300
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are a world-class Prompt Engineer. Analyze the user's prompt and evaluate it on:\n1. Clarity (1-10)\n2. Completeness (1-10)\n3. Risk (Hallucination/Bias)\n\nReturn JSON output."
              },
              {
                "role": "user",
                "content": "Prompt: {{ $json.raw_prompt }}\nContext: {{ $json.task_type }}"
              }
            ]
          },
          "jsonOutput": true
        },
        "id": "analyze-prompt",
        "name": "Analyze Prompt",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          650,
          300
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Now OPTIMIZE the prompt. Apply best practices:\n- Add Chain-of-Thought instructions if requested.\n- Add Few-Shot examples.\n- Define clear constraints.\n- Output format specification.\n\nGenerate {{ $json.generate_variants }} variants."
              },
              {
                "role": "user",
                "content": "Original: {{ $json.raw_prompt }}\nAnalysis: {{ $json.analysis_result }}"
              }
            ]
          },
          "jsonOutput": true
        },
        "id": "optimize-prompt",
        "name": "Optimize Prompt",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          850,
          300
        ]
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={\n  \"original_prompt\": \"{{ $json.raw_prompt }}\",\n  \"analysis\": {{ $json.analysis_result }},\n  \"optimized_variants\": {{ $json.optimized_result }}\n}",
          "options": {}
        },
        "id": "response",
        "name": "Send Response",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1,
        "position": [
          1100,
          300
        ]
      }
    ],
    "connections": {
      "Prompt Request": {
        "main": [
          [
            {
              "node": "Normalize Request",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Normalize Request": {
        "main": [
          [
            {
              "node": "Analyze Prompt",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Analyze Prompt": {
        "main": [
          [
            {
              "node": "Optimize Prompt",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Optimize Prompt": {
        "main": [
          [
            {
              "node": "Send Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Voice AI Assistant v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-y0ii092ms",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "voice-input",
          "options": {}
        },
        "id": "webhook-voice",
        "name": "Voice Input",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          300
        ],
        "webhookId": "voice-assistant"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.openai.com/v1/audio/transcriptions",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Bearer {{ $env.OPENAI_API_KEY }}"
              }
            ]
          },
          "sendBody": true,
          "contentType": "multipart-form-data",
          "bodyParameters": {
            "parameters": [
              {
                "name": "file",
                "value": "={{ $json.audio_file }}"
              },
              {
                "name": "model",
                "value": "whisper-1"
              }
            ]
          }
        },
        "id": "whisper-transcribe",
        "name": "Whisper Transcribe",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          300
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are a helpful voice assistant. Respond conversationally to the user's spoken request. Keep responses under 50 words for TTS."
              },
              {
                "role": "user",
                "content": "{{ $json.text }}"
              }
            ]
          },
          "jsonOutput": false
        },
        "id": "ai-respond",
        "name": "AI Generate Response",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          750,
          300
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.openai.com/v1/audio/speech",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Bearer {{ $env.OPENAI_API_KEY }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={ \"model\": \"tts-1\", \"input\": \"{{ $json.message.content }}\", \"voice\": \"nova\" }"
        },
        "id": "tts-generate",
        "name": "Generate Speech (TTS)",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1000,
          300
        ]
      },
      {
        "parameters": {
          "respondWith": "binary",
          "options": {}
        },
        "id": "return-audio",
        "name": "Return Audio",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1,
        "position": [
          1250,
          300
        ]
      }
    ],
    "connections": {
      "Voice Input": {
        "main": [
          [
            {
              "node": "Whisper Transcribe",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Whisper Transcribe": {
        "main": [
          [
            {
              "node": "AI Generate Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Generate Response": {
        "main": [
          [
            {
              "node": "Generate Speech (TTS)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate Speech (TTS)": {
        "main": [
          [
            {
              "node": "Return Audio",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain A/B Testing Engine v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-llazfu2yn",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "ab-test/create",
          "options": {}
        },
        "id": "webhook-create",
        "name": "Create Test",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          300
        ],
        "webhookId": "ab-create"
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are a Conversion Rate Optimization expert. Generate 2 variants (B and C) for the provided Control (A) content. \nFocus on: {{ $json.body.goal }}\nOutput JSON: { \"variants\": [ { \"id\": \"B\", \"content\": \"...\" }, { \"id\": \"C\", \"content\": \"...\" } ] }"
              },
              {
                "role": "user",
                "content": "Control Content: {{ $json.body.content }}"
              }
            ]
          },
          "jsonOutput": true
        },
        "id": "ai-variants",
        "name": "Generate Variants",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          450,
          300
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Active_Tests"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "test_id": "={{ $json.body.test_name }}",
              "variant_b": "={{ $json.variants[0].content }}",
              "variant_c": "={{ $json.variants[1].content }}",
              "status": "active",
              "start_date": "={{ $now.toISO() }}"
            }
          }
        },
        "id": "save-test",
        "name": "Save to DB",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          700,
          300
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "ab-test/track",
          "options": {}
        },
        "id": "webhook-track",
        "name": "Track Conversion",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          500
        ],
        "webhookId": "ab-track"
      },
      {
        "parameters": {
          "jsCode": "// Simple Z-Score Calculation Mock\nconst visitors = $json.body.visitors;\nconst conversions = $json.body.conversions;\n// ... complex math ...\nreturn { json: { winner: \"B\", confidence: 96 } };"
        },
        "id": "calc-stats",
        "name": "Calc Significance",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          450,
          500
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "sig-check",
                "leftValue": "={{ $json.confidence }}",
                "rightValue": 95,
                "operator": {
                  "type": "number",
                  "operation": "gte"
                }
              }
            ],
            "combinator": "and"
          }
        },
        "id": "check-winner",
        "name": "Check Winner",
        "type": "n8n-nodes-base.filter",
        "typeVersion": 2,
        "position": [
          650,
          500
        ]
      },
      {
        "parameters": {
          "channel": "cro-wins",
          "text": "=ðŸ† **A/B Test Winner Found!**\n\nTest: {{ $json.body.test_id }}\nWinner: Variant {{ $json.winner }}\nConfidence: {{ $json.confidence }}%\n\nAuto-deploying winner...",
          "otherOptions": {}
        },
        "id": "slack-notify",
        "name": "Notify Winner",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          850,
          500
        ]
      }
    ],
    "connections": {
      "Create Test": {
        "main": [
          [
            {
              "node": "Generate Variants",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate Variants": {
        "main": [
          [
            {
              "node": "Save to DB",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Track Conversion": {
        "main": [
          [
            {
              "node": "Calc Significance",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calc Significance": {
        "main": [
          [
            {
              "node": "Check Winner",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check Winner": {
        "main": [
          [
            {
              "node": "Notify Winner",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Churn Prediction & Prevention v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-u6za7vkf2",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 6 * * *"
              }
            ]
          }
        },
        "id": "daily-churn-check",
        "name": "Daily Churn Analysis",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          200,
          400
        ],
        "typeVersion": 1.1
      },
      {
        "parameters": {},
        "id": "webhook-manual",
        "name": "Manual Churn Check",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          200,
          600
        ],
        "webhookId": "churn-manual-check"
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Customer_Data"
          },
          "options": {
            "range": "A:Z"
          }
        },
        "id": "get-customer-data",
        "name": "Get Customer Data",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          450,
          400
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $env.ANALYTICS_API_URL }}/users/engagement",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "date_from",
                "value": "={{ $now.minus({days: 30}).format('YYYY-MM-DD') }}"
              },
              {
                "name": "date_to",
                "value": "={{ $now.format('YYYY-MM-DD') }}"
              }
            ]
          }
        },
        "id": "get-usage-data",
        "name": "Get Usage Analytics",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          450,
          600
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $env.STRIPE_API_URL }}/v1/customers",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "limit",
                "value": "100"
              }
            ]
          }
        },
        "id": "get-payment-data",
        "name": "Get Payment History",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          450,
          800
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $env.SUPPORT_API_URL }}/tickets",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "created_since",
                "value": "={{ $now.minus({days: 90}).format('YYYY-MM-DD') }}"
              }
            ]
          }
        },
        "id": "get-support-tickets",
        "name": "Get Support Tickets",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          450,
          1000
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "jsCode": "// Merge and normalize all customer data\nconst customerData = $('Get Customer Data').all().map(c => c.json);\nconst usageData = $('Get Usage Analytics').first()?.json?.users || [];\nconst paymentData = $('Get Payment History').first()?.json?.data || [];\nconst supportData = $('Get Support Tickets').first()?.json?.tickets || [];\n\n// Create unified customer profiles\nconst profiles = customerData.map(customer => {\n  const customerId = customer.customer_id || customer.id;\n  \n  // Find related usage data\n  const usage = usageData.find(u => u.customer_id === customerId) || {};\n  \n  // Find related payment data\n  const payments = paymentData.find(p => p.id === customerId || p.email === customer.email) || {};\n  \n  // Count support tickets\n  const tickets = supportData.filter(t => t.customer_id === customerId || t.email === customer.email);\n  const openTickets = tickets.filter(t => t.status === 'open' || t.status === 'pending');\n  const escalatedTickets = tickets.filter(t => t.priority === 'high' || t.priority === 'urgent');\n  \n  return {\n    customer_id: customerId,\n    email: customer.email,\n    name: customer.name || customer.company_name,\n    plan: customer.plan || 'unknown',\n    mrr: parseFloat(customer.mrr || 0),\n    signup_date: customer.signup_date || customer.created_at,\n    last_login: usage.last_activity || customer.last_login,\n    \n    // Engagement metrics\n    logins_last_30d: usage.login_count || 0,\n    features_used: usage.features_used || 0,\n    active_days: usage.active_days || 0,\n    session_duration_avg: usage.avg_session_minutes || 0,\n    \n    // Payment health\n    payment_failures: payments.invoice_settings?.default_payment_method ? 0 : 1,\n    days_past_due: payments.delinquent ? 30 : 0,\n    discount_applied: payments.discount ? true : false,\n    \n    // Support metrics\n    total_tickets_90d: tickets.length,\n    open_tickets: openTickets.length,\n    escalated_tickets: escalatedTickets.length,\n    avg_response_satisfaction: tickets.reduce((sum, t) => sum + (t.satisfaction || 3), 0) / Math.max(tickets.length, 1),\n    \n    // Derived metrics\n    days_since_signup: Math.floor((new Date() - new Date(customer.signup_date || customer.created_at)) / (1000 * 60 * 60 * 24)),\n    days_since_login: usage.last_activity ? Math.floor((new Date() - new Date(usage.last_activity)) / (1000 * 60 * 60 * 24)) : 999\n  };\n});\n\nreturn profiles.map(p => ({ json: p }));"
        },
        "id": "merge-customer-data",
        "name": "Merge All Data Sources",
        "type": "n8n-nodes-base.code",
        "position": [
          700,
          600
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "jsCode": "// Calculate Health Score (0-100) for each customer\nconst customer = $input.item.json;\n\n// Scoring weights\nconst weights = {\n  engagement: 0.35,\n  payment: 0.25,\n  support: 0.20,\n  tenure: 0.10,\n  growth: 0.10\n};\n\n// Engagement Score (0-100)\nlet engagementScore = 0;\nif (customer.days_since_login <= 3) engagementScore += 40;\nelse if (customer.days_since_login <= 7) engagementScore += 30;\nelse if (customer.days_since_login <= 14) engagementScore += 15;\nelse if (customer.days_since_login <= 30) engagementScore += 5;\n\nengagementScore += Math.min(customer.logins_last_30d * 2, 30);\nengagementScore += Math.min(customer.features_used * 3, 30);\n\n// Payment Score (0-100)\nlet paymentScore = 100;\npaymentScore -= customer.payment_failures * 30;\npaymentScore -= customer.days_past_due;\nif (customer.discount_applied) paymentScore -= 10;\npaymentScore = Math.max(0, paymentScore);\n\n// Support Score (0-100) - fewer issues = higher score\nlet supportScore = 100;\nsupportScore -= customer.open_tickets * 15;\nsupportScore -= customer.escalated_tickets * 20;\nsupportScore -= Math.min(customer.total_tickets_90d * 2, 30);\nif (customer.avg_response_satisfaction < 3) supportScore -= 20;\nsupportScore = Math.max(0, supportScore);\n\n// Tenure Score (0-100) - longer tenure = higher score\nlet tenureScore = Math.min(customer.days_since_signup / 3, 100);\n\n// Growth Score (0-100) - based on plan and engagement trend\nlet growthScore = 50;\nif (customer.plan === 'enterprise') growthScore = 90;\nelse if (customer.plan === 'pro') growthScore = 70;\nelse if (customer.plan === 'basic') growthScore = 40;\n\n// Calculate weighted health score\nconst healthScore = Math.round(\n  engagementScore * weights.engagement +\n  paymentScore * weights.payment +\n  supportScore * weights.support +\n  tenureScore * weights.tenure +\n  growthScore * weights.growth\n);\n\n// Determine risk level\nlet riskLevel, riskCategory;\nif (healthScore >= 80) {\n  riskLevel = 'LOW';\n  riskCategory = 'healthy';\n} else if (healthScore >= 60) {\n  riskLevel = 'MEDIUM';\n  riskCategory = 'at_risk';\n} else if (healthScore >= 40) {\n  riskLevel = 'HIGH';\n  riskCategory = 'high_risk';\n} else {\n  riskLevel = 'CRITICAL';\n  riskCategory = 'churning';\n}\n\n// Identify primary churn signals\nconst signals = [];\nif (customer.days_since_login > 14) signals.push('Inactive for ' + customer.days_since_login + ' days');\nif (customer.payment_failures > 0) signals.push('Payment issues detected');\nif (customer.open_tickets > 2) signals.push('Multiple open support tickets');\nif (customer.escalated_tickets > 0) signals.push('Has escalated tickets');\nif (customer.logins_last_30d < 5) signals.push('Low login frequency');\nif (customer.features_used < 3) signals.push('Low feature adoption');\n\nreturn {\n  json: {\n    ...customer,\n    health_score: healthScore,\n    scores: {\n      engagement: Math.round(engagementScore),\n      payment: Math.round(paymentScore),\n      support: Math.round(supportScore),\n      tenure: Math.round(tenureScore),\n      growth: Math.round(growthScore)\n    },\n    risk_level: riskLevel,\n    risk_category: riskCategory,\n    churn_signals: signals,\n    signal_count: signals.length,\n    needs_intervention: healthScore < 60,\n    analyzed_at: new Date().toISOString()\n  }\n};"
        },
        "id": "calculate-health-score",
        "name": "Calculate Health Score",
        "type": "n8n-nodes-base.code",
        "position": [
          900,
          600
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "needs-intervention",
                "leftValue": "={{ $json.needs_intervention }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "true"
                }
              }
            ],
            "combinator": "and"
          }
        },
        "id": "filter-at-risk",
        "name": "Filter At-Risk Customers",
        "type": "n8n-nodes-base.filter",
        "position": [
          1100,
          600
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "model": "gpt-4o-mini",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are a customer success AI that creates personalized intervention strategies for at-risk customers. Based on the customer's health metrics and churn signals, recommend specific actions.\n\nFor each customer, provide:\n1. PRIMARY_REASON: The main driver of churn risk\n2. INTERVENTION_TYPE: One of [personal_outreach, discount_offer, feature_training, support_escalation, executive_call, win_back_campaign]\n3. MESSAGE_TEMPLATE: A personalized outreach message (2-3 sentences)\n4. URGENCY: 1-5 scale (5 = immediate action needed)\n5. RECOMMENDED_ACTIONS: List of 2-3 specific next steps\n\nRespond in JSON format."
              },
              {
                "role": "user",
                "content": "=Analyze this at-risk customer and recommend intervention:\n\nCustomer: {{ $json.name }} ({{ $json.email }})\nPlan: {{ $json.plan }}\nMRR: ${{ $json.mrr }}\nHealth Score: {{ $json.health_score }}/100\nRisk Level: {{ $json.risk_level }}\n\nHealth Breakdown:\n- Engagement: {{ $json.scores.engagement }}/100\n- Payment: {{ $json.scores.payment }}/100\n- Support: {{ $json.scores.support }}/100\n\nChurn Signals:\n{{ $json.churn_signals.join('\\n- ') }}\n\nDays Since Last Login: {{ $json.days_since_login }}\nOpen Support Tickets: {{ $json.open_tickets }}\nLogins Last 30 Days: {{ $json.logins_last_30d }}"
              }
            ]
          },
          "options": {
            "temperature": 0.7
          }
        },
        "id": "ai-intervention-strategy",
        "name": "AI Intervention Strategy",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          1300,
          600
        ],
        "typeVersion": 1.4
      },
      {
        "parameters": {
          "jsCode": "const customer = $input.item.json;\nconst aiResponse = $('AI Intervention Strategy').first()?.json?.message?.content;\n\nlet strategy;\ntry {\n  strategy = JSON.parse(aiResponse);\n} catch (e) {\n  strategy = {\n    PRIMARY_REASON: 'Low engagement',\n    INTERVENTION_TYPE: 'personal_outreach',\n    MESSAGE_TEMPLATE: `Hi ${customer.name}, we noticed you haven't logged in recently. Is there anything we can help with?`,\n    URGENCY: 3,\n    RECOMMENDED_ACTIONS: ['Send check-in email', 'Schedule call', 'Review support tickets']\n  };\n}\n\nreturn {\n  json: {\n    ...customer,\n    intervention: strategy,\n    intervention_scheduled: false,\n    intervention_created_at: new Date().toISOString()\n  }\n};"
        },
        "id": "parse-strategy",
        "name": "Parse Intervention Strategy",
        "type": "n8n-nodes-base.code",
        "position": [
          1500,
          600
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "conditions": [
                    {
                      "leftValue": "={{ $json.intervention.INTERVENTION_TYPE }}",
                      "rightValue": "personal_outreach",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ]
                },
                "renameOutput": true,
                "outputKey": "personal_outreach"
              },
              {
                "conditions": {
                  "conditions": [
                    {
                      "leftValue": "={{ $json.intervention.INTERVENTION_TYPE }}",
                      "rightValue": "discount_offer",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ]
                },
                "renameOutput": true,
                "outputKey": "discount_offer"
              },
              {
                "conditions": {
                  "conditions": [
                    {
                      "leftValue": "={{ $json.intervention.INTERVENTION_TYPE }}",
                      "rightValue": "feature_training",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ]
                },
                "renameOutput": true,
                "outputKey": "feature_training"
              },
              {
                "conditions": {
                  "conditions": [
                    {
                      "leftValue": "={{ $json.intervention.INTERVENTION_TYPE }}",
                      "rightValue": "support_escalation",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ]
                },
                "renameOutput": true,
                "outputKey": "support_escalation"
              },
              {
                "conditions": {
                  "conditions": [
                    {
                      "leftValue": "={{ $json.intervention.INTERVENTION_TYPE }}",
                      "rightValue": "executive_call",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ]
                },
                "renameOutput": true,
                "outputKey": "executive_call"
              }
            ],
            "fallbackOutput": {
              "renameOutput": true,
              "outputKey": "default"
            }
          }
        },
        "id": "route-intervention",
        "name": "Route by Intervention Type",
        "type": "n8n-nodes-base.switch",
        "position": [
          1700,
          600
        ],
        "typeVersion": 3
      },
      {
        "parameters": {
          "sendTo": "={{ $json.email }}",
          "subject": "=We miss you, {{ $json.name }}!",
          "message": "={{ $json.intervention.MESSAGE_TEMPLATE }}\n\nIf you have any questions or need assistance, please don't hesitate to reach out.\n\nBest regards,\nCustomer Success Team",
          "options": {}
        },
        "id": "send-personal-email",
        "name": "Send Personal Outreach",
        "type": "n8n-nodes-base.gmail",
        "position": [
          1900,
          300
        ],
        "typeVersion": 2.1
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $env.STRIPE_API_URL }}/v1/coupons",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "percent_off",
                "value": "20"
              },
              {
                "name": "duration",
                "value": "once"
              },
              {
                "name": "metadata[customer_id]",
                "value": "={{ $json.customer_id }}"
              },
              {
                "name": "metadata[reason]",
                "value": "churn_prevention"
              }
            ]
          }
        },
        "id": "create-discount",
        "name": "Create Discount Coupon",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1900,
          500
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "resource": "event",
          "calendarId": "={{ $env.CS_CALENDAR_ID }}",
          "start": "={{ $now.plus({days: 1}).set({hour: 10, minute: 0}).toISO() }}",
          "end": "={{ $now.plus({days: 1}).set({hour: 10, minute: 30}).toISO() }}",
          "additionalFields": {
            "summary": "=Feature Training: {{ $json.name }}",
            "description": "=Churn prevention training session.\nHealth Score: {{ $json.health_score }}\nRisk: {{ $json.risk_level }}\n\nFocus areas:\n{{ $json.churn_signals.join('\\n- ') }}",
            "attendees": [
              "={{ $json.email }}"
            ]
          }
        },
        "id": "schedule-training",
        "name": "Schedule Training Session",
        "type": "n8n-nodes-base.googleCalendar",
        "position": [
          1900,
          700
        ],
        "typeVersion": 3
      },
      {
        "parameters": {
          "channel": "#support-escalation",
          "text": "=ðŸš¨ *Support Escalation Required*\n\nCustomer: {{ $json.name }} ({{ $json.email }})\nPlan: {{ $json.plan }} | MRR: ${{ $json.mrr }}\nHealth Score: {{ $json.health_score }}/100 | Risk: {{ $json.risk_level }}\n\n*Open Tickets:* {{ $json.open_tickets }}\n*Escalated Tickets:* {{ $json.escalated_tickets }}\n\n*Churn Signals:*\n{{ $json.churn_signals.map(s => 'â€¢ ' + s).join('\\n') }}\n\n*Recommended Actions:*\n{{ $json.intervention.RECOMMENDED_ACTIONS.map((a, i) => (i+1) + '. ' + a).join('\\n') }}",
          "otherOptions": {}
        },
        "id": "escalate-support",
        "name": "Escalate to Support Team",
        "type": "n8n-nodes-base.slack",
        "position": [
          1900,
          900
        ],
        "typeVersion": 2.1
      },
      {
        "parameters": {
          "channel": "#customer-success",
          "text": "=ðŸ”´ *Executive Call Required*\n\nHigh-value customer at risk of churning!\n\nCustomer: {{ $json.name }} ({{ $json.email }})\nPlan: {{ $json.plan }} | MRR: ${{ $json.mrr }}\nHealth Score: {{ $json.health_score }}/100\n\n*Primary Churn Reason:* {{ $json.intervention.PRIMARY_REASON }}\n*Urgency:* {{ $json.intervention.URGENCY }}/5\n\n*Signals:*\n{{ $json.churn_signals.map(s => 'â€¢ ' + s).join('\\n') }}\n\nPlease schedule executive outreach immediately.",
          "otherOptions": {}
        },
        "id": "executive-alert",
        "name": "Executive Call Alert",
        "type": "n8n-nodes-base.slack",
        "position": [
          1900,
          1100
        ],
        "typeVersion": 2.1
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Churn_Interventions"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "customer_id": "={{ $json.customer_id }}",
              "customer_name": "={{ $json.name }}",
              "email": "={{ $json.email }}",
              "plan": "={{ $json.plan }}",
              "mrr": "={{ $json.mrr }}",
              "health_score": "={{ $json.health_score }}",
              "risk_level": "={{ $json.risk_level }}",
              "intervention_type": "={{ $json.intervention.INTERVENTION_TYPE }}",
              "primary_reason": "={{ $json.intervention.PRIMARY_REASON }}",
              "urgency": "={{ $json.intervention.URGENCY }}",
              "churn_signals": "={{ $json.churn_signals.join('; ') }}",
              "analyzed_at": "={{ $json.analyzed_at }}",
              "status": "intervention_sent"
            }
          }
        },
        "id": "log-intervention",
        "name": "Log Intervention",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          2100,
          600
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "channel": "#churn-alerts",
          "text": "=ðŸ“Š *Daily Churn Risk Report*\n\n*Total Customers Analyzed:* {{ $('Get Customer Data').all().length }}\n*At-Risk Customers:* {{ $('Filter At-Risk Customers').all().length }}\n\n*Risk Breakdown:*\nðŸ”´ CRITICAL: {{ $('Filter At-Risk Customers').all().filter(c => c.json.risk_level === 'CRITICAL').length }}\nðŸŸ  HIGH: {{ $('Filter At-Risk Customers').all().filter(c => c.json.risk_level === 'HIGH').length }}\nðŸŸ¡ MEDIUM: {{ $('Filter At-Risk Customers').all().filter(c => c.json.risk_level === 'MEDIUM').length }}\n\n*Interventions Triggered:* {{ $('Log Intervention').all().length }}\n\n_Full report in Churn_Interventions sheet_",
          "otherOptions": {}
        },
        "id": "daily-summary",
        "name": "Daily Summary Report",
        "type": "n8n-nodes-base.slack",
        "position": [
          2300,
          600
        ],
        "typeVersion": 2.1
      }
    ],
    "connections": {
      "Daily Churn Analysis": {
        "main": [
          [
            {
              "node": "Get Customer Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Manual Churn Check": {
        "main": [
          [
            {
              "node": "Get Customer Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Customer Data": {
        "main": [
          [
            {
              "node": "Get Usage Analytics",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Usage Analytics": {
        "main": [
          [
            {
              "node": "Get Payment History",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Payment History": {
        "main": [
          [
            {
              "node": "Get Support Tickets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Support Tickets": {
        "main": [
          [
            {
              "node": "Merge All Data Sources",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge All Data Sources": {
        "main": [
          [
            {
              "node": "Calculate Health Score",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calculate Health Score": {
        "main": [
          [
            {
              "node": "Filter At-Risk Customers",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Filter At-Risk Customers": {
        "main": [
          [
            {
              "node": "AI Intervention Strategy",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Intervention Strategy": {
        "main": [
          [
            {
              "node": "Parse Intervention Strategy",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Intervention Strategy": {
        "main": [
          [
            {
              "node": "Route by Intervention Type",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Route by Intervention Type": {
        "personal_outreach": [
          [
            {
              "node": "Send Personal Outreach",
              "type": "main",
              "index": 0
            }
          ]
        ],
        "discount_offer": [
          [
            {
              "node": "Create Discount Coupon",
              "type": "main",
              "index": 0
            }
          ]
        ],
        "feature_training": [
          [
            {
              "node": "Schedule Training Session",
              "type": "main",
              "index": 0
            }
          ]
        ],
        "support_escalation": [
          [
            {
              "node": "Escalate to Support Team",
              "type": "main",
              "index": 0
            }
          ]
        ],
        "executive_call": [
          [
            {
              "node": "Executive Call Alert",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send Personal Outreach": {
        "main": [
          [
            {
              "node": "Log Intervention",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create Discount Coupon": {
        "main": [
          [
            {
              "node": "Log Intervention",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Schedule Training Session": {
        "main": [
          [
            {
              "node": "Log Intervention",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Escalate to Support Team": {
        "main": [
          [
            {
              "node": "Log Intervention",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Executive Call Alert": {
        "main": [
          [
            {
              "node": "Log Intervention",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Log Intervention": {
        "main": [
          [
            {
              "node": "Daily Summary Report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "tags": [
      {
        "name": "churn"
      },
      {
        "name": "retention"
      },
      {
        "name": "customer-success"
      }
    ]
  },
  {
    "name": "Grain Competitor Monitoring Hub v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-670g9elpu",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "content": "## ðŸ” Competitor Monitoring Hub\nTracks competitor pricing, features, content, and market positioning.",
          "height": 100,
          "width": 350,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 8 * * 1"
              }
            ]
          }
        },
        "id": "weekly-check",
        "name": "Weekly Check",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.1,
        "position": [
          250,
          400
        ]
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Competitors"
          }
        },
        "id": "get-competitors",
        "name": "Get Competitors",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://google.serper.dev/search",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={ \"q\": \"{{ $json.competitor_name }} pricing features news\", \"gl\": \"tr\", \"num\": 10 }"
        },
        "id": "search-competitor",
        "name": "Search Competitor",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          400
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Analyze competitor search results and extract:\n\n1. Recent news/announcements\n2. Pricing changes detected\n3. New features mentioned\n4. Market positioning shifts\n5. Sentiment (positive/negative/neutral)\n\nReturn JSON:\n{\n  \"competitor\": \"...\",\n  \"news\": [],\n  \"pricing_changes\": [],\n  \"new_features\": [],\n  \"sentiment\": \"...\",\n  \"threat_level\": \"low/medium/high\",\n  \"recommended_actions\": []\n}"
              },
              {
                "role": "user",
                "content": "Competitor: {{ $json.competitor_name }}\n\nSearch Results:\n{{ JSON.stringify($json.organic?.slice(0, 5)) }}"
              }
            ]
          },
          "jsonOutput": true
        },
        "id": "ai-analyze",
        "name": "AI Analyze",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          1000,
          400
        ]
      },
      {
        "parameters": {
          "conditions": {
            "conditions": [
              {
                "leftValue": "={{ $json.threat_level }}",
                "rightValue": "high",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ]
          }
        },
        "id": "is-high-threat",
        "name": "High Threat?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          1250,
          400
        ]
      },
      {
        "parameters": {
          "channel": "#competitive-intel",
          "text": "=ðŸš¨ **High Threat Competitor Alert**\n\nðŸ¢ Competitor: {{ $json.competitor }}\nâš ï¸ Threat Level: HIGH\n\nðŸ“° News:\n{{ $json.news.slice(0, 3).map(n => 'â€¢ ' + n).join('\\n') }}\n\nðŸ†• New Features:\n{{ $json.new_features.map(f => 'â€¢ ' + f).join('\\n') }}\n\nðŸ’¡ Recommended Actions:\n{{ $json.recommended_actions.map(a => 'â€¢ ' + a).join('\\n') }}",
          "otherOptions": {}
        },
        "id": "alert-high-threat",
        "name": "Alert High Threat",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1500,
          300
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Competitor_Intel"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "competitor": "={{ $json.competitor }}",
              "threat_level": "={{ $json.threat_level }}",
              "sentiment": "={{ $json.sentiment }}",
              "news_summary": "={{ $json.news.slice(0, 3).join('; ') }}",
              "new_features": "={{ $json.new_features.join('; ') }}",
              "checked_at": "={{ $now.toISO() }}"
            }
          }
        },
        "id": "save-intel",
        "name": "Save Intel",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          1500,
          500
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "add-competitor",
          "options": {}
        },
        "id": "webhook-add",
        "name": "Add Competitor",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          650
        ],
        "webhookId": "add-competitor"
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Competitors"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "competitor_name": "={{ $json.competitor_name }}",
              "website": "={{ $json.website }}",
              "category": "={{ $json.category }}",
              "added_at": "={{ $now.toISO() }}"
            }
          }
        },
        "id": "save-competitor",
        "name": "Save Competitor",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          500,
          650
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          750,
          800
        ]
      },
      {
        "parameters": {
          "channel": "#system-alerts",
          "text": "=ðŸš¨ Competitor Monitoring Error\n\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1000,
          800
        ]
      }
    ],
    "connections": {
      "Weekly Check": {
        "main": [
          [
            {
              "node": "Get Competitors",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Competitors": {
        "main": [
          [
            {
              "node": "Search Competitor",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Search Competitor": {
        "main": [
          [
            {
              "node": "AI Analyze",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Analyze": {
        "main": [
          [
            {
              "node": "High Threat?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "High Threat?": {
        "main": [
          [
            {
              "node": "Alert High Threat",
              "type": "main",
              "index": 0
            },
            {
              "node": "Save Intel",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Save Intel",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Add Competitor": {
        "main": [
          [
            {
              "node": "Save Competitor",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Trigger": {
        "main": [
          [
            {
              "node": "Error Alert",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Customer Onboarding Automation v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-g6xqlpyka",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {},
        "id": "webhook-new-customer",
        "name": "New Customer Signup",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          200,
          400
        ],
        "webhookId": "customer-signup"
      },
      {
        "parameters": {
          "method": "GET",
          "url": "={{ $env.STRIPE_API_URL }}/v1/subscriptions/{{ $json.subscription_id }}",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth"
        },
        "id": "get-subscription",
        "name": "Get Subscription Details",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          400,
          400
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "jsCode": "const input = $input.item.json;\nconst subscription = $('Get Subscription Details').first()?.json || {};\n\nconst customer = {\n  customer_id: input.customer_id || input.id,\n  email: input.email,\n  name: input.name || input.company_name,\n  company: input.company_name || input.name,\n  plan: subscription.plan?.nickname || input.plan || 'basic',\n  industry: input.industry || 'general',\n  team_size: input.team_size || '1-10',\n  role: input.role || 'user',\n  signup_date: new Date().toISOString(),\n  mrr: (subscription.plan?.amount || 0) / 100,\n  onboarding_stage: 'welcome',\n  onboarding_progress: 0,\n  milestones: {\n    welcome_email: false,\n    account_setup: false,\n    first_login: false,\n    first_action: false,\n    team_invited: false,\n    integration_connected: false,\n    first_workflow_created: false\n  }\n};\n\n// Determine onboarding path based on plan and industry\nlet onboardingPath = 'standard';\nif (customer.plan === 'enterprise') onboardingPath = 'enterprise';\nelse if (customer.industry === 'agency') onboardingPath = 'agency';\nelse if (customer.industry === 'ecommerce') onboardingPath = 'ecommerce';\nelse if (customer.industry === 'hospitality') onboardingPath = 'hospitality';\n\ncustomer.onboarding_path = onboardingPath;\n\nreturn { json: customer };"
        },
        "id": "create-customer-profile",
        "name": "Create Customer Profile",
        "type": "n8n-nodes-base.code",
        "position": [
          600,
          400
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Customer_Onboarding"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "customer_id": "={{ $json.customer_id }}",
              "email": "={{ $json.email }}",
              "name": "={{ $json.name }}",
              "company": "={{ $json.company }}",
              "plan": "={{ $json.plan }}",
              "industry": "={{ $json.industry }}",
              "onboarding_path": "={{ $json.onboarding_path }}",
              "onboarding_stage": "={{ $json.onboarding_stage }}",
              "onboarding_progress": "={{ $json.onboarding_progress }}",
              "signup_date": "={{ $json.signup_date }}",
              "mrr": "={{ $json.mrr }}"
            }
          }
        },
        "id": "save-to-sheet",
        "name": "Save to Onboarding Sheet",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          800,
          400
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "model": "gpt-4o-mini",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are a customer success specialist creating personalized welcome messages. Generate a warm, engaging welcome email that:\n1. Addresses the customer by name\n2. References their industry/use case\n3. Highlights 3 key features relevant to them\n4. Provides clear next steps\n5. Sets expectations for the onboarding journey\n\nReturn JSON with:\n- subject: Email subject line\n- greeting: Personalized greeting\n- intro: 2-3 sentences welcoming them\n- features: Array of 3 relevant features with descriptions\n- next_steps: Array of 3 action items\n- closing: Warm closing with support info"
              },
              {
                "role": "user",
                "content": "=Create a welcome email for:\nName: {{ $json.name }}\nCompany: {{ $json.company }}\nPlan: {{ $json.plan }}\nIndustry: {{ $json.industry }}\nTeam Size: {{ $json.team_size }}\nRole: {{ $json.role }}"
              }
            ]
          },
          "options": {
            "temperature": 0.7
          }
        },
        "id": "ai-welcome-email",
        "name": "AI Generate Welcome Email",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          1000,
          400
        ],
        "typeVersion": 1.4
      },
      {
        "parameters": {
          "jsCode": "const customer = $('Create Customer Profile').first().json;\nconst aiResponse = $input.item.json.message?.content;\n\nlet emailContent;\ntry {\n  emailContent = JSON.parse(aiResponse);\n} catch (e) {\n  emailContent = {\n    subject: `Welcome to Grain, ${customer.name}! ðŸŽ‰`,\n    greeting: `Hi ${customer.name},`,\n    intro: `Welcome to Grain! We're thrilled to have ${customer.company} on board. Your journey to automation excellence starts now.`,\n    features: [\n      { title: 'Multi-Platform Publishing', description: 'Publish content across 9+ platforms simultaneously' },\n      { title: 'AI Content Generation', description: 'Create stunning visuals and copy with AI' },\n      { title: 'Analytics Dashboard', description: 'Track performance across all channels' }\n    ],\n    next_steps: [\n      'Complete your profile setup',\n      'Connect your first social account',\n      'Create your first automated workflow'\n    ],\n    closing: 'Need help? Reply to this email or chat with us anytime.'\n  };\n}\n\nreturn {\n  json: {\n    ...customer,\n    email_content: emailContent\n  }\n};"
        },
        "id": "parse-email",
        "name": "Parse Email Content",
        "type": "n8n-nodes-base.code",
        "position": [
          1200,
          400
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "sendTo": "={{ $json.email }}",
          "subject": "={{ $json.email_content.subject }}",
          "message": "={{ $json.email_content.greeting }}\n\n{{ $json.email_content.intro }}\n\nðŸš€ Key Features for You:\n\n{{ $json.email_content.features.map((f, i) => 'â€¢ ' + f.title + ': ' + f.description).join('\\n') }}\n\nðŸ“‹ Your Next Steps:\n\n{{ $json.email_content.next_steps.map((s, i) => (i+1) + '. ' + s).join('\\n') }}\n\n{{ $json.email_content.closing }}\n\nBest,\nThe Grain Team",
          "options": {}
        },
        "id": "send-welcome-email",
        "name": "Send Welcome Email",
        "type": "n8n-nodes-base.gmail",
        "position": [
          1400,
          400
        ],
        "typeVersion": 2.1
      },
      {
        "parameters": {
          "resource": "contact",
          "operation": "upsert",
          "email": "={{ $json.email }}",
          "additionalFields": {
            "firstName": "={{ $json.name.split(' ')[0] }}",
            "lastName": "={{ $json.name.split(' ').slice(1).join(' ') }}",
            "company": "={{ $json.company }}",
            "jobTitle": "={{ $json.role }}",
            "lifecycleStage": "customer"
          },
          "options": {}
        },
        "id": "hubspot-create",
        "name": "Create HubSpot Contact",
        "type": "n8n-nodes-base.hubspot",
        "position": [
          1600,
          300
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "channel": "#new-customers",
          "text": "=ðŸŽ‰ *New Customer Signed Up!*\n\nðŸ‘¤ *Name:* {{ $json.name }}\nðŸ¢ *Company:* {{ $json.company }}\nðŸ’¼ *Plan:* {{ $json.plan }}\nðŸ­ *Industry:* {{ $json.industry }}\nðŸ’° *MRR:* ${{ $json.mrr }}\n\nðŸ“ *Onboarding Path:* {{ $json.onboarding_path }}\n\n_Welcome email sent. Onboarding sequence started._",
          "otherOptions": {}
        },
        "id": "slack-notify",
        "name": "Notify Team",
        "type": "n8n-nodes-base.slack",
        "position": [
          1600,
          500
        ],
        "typeVersion": 2.1
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "days",
                "daysInterval": 1
              }
            ]
          }
        },
        "id": "daily-check",
        "name": "Daily Progress Check",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          200,
          700
        ],
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Customer_Onboarding"
          },
          "options": {
            "range": "A:Z"
          }
        },
        "id": "get-onboarding",
        "name": "Get Onboarding Customers",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          400,
          700
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true
            },
            "conditions": [
              {
                "leftValue": "={{ $json.onboarding_progress }}",
                "rightValue": 100,
                "operator": {
                  "type": "number",
                  "operation": "lt"
                }
              }
            ]
          }
        },
        "id": "filter-incomplete",
        "name": "Filter Incomplete Onboarding",
        "type": "n8n-nodes-base.filter",
        "position": [
          600,
          700
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "jsCode": "const customer = $input.item.json;\nconst signupDate = new Date(customer.signup_date);\nconst now = new Date();\nconst daysSinceSignup = Math.floor((now - signupDate) / (1000 * 60 * 60 * 24));\n\n// Determine which email to send based on progress and days\nlet emailType = null;\nlet shouldSend = false;\n\nif (daysSinceSignup === 1 && customer.onboarding_progress < 20) {\n  emailType = 'day1_reminder';\n  shouldSend = true;\n} else if (daysSinceSignup === 3 && customer.onboarding_progress < 40) {\n  emailType = 'day3_tips';\n  shouldSend = true;\n} else if (daysSinceSignup === 5 && customer.onboarding_progress < 60) {\n  emailType = 'day5_help';\n  shouldSend = true;\n} else if (daysSinceSignup === 7 && customer.onboarding_progress < 80) {\n  emailType = 'day7_checkin';\n  shouldSend = true;\n} else if (daysSinceSignup === 14 && customer.onboarding_progress < 100) {\n  emailType = 'day14_final';\n  shouldSend = true;\n}\n\nreturn {\n  json: {\n    ...customer,\n    days_since_signup: daysSinceSignup,\n    email_type: emailType,\n    should_send: shouldSend\n  }\n};"
        },
        "id": "determine-sequence",
        "name": "Determine Sequence Step",
        "type": "n8n-nodes-base.code",
        "position": [
          800,
          700
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "conditions": {
            "conditions": [
              {
                "leftValue": "={{ $json.should_send }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "true"
                }
              }
            ]
          }
        },
        "id": "if-should-send",
        "name": "Should Send Email?",
        "type": "n8n-nodes-base.if",
        "position": [
          1000,
          700
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "model": "gpt-4o-mini",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Generate a follow-up onboarding email based on the email type:\n\n- day1_reminder: Friendly reminder to complete setup, offer quick tip\n- day3_tips: Share 3 power user tips, highlight a feature\n- day5_help: Offer personal assistance, share success story\n- day7_checkin: Check in, ask for feedback, offer call\n- day14_final: Final nudge, show what they're missing, offer discount on upgrade\n\nReturn JSON: {subject, body, cta_text, cta_link}"
              },
              {
                "role": "user",
                "content": "=Email Type: {{ $json.email_type }}\nName: {{ $json.name }}\nCompany: {{ $json.company }}\nProgress: {{ $json.onboarding_progress }}%\nPlan: {{ $json.plan }}\nDays Since Signup: {{ $json.days_since_signup }}"
              }
            ]
          },
          "options": {
            "temperature": 0.7
          }
        },
        "id": "ai-sequence-email",
        "name": "AI Generate Sequence Email",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          1200,
          700
        ],
        "typeVersion": 1.4
      },
      {
        "parameters": {
          "jsCode": "const customer = $input.item.json;\nconst aiResponse = $('AI Generate Sequence Email').first()?.json?.message?.content;\n\nlet emailContent;\ntry {\n  emailContent = JSON.parse(aiResponse);\n} catch (e) {\n  const templates = {\n    day1_reminder: {\n      subject: `${customer.name}, ready to get started?`,\n      body: `Hi ${customer.name},\\n\\nWe noticed you haven't completed your setup yet. It only takes 5 minutes!\\n\\nQuick tip: Start by connecting your first social account to unlock all features.`,\n      cta_text: 'Complete Setup',\n      cta_link: 'https://app.grain.com/onboarding'\n    },\n    day3_tips: {\n      subject: '3 tips to supercharge your workflow',\n      body: `Hey ${customer.name},\\n\\nHere are 3 tips our power users swear by:\\n\\n1. Use AI to generate captions in bulk\\n2. Schedule posts for optimal engagement times\\n3. Track competitors to stay ahead\\n\\nTry them today!`,\n      cta_text: 'Try Now',\n      cta_link: 'https://app.grain.com/dashboard'\n    },\n    day5_help: {\n      subject: 'Need a hand?',\n      body: `Hi ${customer.name},\\n\\nWe're here to help! Many customers like ${customer.company} have seen amazing results.\\n\\nWant to schedule a quick 15-min call to get you up and running?`,\n      cta_text: 'Schedule Call',\n      cta_link: 'https://calendly.com/grain-success'\n    },\n    day7_checkin: {\n      subject: `How's it going, ${customer.name}?`,\n      body: `Hey ${customer.name},\\n\\nIt's been a week! How's everything going?\\n\\nWe'd love to hear your feedback or answer any questions.`,\n      cta_text: 'Share Feedback',\n      cta_link: 'https://grain.com/feedback'\n    },\n    day14_final: {\n      subject: 'You're missing out on these features',\n      body: `Hi ${customer.name},\\n\\nYour ${customer.plan} plan includes powerful features you haven't tried yet.\\n\\nLet us show you what you're missing - and here's 20% off your next month to explore!`,\n      cta_text: 'Unlock Features',\n      cta_link: 'https://app.grain.com/upgrade'\n    }\n  };\n  emailContent = templates[customer.email_type] || templates.day1_reminder;\n}\n\nreturn {\n  json: {\n    ...customer,\n    sequence_email: emailContent\n  }\n};"
        },
        "id": "parse-sequence-email",
        "name": "Parse Sequence Email",
        "type": "n8n-nodes-base.code",
        "position": [
          1400,
          700
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "sendTo": "={{ $json.email }}",
          "subject": "={{ $json.sequence_email.subject }}",
          "message": "={{ $json.sequence_email.body }}\n\n[{{ $json.sequence_email.cta_text }}]({{ $json.sequence_email.cta_link }})\n\nBest,\nThe Grain Team",
          "options": {}
        },
        "id": "send-sequence-email",
        "name": "Send Sequence Email",
        "type": "n8n-nodes-base.gmail",
        "position": [
          1600,
          700
        ],
        "typeVersion": 2.1
      },
      {
        "parameters": {},
        "id": "webhook-milestone",
        "name": "Milestone Completed",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          200,
          1000
        ],
        "webhookId": "onboarding-milestone"
      },
      {
        "parameters": {
          "jsCode": "const event = $input.item.json;\n\nconst milestonePoints = {\n  account_setup: 15,\n  first_login: 10,\n  first_action: 20,\n  team_invited: 15,\n  integration_connected: 20,\n  first_workflow_created: 20\n};\n\nconst milestone = event.milestone;\nconst points = milestonePoints[milestone] || 0;\n\nreturn {\n  json: {\n    customer_id: event.customer_id,\n    email: event.email,\n    milestone: milestone,\n    points_earned: points,\n    completed_at: new Date().toISOString()\n  }\n};"
        },
        "id": "process-milestone",
        "name": "Process Milestone",
        "type": "n8n-nodes-base.code",
        "position": [
          400,
          1000
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Customer_Onboarding"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "onboarding_progress": "={{ $json.points_earned }}",
              "last_milestone": "={{ $json.milestone }}",
              "last_milestone_at": "={{ $json.completed_at }}"
            }
          },
          "options": {
            "cellFormat": "USER_ENTERED"
          }
        },
        "id": "update-progress",
        "name": "Update Progress",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          600,
          1000
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "conditions": {
            "conditions": [
              {
                "leftValue": "={{ $json.milestone }}",
                "rightValue": "first_workflow_created",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ]
          }
        },
        "id": "if-completed",
        "name": "Onboarding Complete?",
        "type": "n8n-nodes-base.if",
        "position": [
          800,
          1000
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "sendTo": "={{ $json.email }}",
          "subject": "ðŸŽ‰ Congratulations! You're all set up!",
          "message": "You did it!\n\nYou've completed all onboarding milestones. You're now a certified Grain power user!\n\nðŸ† Achievement Unlocked: Onboarding Champion\n\nHere's what you can do next:\nâ€¢ Explore advanced features\nâ€¢ Join our community\nâ€¢ Check out success stories\n\nWe're excited to see what you'll create!\n\nBest,\nThe Grain Team",
          "options": {}
        },
        "id": "send-completion-email",
        "name": "Send Completion Email",
        "type": "n8n-nodes-base.gmail",
        "position": [
          1000,
          900
        ],
        "typeVersion": 2.1
      },
      {
        "parameters": {
          "channel": "#customer-success",
          "text": "=ðŸ† *Onboarding Complete!*\n\n{{ $json.email }} has completed all milestones!\n\n_Time to celebrate another successful onboarding!_",
          "otherOptions": {}
        },
        "id": "slack-completion",
        "name": "Celebrate Completion",
        "type": "n8n-nodes-base.slack",
        "position": [
          1000,
          1100
        ],
        "typeVersion": 2.1
      }
    ],
    "connections": {
      "New Customer Signup": {
        "main": [
          [
            {
              "node": "Get Subscription Details",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Subscription Details": {
        "main": [
          [
            {
              "node": "Create Customer Profile",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create Customer Profile": {
        "main": [
          [
            {
              "node": "Save to Onboarding Sheet",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Save to Onboarding Sheet": {
        "main": [
          [
            {
              "node": "AI Generate Welcome Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Generate Welcome Email": {
        "main": [
          [
            {
              "node": "Parse Email Content",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Email Content": {
        "main": [
          [
            {
              "node": "Send Welcome Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send Welcome Email": {
        "main": [
          [
            {
              "node": "Create HubSpot Contact",
              "type": "main",
              "index": 0
            },
            {
              "node": "Notify Team",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Daily Progress Check": {
        "main": [
          [
            {
              "node": "Get Onboarding Customers",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Onboarding Customers": {
        "main": [
          [
            {
              "node": "Filter Incomplete Onboarding",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Filter Incomplete Onboarding": {
        "main": [
          [
            {
              "node": "Determine Sequence Step",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Determine Sequence Step": {
        "main": [
          [
            {
              "node": "Should Send Email?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Should Send Email?": {
        "main": [
          [
            {
              "node": "AI Generate Sequence Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Generate Sequence Email": {
        "main": [
          [
            {
              "node": "Parse Sequence Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Sequence Email": {
        "main": [
          [
            {
              "node": "Send Sequence Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Milestone Completed": {
        "main": [
          [
            {
              "node": "Process Milestone",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Process Milestone": {
        "main": [
          [
            {
              "node": "Update Progress",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Progress": {
        "main": [
          [
            {
              "node": "Onboarding Complete?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Onboarding Complete?": {
        "main": [
          [
            {
              "node": "Send Completion Email",
              "type": "main",
              "index": 0
            },
            {
              "node": "Celebrate Completion",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "tags": [
      {
        "name": "onboarding"
      },
      {
        "name": "customer-success"
      },
      {
        "name": "activation"
      }
    ]
  },
  {
    "name": "Grain Ecommerce Orchestrator v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-ji992qcwm",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "content": "## ðŸ›’ E-commerce Orchestrator\nManages inventory sync across channels and recovers abandoned carts with AI personalized offers.",
          "height": 100,
          "width": 350,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "order-created",
          "options": {}
        },
        "id": "webhook-order",
        "name": "Order Created",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          400
        ],
        "webhookId": "order-created"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "cart-abandoned",
          "options": {}
        },
        "id": "webhook-cart",
        "name": "Cart Abandoned",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          600
        ],
        "webhookId": "cart-abandoned"
      },
      {
        "parameters": {
          "jsCode": "const order = $input.item.json;\nreturn {\n  json: {\n    items: order.line_items.map(item => ({\n      sku: item.sku,\n      quantity: item.quantity,\n      new_stock: item.current_stock - item.quantity\n    }))\n  }\n};"
        },
        "id": "calc-stock",
        "name": "Calculate New Stock",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "operation": "update",
          "baseId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "table": {
            "__rl": true,
            "mode": "list",
            "value": "Inventory"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Stock": "={{ $json.new_stock }}"
            }
          }
        },
        "id": "update-airtable",
        "name": "Update Inventory DB",
        "type": "n8n-nodes-base.airtable",
        "typeVersion": 2,
        "position": [
          750,
          400
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are a sales assistant. Generate a personalized abandoned cart email.\n\nContext:\n- Customer: {{ $json.customer_name }}\n- Items Left: {{ $json.line_items.map(i => i.title).join(', ') }}\n- Total Value: {{ $json.total_price }}\n\nGoal: Recover the sale. Offer a 10% discount code (COMEBACK10) if value > $100."
              }
            ]
          },
          "jsonOutput": true
        },
        "id": "ai-recover",
        "name": "AI Draft Email",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          500,
          600
        ]
      },
      {
        "parameters": {
          "sendTo": "={{ $json.email }}",
          "subject": "Wait! You left something behind... ðŸ‘€",
          "message": "={{ $json.email_content }}",
          "options": {}
        },
        "id": "send-recovery",
        "name": "Send Recovery Email",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          750,
          600
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          500,
          800
        ]
      },
      {
        "parameters": {
          "channel": "#ecommerce-alerts",
          "text": "=ðŸš¨ E-commerce Error\n\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          750,
          800
        ]
      }
    ],
    "connections": {
      "Order Created": {
        "main": [
          [
            {
              "node": "Calculate New Stock",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calculate New Stock": {
        "main": [
          [
            {
              "node": "Update Inventory DB",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Cart Abandoned": {
        "main": [
          [
            {
              "node": "AI Draft Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Draft Email": {
        "main": [
          [
            {
              "node": "Send Recovery Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Trigger": {
        "main": [
          [
            {
              "node": "Error Alert",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Intelligent CDP v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-7z3otehwf",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "cdp-ingest",
          "options": {}
        },
        "id": "webhook-ingest",
        "name": "Data Ingestion Hook",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          300
        ],
        "webhookId": "cdp-ingestion"
      },
      {
        "parameters": {
          "jsCode": "// Identity Resolution Mock\nconst event = $input.item.json;\nconst userId = event.userId || event.email;\n\n// Simulate fetching existing profile from database\nconst profile = {\n  id: userId,\n  ltv: 1200,\n  status: \"active\",\n  last_seen: new Date().toISOString(),\n  tags: [\"pro_user\", \"early_adopter\"]\n};\n\nreturn {\n  json: {\n    event: event,\n    merged_profile: profile\n  }\n};"
        },
        "id": "identity-res",
        "name": "Identity Resolution",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          450,
          300
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Analyze user behavior event. Determine if this indicates a CHURN RISK or UPSELL OPPORTUNITY.\nOutput JSON: { \"signal\": \"CHURN_RISK\" | \"UPSELL\" | \"NEUTRAL\", \"confidence\": 0-100 }"
              },
              {
                "role": "user",
                "content": "Event: {{ JSON.stringify($json.event) }}\nProfile: {{ JSON.stringify($json.merged_profile) }}"
              }
            ]
          },
          "jsonOutput": true
        },
        "id": "ai-behavior",
        "name": "AI Behavioral Analysis",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          650,
          300
        ]
      },
      {
        "parameters": {
          "dataType": "string",
          "value1": "={{ $json.signal }}",
          "rules": {
            "rules": [
              {
                "value2": "CHURN_RISK",
                "output": 0
              },
              {
                "value2": "UPSELL",
                "output": 1
              }
            ]
          },
          "fallbackOutput": 2
        },
        "id": "signal-router",
        "name": "Signal Router",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          900,
          300
        ]
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Customer_Profiles"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "user_id": "={{ $json.merged_profile.id }}",
              "last_signal": "={{ $json.signal }}",
              "last_updated": "={{ $now.toISO() }}"
            }
          }
        },
        "id": "update-profile",
        "name": "Update Profile DB",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          1200,
          300
        ]
      },
      {
        "parameters": {
          "channel": "customer-alerts",
          "text": "=ðŸš¨ **Churn Risk Detected**\nUser: {{ $json.merged_profile.id }}\nConfidence: {{ $json.confidence }}%",
          "otherOptions": {}
        },
        "id": "slack-churn",
        "name": "Notify CS Team",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1200,
          100
        ]
      }
    ],
    "connections": {
      "Data Ingestion Hook": {
        "main": [
          [
            {
              "node": "Identity Resolution",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Identity Resolution": {
        "main": [
          [
            {
              "node": "AI Behavioral Analysis",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Behavioral Analysis": {
        "main": [
          [
            {
              "node": "Signal Router",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Signal Router": {
        "main": [
          [
            {
              "node": "Notify CS Team",
              "type": "main",
              "index": 0
            },
            {
              "node": "Update Profile DB",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Update Profile DB",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Update Profile DB",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Invoice Billing Automation v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-hjfj55171",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {},
        "id": "webhook-invoice",
        "name": "Create Invoice",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          200,
          400
        ],
        "webhookId": "create-invoice"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 9 * * *"
              }
            ]
          }
        },
        "id": "daily-dunning",
        "name": "Daily Dunning Check",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          200,
          600
        ],
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "resource": "invoice",
          "operation": "create",
          "customer": "={{ $json.stripe_customer_id }}",
          "currency": "={{ $json.currency || 'usd' }}",
          "invoiceItems": {
            "values": [
              {
                "amount": "={{ $json.amount * 100 }}",
                "description": "={{ $json.description }}"
              }
            ]
          }
        },
        "id": "stripe-invoice",
        "name": "Create Stripe Invoice",
        "type": "n8n-nodes-base.stripe",
        "position": [
          450,
          400
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "resource": "invoice",
          "operation": "get",
          "invoiceId": "={{ $json.invoice_id }}"
        },
        "id": "get-invoice-status",
        "name": "Get Invoice Status",
        "type": "n8n-nodes-base.stripe",
        "position": [
          450,
          600
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "jsCode": "const invoice = $input.item.json;\nconst dueDate = new Date(invoice.due_date * 1000);\nconst now = new Date();\nconst daysOverdue = Math.floor((now - dueDate) / (1000 * 60 * 60 * 24));\n\nlet dunningLevel = null;\nif (invoice.status === 'open' && daysOverdue > 0) {\n  if (daysOverdue === 3) dunningLevel = 'gentle';\n  else if (daysOverdue === 7) dunningLevel = 'reminder';\n  else if (daysOverdue === 14) dunningLevel = 'urgent';\n  else if (daysOverdue === 21) dunningLevel = 'final';\n}\n\nreturn {\n  json: {\n    ...invoice,\n    days_overdue: daysOverdue,\n    dunning_level: dunningLevel,\n    should_send: dunningLevel !== null\n  }\n};"
        },
        "id": "calc-dunning",
        "name": "Calculate Dunning",
        "type": "n8n-nodes-base.code",
        "position": [
          650,
          600
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "conditions": {
            "conditions": [
              {
                "leftValue": "={{ $json.should_send }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "true"
                }
              }
            ]
          }
        },
        "id": "should-send",
        "name": "Should Send?",
        "type": "n8n-nodes-base.if",
        "position": [
          850,
          600
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "model": "gpt-4o-mini",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Tahsilat e-postasÄ± yaz. Dunning level'a gÃ¶re ton ayarla:\n- gentle: Nazik hatÄ±rlatma\n- reminder: Net hatÄ±rlatma\n- urgent: Acil Ã¶deme talebi\n- final: Son uyarÄ±, hizmet askÄ±ya alÄ±nacak\n\nJSON: {\"subject\": \"\", \"body\": \"\"}"
              },
              {
                "role": "user",
                "content": "=Customer: {{ $json.customer_name }}\nAmount: {{ $json.amount_due / 100 }} {{ $json.currency }}\nDays Overdue: {{ $json.days_overdue }}\nLevel: {{ $json.dunning_level }}"
              }
            ]
          }
        },
        "id": "ai-dunning-email",
        "name": "AI Dunning Email",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          1050,
          600
        ],
        "typeVersion": 1.4
      },
      {
        "parameters": {
          "sendTo": "={{ $json.customer_email }}",
          "subject": "={{ $('AI Dunning Email').first().json.message.subject }}",
          "message": "={{ $('AI Dunning Email').first().json.message.body }}",
          "options": {}
        },
        "id": "send-dunning",
        "name": "Send Dunning Email",
        "type": "n8n-nodes-base.gmail",
        "position": [
          1250,
          600
        ],
        "typeVersion": 2.1
      },
      {
        "parameters": {
          "sendTo": "={{ $json.customer_email }}",
          "subject": "=Fatura #{{ $json.number }}",
          "message": "=Merhaba,\n\nEkte {{ $json.amount_due / 100 }} {{ $json.currency }} tutarÄ±nda faturanÄ±z yer almaktadÄ±r.\n\nÃ–deme linki: {{ $json.hosted_invoice_url }}\n\nSon Ã¶deme tarihi: {{ new Date($json.due_date * 1000).toLocaleDateString('tr-TR') }}\n\nTeÅŸekkÃ¼rler.",
          "options": {}
        },
        "id": "send-invoice-email",
        "name": "Send Invoice Email",
        "type": "n8n-nodes-base.gmail",
        "position": [
          650,
          400
        ],
        "typeVersion": 2.1
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Invoices"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "invoice_id": "={{ $json.id }}",
              "customer": "={{ $json.customer_name }}",
              "amount": "={{ $json.amount_due / 100 }}",
              "status": "={{ $json.status }}",
              "created_at": "={{ $now.toISO() }}"
            }
          }
        },
        "id": "log-invoice",
        "name": "Log Invoice",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          850,
          400
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "content": "## ðŸ’° Invoice & Billing\nStripe-integrated invoicing with AI-powered dunning emails (gentle â†’ reminder â†’ urgent â†’ final).",
          "height": 100,
          "width": 350,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          250
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          450,
          800
        ]
      },
      {
        "parameters": {
          "channel": "#billing-alerts",
          "text": "=ðŸš¨ Billing Automation Error\n\nNode: {{ $json.execution.lastNodeExecuted }}\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          650,
          800
        ]
      }
    ],
    "connections": {
      "Create Invoice": {
        "main": [
          [
            {
              "node": "Create Stripe Invoice",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create Stripe Invoice": {
        "main": [
          [
            {
              "node": "Send Invoice Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send Invoice Email": {
        "main": [
          [
            {
              "node": "Log Invoice",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Daily Dunning Check": {
        "main": [
          [
            {
              "node": "Get Invoice Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Invoice Status": {
        "main": [
          [
            {
              "node": "Calculate Dunning",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calculate Dunning": {
        "main": [
          [
            {
              "node": "Should Send?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Should Send?": {
        "main": [
          [
            {
              "node": "AI Dunning Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Dunning Email": {
        "main": [
          [
            {
              "node": "Send Dunning Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "tags": [
      {
        "name": "billing"
      },
      {
        "name": "finance"
      },
      {
        "name": "dunning"
      }
    ]
  },
  {
    "name": "Grain Master Orchestrator v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-o3vrzul9m",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "content": "## ðŸŽ›ï¸ Master Orchestrator\nCentral hub that triggers workflow chains. Routes events to the correct pipeline.",
          "height": 100,
          "width": 350,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "orchestrator",
          "options": {}
        },
        "id": "webhook-main",
        "name": "Orchestrator Webhook",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          400
        ],
        "webhookId": "orchestrator"
      },
      {
        "parameters": {
          "dataType": "string",
          "value1": "={{ $json.chain }}",
          "rules": {
            "rules": [
              {
                "value2": "customer_lifecycle",
                "output": 0
              },
              {
                "value2": "lead_to_revenue",
                "output": 1
              },
              {
                "value2": "hr_pipeline",
                "output": 2
              },
              {
                "value2": "ecommerce_funnel",
                "output": 3
              }
            ]
          },
          "fallbackOutput": 4
        },
        "id": "route-chain",
        "name": "Route to Chain",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $env.N8N_BASE_URL }}/webhook/nps-response",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ JSON.stringify($json.payload) }}"
        },
        "id": "trigger-customer-lifecycle",
        "name": "Start: Customer Lifecycle",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          200
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $env.N8N_BASE_URL }}/webhook/lead-capture",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ JSON.stringify($json.payload) }}"
        },
        "id": "trigger-lead-revenue",
        "name": "Start: Lead to Revenue",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          350
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $env.N8N_BASE_URL }}/webhook/submit-application",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ JSON.stringify($json.payload) }}"
        },
        "id": "trigger-hr-pipeline",
        "name": "Start: HR Pipeline",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          500
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $env.N8N_BASE_URL }}/webhook/cart-abandoned",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ JSON.stringify($json.payload) }}"
        },
        "id": "trigger-ecommerce",
        "name": "Start: E-commerce Funnel",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          650
        ]
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={ \"status\": \"chain_initiated\", \"chain\": \"{{ $json.chain }}\", \"timestamp\": \"{{ $now.toISO() }}\" }",
          "options": {}
        },
        "id": "respond-success",
        "name": "Respond Success",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1,
        "position": [
          1000,
          400
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          500,
          800
        ]
      },
      {
        "parameters": {
          "channel": "#orchestrator-alerts",
          "text": "=ðŸš¨ Orchestrator Error\n\nChain: {{ $json.chain }}\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          750,
          800
        ]
      }
    ],
    "connections": {
      "Orchestrator Webhook": {
        "main": [
          [
            {
              "node": "Route to Chain",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Route to Chain": {
        "main": [
          [
            {
              "node": "Start: Customer Lifecycle",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Start: Lead to Revenue",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Start: HR Pipeline",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Start: E-commerce Funnel",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Start: Customer Lifecycle": {
        "main": [
          [
            {
              "node": "Respond Success",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Start: Lead to Revenue": {
        "main": [
          [
            {
              "node": "Respond Success",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Start: HR Pipeline": {
        "main": [
          [
            {
              "node": "Respond Success",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Start: E-commerce Funnel": {
        "main": [
          [
            {
              "node": "Respond Success",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Trigger": {
        "main": [
          [
            {
              "node": "Error Alert",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain MCP Client Connector v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-rikpkg5zx",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "content": "## ðŸ”Œ MCP Client Connector\nConnects to Anthropic Model Context Protocol servers for advanced AI agent capabilities.",
          "height": 100,
          "width": 350,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "mcp-request",
          "options": {}
        },
        "id": "webhook-mcp",
        "name": "MCP Request",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          400
        ],
        "webhookId": "mcp-connector"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $env.MCP_SERVER_URL }}/jsonrpc",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "application/json"
              },
              {
                "name": "Authorization",
                "value": "Bearer {{ $env.MCP_API_KEY }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"jsonrpc\": \"2.0\",\n  \"id\": \"{{ $json.request_id || Date.now() }}\",\n  \"method\": \"{{ $json.method }}\",\n  \"params\": {{ JSON.stringify($json.params || {}) }}\n}"
        },
        "id": "mcp-call",
        "name": "Call MCP Server",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "jsCode": "const response = $input.item.json;\n\nif (response.error) {\n  throw new Error(`MCP Error: ${response.error.message}`);\n}\n\nreturn {\n  json: {\n    success: true,\n    result: response.result,\n    method_called: $('MCP Request').first().json.method,\n    timestamp: new Date().toISOString()\n  }\n};"
        },
        "id": "parse-response",
        "name": "Parse Response",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          750,
          400
        ]
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={{ $json }}",
          "options": {}
        },
        "id": "respond",
        "name": "Respond",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1,
        "position": [
          1000,
          400
        ]
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "minutes",
                "minutesInterval": 5
              }
            ]
          }
        },
        "id": "health-check",
        "name": "Health Check",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.1,
        "position": [
          250,
          600
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $env.MCP_SERVER_URL }}/jsonrpc",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "{ \"jsonrpc\": \"2.0\", \"id\": \"health\", \"method\": \"system/health\" }"
        },
        "id": "ping-server",
        "name": "Ping MCP Server",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          600
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          500,
          800
        ]
      },
      {
        "parameters": {
          "channel": "#mcp-alerts",
          "text": "=ðŸš¨ MCP Connector Error\n\nNode: {{ $json.execution.lastNodeExecuted }}\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          750,
          800
        ]
      }
    ],
    "connections": {
      "MCP Request": {
        "main": [
          [
            {
              "node": "Call MCP Server",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Call MCP Server": {
        "main": [
          [
            {
              "node": "Parse Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Response": {
        "main": [
          [
            {
              "node": "Respond",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Health Check": {
        "main": [
          [
            {
              "node": "Ping MCP Server",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Trigger": {
        "main": [
          [
            {
              "node": "Error Alert",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain NPS Feedback Collection v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-45mr7o84w",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "content": "## ðŸ“Š NPS & Feedback Collection\nAutomated Net Promoter Score surveys with AI-powered sentiment analysis.",
          "height": 100,
          "width": 350,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 10 * * 1"
              }
            ]
          }
        },
        "id": "weekly-trigger",
        "name": "Weekly NPS Send",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.1,
        "position": [
          250,
          400
        ]
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Customers"
          }
        },
        "id": "get-customers",
        "name": "Get Customers",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "conditions": {
            "conditions": [
              {
                "leftValue": "={{ $json.last_nps_sent }}",
                "rightValue": "={{ $now.minus({days: 90}).toISO() }}",
                "operator": {
                  "type": "string",
                  "operation": "lt"
                }
              }
            ]
          }
        },
        "id": "filter-eligible",
        "name": "Filter Eligible",
        "type": "n8n-nodes-base.filter",
        "typeVersion": 2,
        "position": [
          750,
          400
        ]
      },
      {
        "parameters": {
          "sendTo": "={{ $json.email }}",
          "subject": "Sizin iÃ§in ne kadar Ã¶nemliyiz? (1 dakikalÄ±k anket)",
          "message": "=Merhaba {{ $json.name }},\n\nBizi 0-10 arasÄ±nda puanlayÄ±n:\n\nðŸ”— Anket Linki: {{ $env.NPS_SURVEY_URL }}?customer_id={{ $json.customer_id }}\n\nTeÅŸekkÃ¼rler!",
          "options": {}
        },
        "id": "send-survey",
        "name": "Send NPS Email",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          1000,
          400
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "nps-response",
          "options": {}
        },
        "id": "webhook-response",
        "name": "NPS Response",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          650
        ],
        "webhookId": "nps-response"
      },
      {
        "parameters": {
          "jsCode": "const score = parseInt($input.item.json.nps_score);\nlet category = 'Passive';\nif (score >= 9) category = 'Promoter';\nelse if (score <= 6) category = 'Detractor';\n\nreturn {\n  json: {\n    ...$input.item.json,\n    nps_score: score,\n    category: category,\n    is_detractor: score <= 6\n  }\n};"
        },
        "id": "calc-category",
        "name": "Calculate Category",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          500,
          650
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Analyze NPS feedback. Return JSON:\n{ \"sentiment\": \"positive/neutral/negative\", \"themes\": [], \"action_required\": true/false, \"suggested_action\": \"...\" }"
              },
              {
                "role": "user",
                "content": "Score: {{ $json.nps_score }}\nFeedback: {{ $json.feedback }}"
              }
            ]
          },
          "jsonOutput": true
        },
        "id": "ai-analyze",
        "name": "AI Analyze Feedback",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          750,
          650
        ]
      },
      {
        "parameters": {
          "conditions": {
            "conditions": [
              {
                "leftValue": "={{ $json.is_detractor }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "true"
                }
              }
            ]
          }
        },
        "id": "is-detractor",
        "name": "Is Detractor?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          1000,
          650
        ]
      },
      {
        "parameters": {
          "channel": "#customer-success",
          "text": "=ðŸš¨ **Detractor Alert**\n\nCustomer: {{ $json.customer_id }}\nNPS Score: {{ $json.nps_score }}/10\nFeedback: {{ $json.feedback }}\n\nðŸ‘‰ Action: {{ $json.suggested_action }}",
          "otherOptions": {}
        },
        "id": "alert-cs",
        "name": "Alert CS Team",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1250,
          550
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $env.N8N_BASE_URL }}/webhook/churn-check",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={ \"customer_id\": \"{{ $json.customer_id }}\", \"nps_score\": {{ $json.nps_score }}, \"trigger_source\": \"nps_detractor\" }"
        },
        "id": "trigger-churn",
        "name": "â†’ Trigger Churn Check",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1500,
          550
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "NPS_Responses"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "customer_id": "={{ $json.customer_id }}",
              "score": "={{ $json.nps_score }}",
              "category": "={{ $json.category }}",
              "feedback": "={{ $json.feedback }}",
              "sentiment": "={{ $json.sentiment }}",
              "submitted_at": "={{ $now.toISO() }}"
            }
          }
        },
        "id": "save-response",
        "name": "Save Response",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          1250,
          750
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          500,
          900
        ]
      },
      {
        "parameters": {
          "channel": "#system-alerts",
          "text": "=ðŸš¨ NPS Collection Error\n\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          750,
          900
        ]
      }
    ],
    "connections": {
      "Weekly NPS Send": {
        "main": [
          [
            {
              "node": "Get Customers",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Customers": {
        "main": [
          [
            {
              "node": "Filter Eligible",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Filter Eligible": {
        "main": [
          [
            {
              "node": "Send NPS Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "NPS Response": {
        "main": [
          [
            {
              "node": "Calculate Category",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calculate Category": {
        "main": [
          [
            {
              "node": "AI Analyze Feedback",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Analyze Feedback": {
        "main": [
          [
            {
              "node": "Is Detractor?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Is Detractor?": {
        "main": [
          [
            {
              "node": "Alert CS Team",
              "type": "main",
              "index": 0
            },
            {
              "node": "Save Response",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Save Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Trigger": {
        "main": [
          [
            {
              "node": "Error Alert",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Referral Affiliate Program v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-y24ehpwzw",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "referral-signup",
          "options": {}
        },
        "id": "webhook-referral",
        "name": "Referral Signup",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          300
        ],
        "webhookId": "referral-program"
      },
      {
        "parameters": {
          "jsCode": "const ref = $input.item.json;\nconst code = `REF-${ref.user_id.slice(0,4).toUpperCase()}-${Date.now().toString(36).toUpperCase()}`;\nreturn { json: { ...ref, referral_code: code, commission_rate: 0.2 } };"
        },
        "id": "gen-code",
        "name": "Generate Referral Code",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          500,
          300
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Affiliates"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "user_id": "={{ $json.user_id }}",
              "email": "={{ $json.email }}",
              "referral_code": "={{ $json.referral_code }}",
              "commission_rate": "={{ $json.commission_rate }}",
              "total_earnings": "0"
            }
          }
        },
        "id": "save-affiliate",
        "name": "Save Affiliate",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          750,
          300
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "referral-conversion",
          "options": {}
        },
        "id": "webhook-conversion",
        "name": "Conversion Event",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          550
        ],
        "webhookId": "referral-conversion"
      },
      {
        "parameters": {
          "jsCode": "const conv = $input.item.json;\nconst commission = conv.order_value * 0.2;\nreturn { json: { ...conv, commission_earned: commission } };"
        },
        "id": "calc-commission",
        "name": "Calculate Commission",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          500,
          550
        ]
      },
      {
        "parameters": {
          "channel": "affiliate-wins",
          "text": "=ðŸ’° **Referral Conversion!**\n\nAffiliate: {{ $json.referrer_email }}\nOrder Value: ${{ $json.order_value }}\nCommission: ${{ $json.commission_earned }}",
          "otherOptions": {}
        },
        "id": "slack-notify",
        "name": "Notify Conversion",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          750,
          550
        ]
      }
    ],
    "connections": {
      "Referral Signup": {
        "main": [
          [
            {
              "node": "Generate Referral Code",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate Referral Code": {
        "main": [
          [
            {
              "node": "Save Affiliate",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Conversion Event": {
        "main": [
          [
            {
              "node": "Calculate Commission",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calculate Commission": {
        "main": [
          [
            {
              "node": "Notify Conversion",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Self-Healing Data Pipeline v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-ssua09zgx",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "content": "## ðŸ¥ Self-Healing Data Pipeline\nAutonomous infrastructure that detects failures, attempts self-correction, and optimizes retry strategies.",
          "height": 100,
          "width": 350,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "minutes",
                "minutesInterval": 10
              }
            ]
          }
        },
        "id": "monitor-trigger",
        "name": "Health Monitor",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.1,
        "position": [
          250,
          400
        ]
      },
      {
        "parameters": {
          "url": "={{ $env.CORE_API_URL }}/health",
          "options": {
            "allowUnauthorizedCerts": true
          }
        },
        "id": "check-api",
        "name": "Check Core API",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "conditions": {
            "conditions": [
              {
                "leftValue": "={{ $json.status }}",
                "rightValue": "200",
                "operator": {
                  "type": "number",
                  "operation": "neq"
                }
              }
            ]
          }
        },
        "id": "is-failed",
        "name": "Is Failed?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          750,
          400
        ]
      },
      {
        "parameters": {
          "jsCode": "const attempt = $json.retry_count || 0;\nconst maxRetries = 3;\n\nif (attempt < maxRetries) {\n  return { json: { action: 'retry', next_attempt: attempt + 1, wait_time: Math.pow(2, attempt) * 1000 } };\n} else {\n  return { json: { action: 'escalate' } };\n}"
        },
        "id": "healing-strategy",
        "name": "Determine Strategy",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1000,
          400
        ]
      },
      {
        "parameters": {
          "dataType": "string",
          "value1": "={{ $json.action }}",
          "rules": {
            "rules": [
              {
                "value2": "retry",
                "output": 0
              },
              {
                "value2": "escalate",
                "output": 1
              }
            ]
          },
          "fallbackOutput": 2
        },
        "id": "execute-strategy",
        "name": "Execute Strategy",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          1250,
          400
        ]
      },
      {
        "parameters": {
          "amount": "={{ $json.wait_time }}",
          "unit": "milliseconds"
        },
        "id": "wait-node",
        "name": "Dynamic Backoff",
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1,
        "position": [
          1500,
          300
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $env.CORE_API_URL }}/restart-service",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Bearer {{ $env.ADMIN_KEY }}"
              }
            ]
          }
        },
        "id": "restart-service",
        "name": "Self-Heal: Restart",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1750,
          300
        ]
      },
      {
        "parameters": {
          "channel": "#devops-critical",
          "text": "=ðŸš¨ **Self-Healing Failed**\n\nService: Core API\nRetries: 3\nAction: Manual Intervention Required",
          "otherOptions": {}
        },
        "id": "escalate-alert",
        "name": "Escalate to Human",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1500,
          500
        ]
      },
      {
        "parameters": {
          "channel": "#system-logs",
          "text": "=âœ… **Self-Healing Action Taken**\n\nStrategy: Restart Service\nAttempt: {{ $json.next_attempt }}",
          "otherOptions": {}
        },
        "id": "log-healing",
        "name": "Log Healing",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          2000,
          300
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          1000,
          650
        ]
      },
      {
        "parameters": {
          "channel": "#system-alerts",
          "text": "=ðŸš¨ Self-Healing Loop Error\n\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1250,
          650
        ]
      }
    ],
    "connections": {
      "Health Monitor": {
        "main": [
          [
            {
              "node": "Check Core API",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check Core API": {
        "main": [
          [
            {
              "node": "Is Failed?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Is Failed?": {
        "main": [
          [
            {
              "node": "Determine Strategy",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Determine Strategy": {
        "main": [
          [
            {
              "node": "Execute Strategy",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Execute Strategy": {
        "main": [
          [
            {
              "node": "Dynamic Backoff",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Escalate to Human",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Dynamic Backoff": {
        "main": [
          [
            {
              "node": "Self-Heal: Restart",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Self-Heal: Restart": {
        "main": [
          [
            {
              "node": "Log Healing",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Trigger": {
        "main": [
          [
            {
              "node": "Error Alert",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Social Inbox Manager v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-nwblobgou",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "minutes",
                "minutesInterval": 15
              }
            ]
          }
        },
        "id": "schedule-check",
        "name": "Check Every 15 Min",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.1,
        "position": [
          250,
          300
        ]
      },
      {
        "parameters": {
          "url": "https://graph.facebook.com/v19.0/{{ $env.FB_PAGE_ID }}/conversations",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "access_token",
                "value": "={{ $env.FB_ACCESS_TOKEN }}"
              }
            ]
          }
        },
        "id": "fetch-fb-messages",
        "name": "Fetch FB Messages",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          200
        ]
      },
      {
        "parameters": {
          "url": "https://graph.facebook.com/v19.0/{{ $env.IG_USER_ID }}/conversations",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "access_token",
                "value": "={{ $env.IG_ACCESS_TOKEN }}"
              }
            ]
          }
        },
        "id": "fetch-ig-messages",
        "name": "Fetch IG Messages",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {},
        "id": "merge-messages",
        "name": "Merge All",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2,
        "position": [
          750,
          300
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Classify message intent: SUPPORT, INQUIRY, FEEDBACK, SPAM. Suggest a brief reply if not SPAM. Output JSON: { \"intent\": \"...\", \"suggested_reply\": \"...\" }"
              },
              {
                "role": "user",
                "content": "Message: {{ $json.message }}"
              }
            ]
          },
          "jsonOutput": true
        },
        "id": "ai-classify",
        "name": "AI Classify",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          1000,
          300
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Social_Inbox"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "platform": "={{ $json.platform }}",
              "message": "={{ $json.message }}",
              "intent": "={{ $json.intent }}",
              "suggested_reply": "={{ $json.suggested_reply }}",
              "timestamp": "={{ $now.toISO() }}"
            }
          }
        },
        "id": "log-inbox",
        "name": "Log to Inbox",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          1250,
          300
        ]
      }
    ],
    "connections": {
      "Check Every 15 Min": {
        "main": [
          [
            {
              "node": "Fetch FB Messages",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch IG Messages",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch FB Messages": {
        "main": [
          [
            {
              "node": "Merge All",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch IG Messages": {
        "main": [
          [
            {
              "node": "Merge All",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Merge All": {
        "main": [
          [
            {
              "node": "AI Classify",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Classify": {
        "main": [
          [
            {
              "node": "Log to Inbox",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Subscription Lifecycle Manager v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-lr59jolwy",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "content": "## ðŸ”„ Subscription Lifecycle Manager\nManages SaaS subscription states: trial â†’ active â†’ renewal â†’ churn prevention.",
          "height": 100,
          "width": 350,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "hours",
                "hoursInterval": 6
              }
            ]
          }
        },
        "id": "check-subscriptions",
        "name": "Check Subscriptions",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.1,
        "position": [
          250,
          400
        ]
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Subscriptions"
          }
        },
        "id": "get-subs",
        "name": "Get Subscriptions",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "jsCode": "const sub = $input.item.json;\nconst now = new Date();\nconst endDate = new Date(sub.end_date);\nconst trialEnd = sub.trial_end ? new Date(sub.trial_end) : null;\nconst daysUntilEnd = Math.floor((endDate - now) / (1000 * 60 * 60 * 24));\nconst daysUntilTrialEnd = trialEnd ? Math.floor((trialEnd - now) / (1000 * 60 * 60 * 24)) : null;\n\nlet lifecycle_stage = sub.status;\nlet action_needed = null;\n\nif (sub.status === 'trial' && daysUntilTrialEnd !== null) {\n  if (daysUntilTrialEnd === 3) action_needed = 'trial_ending_soon';\n  else if (daysUntilTrialEnd === 0) action_needed = 'trial_expired';\n} else if (sub.status === 'active') {\n  if (daysUntilEnd === 30) action_needed = 'renewal_reminder_30d';\n  else if (daysUntilEnd === 7) action_needed = 'renewal_reminder_7d';\n  else if (daysUntilEnd === 1) action_needed = 'renewal_urgent';\n  else if (daysUntilEnd <= 0) action_needed = 'expired';\n}\n\nreturn {\n  json: {\n    ...sub,\n    days_until_end: daysUntilEnd,\n    days_until_trial_end: daysUntilTrialEnd,\n    lifecycle_stage: lifecycle_stage,\n    action_needed: action_needed,\n    needs_action: action_needed !== null\n  }\n};"
        },
        "id": "calc-lifecycle",
        "name": "Calculate Lifecycle",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          750,
          400
        ]
      },
      {
        "parameters": {
          "conditions": {
            "conditions": [
              {
                "leftValue": "={{ $json.needs_action }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "true"
                }
              }
            ]
          }
        },
        "id": "filter-action",
        "name": "Needs Action?",
        "type": "n8n-nodes-base.filter",
        "typeVersion": 2,
        "position": [
          1000,
          400
        ]
      },
      {
        "parameters": {
          "dataType": "string",
          "value1": "={{ $json.action_needed }}",
          "rules": {
            "rules": [
              {
                "value2": "trial_ending_soon",
                "output": 0
              },
              {
                "value2": "trial_expired",
                "output": 1
              },
              {
                "value2": "renewal_reminder_30d",
                "output": 2
              },
              {
                "value2": "renewal_reminder_7d",
                "output": 2
              },
              {
                "value2": "renewal_urgent",
                "output": 3
              },
              {
                "value2": "expired",
                "output": 4
              }
            ]
          },
          "fallbackOutput": 5
        },
        "id": "route-action",
        "name": "Route Action",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          1250,
          400
        ]
      },
      {
        "parameters": {
          "sendTo": "={{ $json.email }}",
          "subject": "Deneme sÃ¼reniz bitiyor - {{ $json.days_until_trial_end }} gÃ¼n kaldÄ±!",
          "message": "=Merhaba {{ $json.customer_name }},\n\nDeneme sÃ¼renizin bitmesine {{ $json.days_until_trial_end }} gÃ¼n kaldÄ±.\n\nÅžimdi planÄ±nÄ±zÄ± yÃ¼kseltin ve tÃ¼m Ã¶zelliklere eriÅŸin:\n{{ $env.UPGRADE_URL }}",
          "options": {}
        },
        "id": "email-trial-ending",
        "name": "Trial Ending Email",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          1500,
          200
        ]
      },
      {
        "parameters": {
          "sendTo": "={{ $json.email }}",
          "subject": "Deneme sÃ¼reniz doldu - Ã–zel teklif!",
          "message": "=Merhaba {{ $json.customer_name }},\n\nDeneme sÃ¼reniz sona erdi. Sizi kaybetmek istemiyoruz!\n\nðŸŽ Ã–zel Teklif: Ä°lk ay %50 indirim\n{{ $env.SPECIAL_OFFER_URL }}",
          "options": {}
        },
        "id": "email-trial-expired",
        "name": "Trial Expired Email",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          1500,
          350
        ]
      },
      {
        "parameters": {
          "sendTo": "={{ $json.email }}",
          "subject": "AboneliÄŸiniz yenileniyor - {{ $json.days_until_end }} gÃ¼n",
          "message": "=Merhaba {{ $json.customer_name }},\n\nAboneliÄŸiniz {{ $json.days_until_end }} gÃ¼n iÃ§inde yenilenecek.\n\nPlan: {{ $json.plan }}\nTutar: {{ $json.amount }} {{ $json.currency }}",
          "options": {}
        },
        "id": "email-renewal",
        "name": "Renewal Reminder",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          1500,
          500
        ]
      },
      {
        "parameters": {
          "channel": "#sales-urgent",
          "text": "=ðŸš¨ **Urgent Renewal**\n\nCustomer: {{ $json.customer_name }}\nPlan: {{ $json.plan }}\nExpires: Tomorrow!\n\nðŸ‘‰ Immediate outreach required",
          "otherOptions": {}
        },
        "id": "slack-urgent",
        "name": "Urgent Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1500,
          650
        ]
      },
      {
        "parameters": {
          "channel": "#churn-alerts",
          "text": "=âŒ **Subscription Expired**\n\nCustomer: {{ $json.customer_name }}\nPlan: {{ $json.plan }}\nMRR Lost: {{ $json.amount }} {{ $json.currency }}",
          "otherOptions": {}
        },
        "id": "slack-expired",
        "name": "Churn Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1500,
          800
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          750,
          650
        ]
      },
      {
        "parameters": {
          "channel": "#system-alerts",
          "text": "=ðŸš¨ Subscription Lifecycle Error\n\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1000,
          650
        ]
      }
    ],
    "connections": {
      "Check Subscriptions": {
        "main": [
          [
            {
              "node": "Get Subscriptions",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Subscriptions": {
        "main": [
          [
            {
              "node": "Calculate Lifecycle",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calculate Lifecycle": {
        "main": [
          [
            {
              "node": "Needs Action?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Needs Action?": {
        "main": [
          [
            {
              "node": "Route Action",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Route Action": {
        "main": [
          [
            {
              "node": "Trial Ending Email",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Trial Expired Email",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Renewal Reminder",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Urgent Alert",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Churn Alert",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Trigger": {
        "main": [
          [
            {
              "node": "Error Alert",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Unified Analytics Dashboard v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-lc4cb94b7",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 8 * * 1-5"
              }
            ]
          }
        },
        "id": "schedule-dash",
        "name": "Daily Morning Report",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.1,
        "position": [
          250,
          300
        ]
      },
      {
        "parameters": {
          "jsCode": "// Mock Data Aggregation\nreturn {\n  json: {\n    revenue: { daily: 1500, mrr: 45000, growth: 5 },\n    marketing: { leads: 12, cpl: 25, visitors: 1200 },\n    support: { tickets: 5, avg_response: \"2h\" },\n    product: { active_users: 850, churn_rate: 1.2 }\n  }\n};"
        },
        "id": "agg-metrics",
        "name": "Aggregate Metrics",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          450,
          300
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are a Chief Data Officer. Analyze these daily metrics. Identify 1 key trend and 1 area of concern. Write a concise executive summary for Slack (max 5 lines, use emojis)."
              },
              {
                "role": "user",
                "content": "Metrics: {{ JSON.stringify($json) }}"
              }
            ]
          },
          "jsonOutput": false
        },
        "id": "ai-insights",
        "name": "Generate AI Insights",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          650,
          300
        ]
      },
      {
        "parameters": {
          "channel": "executive-briefing",
          "text": "=ðŸ“Š **Daily Executive Briefing**\n{{ $json.message.content }}\n\nðŸ’¸ **Revenue:** ${{ $json.revenue.daily }} (MRR: ${{ $json.revenue.mrr }})\nðŸ‘¥ **Growth:** {{ $json.marketing.leads }} New Leads\nðŸ“‰ **Churn:** {{ $json.product.churn_rate }}%",
          "otherOptions": {}
        },
        "id": "slack-report",
        "name": "Send Slack Report",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          900,
          300
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Daily_Stats"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "date": "={{ $now.toFormat('yyyy-MM-dd') }}",
              "revenue": "={{ $json.revenue.daily }}",
              "mrr": "={{ $json.revenue.mrr }}",
              "active_users": "={{ $json.product.active_users }}"
            }
          }
        },
        "id": "archive-stats",
        "name": "Archive to Sheets",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          900,
          500
        ]
      }
    ],
    "connections": {
      "Daily Morning Report": {
        "main": [
          [
            {
              "node": "Aggregate Metrics",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate Metrics": {
        "main": [
          [
            {
              "node": "Generate AI Insights",
              "type": "main",
              "index": 0
            },
            {
              "node": "Archive to Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate AI Insights": {
        "main": [
          [
            {
              "node": "Send Slack Report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Booking Channel Sync v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-25canjs0u",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "minutes",
                "minutesInterval": 10
              }
            ]
          }
        },
        "id": "schedule-sync",
        "name": "Sync Every 10 Min",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.1,
        "position": [
          250,
          300
        ]
      },
      {
        "parameters": {
          "url": "https://api.channex.io/api/v1/properties/{{ $env.PROPERTY_ID }}/availability",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Bearer {{ $env.CHANNEX_API_KEY }}"
              }
            ]
          }
        },
        "id": "fetch-channex",
        "name": "Fetch Channex Availability",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          300
        ]
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Room_Inventory"
          }
        },
        "id": "fetch-local",
        "name": "Fetch Local Inventory",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          500,
          500
        ]
      },
      {
        "parameters": {
          "jsCode": "const channex = $input.all()[0].json;\nconst local = $input.all()[1].json;\n\n// Compare and find discrepancies\nconst discrepancies = [];\n// ... comparison logic ...\n\nreturn { json: { sync_needed: discrepancies.length > 0, discrepancies } };"
        },
        "id": "compare-inventory",
        "name": "Compare Inventory",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          750,
          400
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "sync-check",
                "leftValue": "={{ $json.sync_needed }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "true"
                }
              }
            ],
            "combinator": "and"
          }
        },
        "id": "check-sync",
        "name": "Sync Needed?",
        "type": "n8n-nodes-base.filter",
        "typeVersion": 2,
        "position": [
          1000,
          400
        ]
      },
      {
        "parameters": {
          "method": "PUT",
          "url": "https://api.channex.io/api/v1/properties/{{ $env.PROPERTY_ID }}/availability",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Bearer {{ $env.CHANNEX_API_KEY }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ JSON.stringify($json.discrepancies) }}"
        },
        "id": "push-update",
        "name": "Push Updates to OTAs",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1250,
          400
        ]
      },
      {
        "parameters": {
          "channel": "hotel-ops",
          "text": "=âœ… **Channel Sync Complete**\n\nUpdated {{ $json.discrepancies.length }} rooms across OTAs.",
          "otherOptions": {}
        },
        "id": "notify-sync",
        "name": "Notify Sync Complete",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1500,
          400
        ]
      }
    ],
    "connections": {
      "Sync Every 10 Min": {
        "main": [
          [
            {
              "node": "Fetch Channex Availability",
              "type": "main",
              "index": 0
            },
            {
              "node": "Fetch Local Inventory",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Channex Availability": {
        "main": [
          [
            {
              "node": "Compare Inventory",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Local Inventory": {
        "main": [
          [
            {
              "node": "Compare Inventory",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Compare Inventory": {
        "main": [
          [
            {
              "node": "Sync Needed?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Sync Needed?": {
        "main": [
          [
            {
              "node": "Push Updates to OTAs",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Push Updates to OTAs": {
        "main": [
          [
            {
              "node": "Notify Sync Complete",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Guest Communication Journey v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-0uq9uc9xa",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {},
        "id": "webhook-booking",
        "name": "New Booking",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          200,
          400
        ],
        "webhookId": "guest-booking"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 9 * * *"
              }
            ]
          }
        },
        "id": "daily-check",
        "name": "Daily Check",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          200,
          600
        ],
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "jsCode": "const booking = $input.item.json;\nconst checkin = new Date(booking.checkin_date);\nconst checkout = new Date(booking.checkout_date);\nconst now = new Date();\nconst daysUntilArrival = Math.ceil((checkin - now) / (1000 * 60 * 60 * 24));\nconst daysUntilCheckout = Math.ceil((checkout - now) / (1000 * 60 * 60 * 24));\n\nlet messageType = null;\nif (daysUntilArrival === 7) messageType = 'pre_arrival_7d';\nelse if (daysUntilArrival === 1) messageType = 'pre_arrival_1d';\nelse if (daysUntilArrival === 0) messageType = 'arrival_day';\nelse if (daysUntilCheckout === 0) messageType = 'checkout_day';\nelse if (daysUntilCheckout === -1) messageType = 'post_checkout';\nelse if (daysUntilCheckout === -3) messageType = 'review_request';\n\nreturn {\n  json: {\n    ...booking,\n    message_type: messageType,\n    days_until_arrival: daysUntilArrival,\n    should_message: messageType !== null\n  }\n};"
        },
        "id": "calc-timing",
        "name": "Calculate Timing",
        "type": "n8n-nodes-base.code",
        "position": [
          450,
          400
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "conditions": {
            "conditions": [
              {
                "leftValue": "={{ $json.should_message }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "true"
                }
              }
            ]
          }
        },
        "id": "should-msg",
        "name": "Should Message?",
        "type": "n8n-nodes-base.if",
        "position": [
          650,
          400
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "model": "gpt-4o-mini",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Otel misafir iletiÅŸimi uzmanÄ±sÄ±n. Mesaj tÃ¼rÃ¼ne gÃ¶re kiÅŸiselleÅŸtirilmiÅŸ mesaj yaz:\n\n- pre_arrival_7d: Heyecan verici, upsell fÄ±rsatÄ± (spa, transfer)\n- pre_arrival_1d: Check-in detaylarÄ±, saat bilgisi\n- arrival_day: HoÅŸgeldin, oda hazÄ±r bilgisi\n- checkout_day: TeÅŸekkÃ¼r, feedback linki\n- post_checkout: Ã–zledik mesajÄ±\n- review_request: Google/Tripadvisor yorum ricasÄ±\n\nJSON dÃ¶ndÃ¼r: {\"subject\": \"\", \"message\": \"\", \"upsell_offer\": null}"
              },
              {
                "role": "user",
                "content": "=Guest: {{ $json.guest_name }}\nType: {{ $json.message_type }}\nRoom: {{ $json.room_type }}\nNights: {{ $json.nights }}"
              }
            ]
          }
        },
        "id": "ai-message",
        "name": "AI Generate Message",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          850,
          400
        ],
        "typeVersion": 1.4
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://graph.facebook.com/v18.0/{{ $env.WHATSAPP_PHONE_ID }}/messages",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"to\": \"{{ $json.guest_phone }}\",\n  \"type\": \"text\",\n  \"text\": { \"body\": \"{{ $json.ai_message }}\" }\n}"
        },
        "id": "send-whatsapp",
        "name": "Send WhatsApp",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1050,
          300
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "sendTo": "={{ $json.guest_email }}",
          "subject": "={{ $json.subject }}",
          "message": "={{ $json.message }}",
          "options": {}
        },
        "id": "send-email",
        "name": "Send Email",
        "type": "n8n-nodes-base.gmail",
        "position": [
          1050,
          500
        ],
        "typeVersion": 2.1
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Guest_Communications"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "booking_id": "={{ $json.booking_id }}",
              "guest_name": "={{ $json.guest_name }}",
              "message_type": "={{ $json.message_type }}",
              "sent_at": "={{ $now.toISO() }}"
            }
          }
        },
        "id": "log-msg",
        "name": "Log Communication",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          1250,
          400
        ],
        "typeVersion": 4.2
      }
    ],
    "connections": {
      "New Booking": {
        "main": [
          [
            {
              "node": "Calculate Timing",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Daily Check": {
        "main": [
          [
            {
              "node": "Calculate Timing",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calculate Timing": {
        "main": [
          [
            {
              "node": "Should Message?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Should Message?": {
        "main": [
          [
            {
              "node": "AI Generate Message",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Generate Message": {
        "main": [
          [
            {
              "node": "Send WhatsApp",
              "type": "main",
              "index": 0
            },
            {
              "node": "Send Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send WhatsApp": {
        "main": [
          [
            {
              "node": "Log Communication",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send Email": {
        "main": [
          [
            {
              "node": "Log Communication",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "tags": [
      {
        "name": "hospitality"
      },
      {
        "name": "guest-communication"
      }
    ]
  },
  {
    "name": "Grain Restaurant Reservation v2 (Optimized)",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-o2zt8jtmg",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "content": "## ðŸŸ¢ Trigger & Schedule\nReceives new reservations via Webhook and checks daily for reminders.",
          "height": 160,
          "width": 240,
          "color": 4
        },
        "id": "note-trigger",
        "name": "Note: Trigger",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "reservation",
          "options": {}
        },
        "id": "webhook-reservation",
        "name": "New Reservation",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          220,
          400
        ],
        "webhookId": "restaurant-reservation"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 10 * * *"
              }
            ]
          }
        },
        "id": "daily-reminder",
        "name": "Daily Reminders",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.1,
        "position": [
          220,
          600
        ]
      },
      {
        "parameters": {
          "jsCode": "const res = $input.item.json;\nconst resDate = new Date(res.reservation_date + 'T' + res.reservation_time);\nconst now = new Date();\nconst hoursUntil = (resDate - now) / (1000 * 60 * 60);\n\nreturn {\n  json: {\n    ...res,\n    reservation_datetime: resDate.toISOString(),\n    hours_until: Math.round(hoursUntil),\n    should_confirm: hoursUntil > 20 && hoursUntil < 28,\n    should_remind: hoursUntil > 1 && hoursUntil < 4\n  }\n};"
        },
        "id": "calc-timing",
        "name": "Calculate Timing",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "content": "## ðŸ§  Logic Core\nCalculates time difference to determine if a Confirmation or Reminder message is needed.",
          "height": 160,
          "width": 240,
          "color": 5
        },
        "id": "note-logic",
        "name": "Note: Logic",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          460,
          200
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://graph.facebook.com/v18.0/{{ $env.WHATSAPP_PHONE_ID }}/messages",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Bearer {{ $env.WHATSAPP_TOKEN }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"to\": \"{{ $json.phone }}\",\n  \"type\": \"interactive\",\n  \"interactive\": {\n    \"type\": \"button\",\n    \"body\": { \"text\": \"{{ $json.guest_name }} Bey/HanÄ±m, yarÄ±n saat {{ $json.reservation_time }} iÃ§in rezervasyonunuzu onaylÄ±yor musunuz?\" },\n    \"action\": {\n      \"buttons\": [\n        { \"type\": \"reply\", \"reply\": { \"id\": \"confirm_yes\", \"title\": \"âœ… Evet\" } },\n        { \"type\": \"reply\", \"reply\": { \"id\": \"confirm_no\", \"title\": \"âŒ Ä°ptal\" } }\n      ]\n    }\n  }\n}"
        },
        "id": "send-confirmation",
        "name": "Send Confirmation (WA)",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          800,
          300
        ]
      },
      {
        "parameters": {
          "resource": "event",
          "calendarId": {
            "__rl": true,
            "mode": "list",
            "value": "={{ $env.CALENDAR_ID }}"
          },
          "start": "={{ $json.reservation_datetime }}",
          "end": "={{ new Date(new Date($json.reservation_datetime).getTime() + 7200000).toISOString() }}",
          "additionalFields": {
            "summary": "=Rezervasyon: {{ $json.guest_name }}",
            "description": "=Tel: {{ $json.phone }}"
          }
        },
        "id": "google-calendar",
        "name": "Add to Calendar",
        "type": "n8n-nodes-base.googleCalendar",
        "typeVersion": 3,
        "position": [
          1050,
          400
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Reservations"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "name": "={{ $json.guest_name }}",
              "time": "={{ $json.reservation_datetime }}",
              "status": "Confirmed"
            }
          }
        },
        "id": "google-sheets",
        "name": "Save to Sheets",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          1250,
          400
        ]
      },
      {
        "parameters": {
          "channel": "reservations",
          "text": "=ðŸŽ‰ **New Booking**\nGuest: {{ $json.guest_name }}\nTime: {{ $json.reservation_time }}",
          "otherOptions": {}
        },
        "id": "slack-notify",
        "name": "Notify Team",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1450,
          400
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          800,
          800
        ]
      },
      {
        "parameters": {
          "channel": "system-alerts",
          "text": "=ðŸš¨ **Workflow Error**\nWorkflow: Restaurant Reservation\nNode: {{ $json.execution.lastNodeExecuted }}\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-alert",
        "name": "Alert Dev Team",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1000,
          800
        ]
      },
      {
        "parameters": {
          "content": "## ðŸ”´ Error Handling\nAny failure in the workflow triggers this section to notify the dev team immediately.",
          "height": 160,
          "width": 240,
          "color": 7
        },
        "id": "note-error",
        "name": "Note: Error",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          760,
          700
        ]
      }
    ],
    "connections": {
      "New Reservation": {
        "main": [
          [
            {
              "node": "Calculate Timing",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Daily Reminders": {
        "main": [
          [
            {
              "node": "Calculate Timing",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calculate Timing": {
        "main": [
          [
            {
              "node": "Send Confirmation (WA)",
              "type": "main",
              "index": 0
            },
            {
              "node": "Add to Calendar",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Add to Calendar": {
        "main": [
          [
            {
              "node": "Save to Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Save to Sheets": {
        "main": [
          [
            {
              "node": "Notify Team",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Trigger": {
        "main": [
          [
            {
              "node": "Alert Dev Team",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Review Management v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-c666onq1x",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 */4 * * *"
              }
            ]
          }
        },
        "id": "check-reviews",
        "name": "Check Reviews",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          200,
          400
        ],
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "method": "GET",
          "url": "=https://mybusiness.googleapis.com/v4/accounts/{{ $env.GBP_ACCOUNT_ID }}/locations/{{ $env.GBP_LOCATION_ID }}/reviews",
          "authentication": "oAuth2",
          "options": {}
        },
        "id": "get-google-reviews",
        "name": "Get Google Reviews",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          400,
          400
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "jsCode": "const reviews = $input.item.json.reviews || [];\nconst oneDayAgo = new Date(Date.now() - 24 * 60 * 60 * 1000);\n\nconst newReviews = reviews.filter(r => {\n  const reviewDate = new Date(r.createTime);\n  return reviewDate > oneDayAgo && !r.reviewReply;\n}).map(r => ({\n  review_id: r.reviewId,\n  reviewer_name: r.reviewer?.displayName || 'Misafir',\n  rating: r.starRating === 'FIVE' ? 5 : r.starRating === 'FOUR' ? 4 : r.starRating === 'THREE' ? 3 : r.starRating === 'TWO' ? 2 : 1,\n  comment: r.comment || '',\n  create_time: r.createTime,\n  is_negative: r.starRating === 'ONE' || r.starRating === 'TWO'\n}));\n\nreturn newReviews.map(r => ({ json: r }));"
        },
        "id": "filter-new",
        "name": "Filter New Reviews",
        "type": "n8n-nodes-base.code",
        "position": [
          600,
          400
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "model": "gpt-4o-mini",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Ä°ÅŸletme sahibi olarak yorumlara profesyonel ve samimi yanÄ±tlar yaz.\n\nPozitif (4-5 yÄ±ldÄ±z): TeÅŸekkÃ¼r et, tekrar bekle\nNegatif (1-2 yÄ±ldÄ±z): Ã–zÃ¼r dile, sorunu Ã§Ã¶zmek iÃ§in iletiÅŸim iste\nOrta (3 yÄ±ldÄ±z): Geri bildirim iÃ§in teÅŸekkÃ¼r, iyileÅŸtirme sÃ¶zÃ¼ ver\n\nMax 150 kelime. Ä°ÅŸletme adÄ±nÄ± kullanma, genel tut."
              },
              {
                "role": "user",
                "content": "=Reviewer: {{ $json.reviewer_name }}\nRating: {{ $json.rating }}/5\nComment: {{ $json.comment }}"
              }
            ]
          }
        },
        "id": "ai-response",
        "name": "AI Generate Response",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          800,
          400
        ],
        "typeVersion": 1.4
      },
      {
        "parameters": {
          "conditions": {
            "conditions": [
              {
                "leftValue": "={{ $json.is_negative }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "true"
                }
              }
            ]
          }
        },
        "id": "is-negative",
        "name": "Is Negative?",
        "type": "n8n-nodes-base.if",
        "position": [
          1000,
          400
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "channel": "#urgent-reviews",
          "text": "=ðŸš¨ *Negatif Yorum AlÄ±ndÄ±!*\n\nâ­ Rating: {{ $json.rating }}/5\nðŸ‘¤ From: {{ $json.reviewer_name }}\n\nðŸ’¬ Yorum:\n{{ $json.comment }}\n\nâœï¸ Ã–nerilen YanÄ±t:\n{{ $('AI Generate Response').first().json.message.content }}\n\n_LÃ¼tfen 2 saat iÃ§inde yanÄ±tlayÄ±n!_",
          "otherOptions": {}
        },
        "id": "alert-negative",
        "name": "Alert Negative",
        "type": "n8n-nodes-base.slack",
        "position": [
          1200,
          300
        ],
        "typeVersion": 2.1
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Review_Log"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "review_id": "={{ $json.review_id }}",
              "reviewer": "={{ $json.reviewer_name }}",
              "rating": "={{ $json.rating }}",
              "comment": "={{ $json.comment }}",
              "suggested_reply": "={{ $('AI Generate Response').first().json.message.content }}",
              "status": "pending_approval",
              "created_at": "={{ $now.toISO() }}"
            }
          }
        },
        "id": "log-review",
        "name": "Log Review",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          1200,
          500
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "content": "## ðŸ”„ Workflow Overview\nChecks Google reviews every 4 hours, generates AI responses, and alerts on negative reviews.",
          "height": 100,
          "width": 300,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          250
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          600,
          650
        ]
      },
      {
        "parameters": {
          "channel": "#system-alerts",
          "text": "=ðŸš¨ Review Management Error\n\nNode: {{ $json.execution.lastNodeExecuted }}\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          800,
          650
        ]
      }
    ],
    "connections": {
      "Check Reviews": {
        "main": [
          [
            {
              "node": "Get Google Reviews",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Google Reviews": {
        "main": [
          [
            {
              "node": "Filter New Reviews",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Filter New Reviews": {
        "main": [
          [
            {
              "node": "AI Generate Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Generate Response": {
        "main": [
          [
            {
              "node": "Is Negative?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Is Negative?": {
        "main": [
          [
            {
              "node": "Alert Negative",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Log Review",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Alert Negative": {
        "main": [
          [
            {
              "node": "Log Review",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "tags": [
      {
        "name": "hospitality"
      },
      {
        "name": "reviews"
      },
      {
        "name": "reputation"
      }
    ]
  },
  {
    "name": "Grain Contract Review Compliance v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-ukjgx4vqm",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "content": "## ðŸ“„ Contract Review & Compliance\nAI-powered contract analysis for risk detection, clause extraction, and compliance checks.",
          "height": 100,
          "width": 350,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "contract-review",
          "options": {}
        },
        "id": "webhook-contract",
        "name": "Contract Upload",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          400
        ],
        "webhookId": "contract-review"
      },
      {
        "parameters": {
          "jsCode": "const input = $input.item.json;\nlet contractText = input.contract_text || '';\n\n// If PDF/DOCX, extract would happen here\nif (input.file_url) {\n  contractText = `[Document from: ${input.file_url}]`;\n}\n\nreturn {\n  json: {\n    contract_id: input.contract_id || `CON-${Date.now()}`,\n    contract_text: contractText,\n    contract_type: input.contract_type || 'general',\n    review_depth: input.review_depth || 'standard'\n  }\n};"
        },
        "id": "extract-text",
        "name": "Extract Text",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are a legal contract analyst. Analyze the contract and return a structured JSON report:\n\n{\n  \"risk_score\": 0-100,\n  \"risk_level\": \"LOW/MEDIUM/HIGH/CRITICAL\",\n  \"key_clauses\": [\n    {\"clause\": \"...\", \"type\": \"liability/termination/payment/ip\", \"risk\": \"low/medium/high\"}\n  ],\n  \"compliance_issues\": [],\n  \"missing_clauses\": [],\n  \"recommendations\": [],\n  \"summary\": \"2-3 sentence summary\"\n}"
              },
              {
                "role": "user",
                "content": "Contract Type: {{ $json.contract_type }}\nReview Depth: {{ $json.review_depth }}\n\nContract Text:\n{{ $json.contract_text.substring(0, 10000) }}"
              }
            ]
          },
          "jsonOutput": true
        },
        "id": "ai-analyze",
        "name": "AI Analyze Contract",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          750,
          400
        ]
      },
      {
        "parameters": {
          "dataType": "string",
          "value1": "={{ $json.risk_level }}",
          "rules": {
            "rules": [
              {
                "value2": "CRITICAL",
                "output": 0
              },
              {
                "value2": "HIGH",
                "output": 1
              }
            ]
          },
          "fallbackOutput": 2
        },
        "id": "risk-router",
        "name": "Risk Router",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          1000,
          400
        ]
      },
      {
        "parameters": {
          "channel": "#legal-alerts",
          "text": "=ðŸš¨ **Critical Contract Risk Detected**\n\nContract: {{ $json.contract_id }}\nRisk Score: {{ $json.risk_score }}/100\n\nâš ï¸ Issues:\n{{ $json.compliance_issues.join('\\n') }}\n\n_Immediate legal review required!_",
          "otherOptions": {}
        },
        "id": "critical-alert",
        "name": "Critical Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1250,
          300
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Contract_Reviews"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "contract_id": "={{ $json.contract_id }}",
              "risk_score": "={{ $json.risk_score }}",
              "risk_level": "={{ $json.risk_level }}",
              "summary": "={{ $json.summary }}",
              "reviewed_at": "={{ $now.toISO() }}"
            }
          }
        },
        "id": "save-review",
        "name": "Save Review",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          1250,
          500
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          750,
          650
        ]
      },
      {
        "parameters": {
          "channel": "#system-alerts",
          "text": "=ðŸš¨ Contract Review Error\n\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1000,
          650
        ]
      }
    ],
    "connections": {
      "Contract Upload": {
        "main": [
          [
            {
              "node": "Extract Text",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract Text": {
        "main": [
          [
            {
              "node": "AI Analyze Contract",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Analyze Contract": {
        "main": [
          [
            {
              "node": "Risk Router",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Risk Router": {
        "main": [
          [
            {
              "node": "Critical Alert",
              "type": "main",
              "index": 0
            },
            {
              "node": "Save Review",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Save Review",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Save Review",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Trigger": {
        "main": [
          [
            {
              "node": "Error Alert",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain HR Onboarding Offboarding v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-2svlkssna",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "hr-onboard",
          "options": {}
        },
        "id": "webhook-onboard",
        "name": "New Hire",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          300
        ],
        "webhookId": "hr-onboarding"
      },
      {
        "parameters": {
          "channel": "it-requests",
          "text": "=ðŸ†• **New Hire Setup Required**\n\nName: {{ $json.name }}\nDepartment: {{ $json.department }}\nStart Date: {{ $json.start_date }}\n\nðŸ‘‰ Please provision:\nâ€¢ Email account\nâ€¢ Slack access\nâ€¢ Relevant tool licenses",
          "otherOptions": {}
        },
        "id": "it-request",
        "name": "IT Setup Request",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          500,
          300
        ]
      },
      {
        "parameters": {
          "sendTo": "={{ $json.email }}",
          "subject": "HoÅŸ Geldiniz! Ä°lk GÃ¼nÃ¼nÃ¼ze HazÄ±rlÄ±k",
          "message": "Merhaba {{ $json.name }},\n\nEkibimize hoÅŸ geldiniz!\n\nBaÅŸlangÄ±Ã§ Tarihi: {{ $json.start_date }}\nYÃ¶neticiniz: {{ $json.manager }}\n\nÄ°lk gÃ¼nde yapÄ±lacaklar:\n1. IT'den hesap bilgilerinizi alÄ±n\n2. Ekip toplantÄ±sÄ±na katÄ±lÄ±n\n3. Onboarding dÃ¶kÃ¼manlarÄ±nÄ± inceleyin",
          "options": {}
        },
        "id": "welcome-email",
        "name": "Welcome Email",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          500,
          500
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "hr-offboard",
          "options": {}
        },
        "id": "webhook-offboard",
        "name": "Employee Exit",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          700
        ],
        "webhookId": "hr-offboarding"
      },
      {
        "parameters": {
          "channel": "it-requests",
          "text": "=ðŸšª **Employee Exit - Account Deactivation Required**\n\nName: {{ $json.name }}\nLast Day: {{ $json.last_day }}\n\nâš ï¸ Please deactivate:\nâ€¢ All accounts\nâ€¢ Revoke Slack access\nâ€¢ Remove from shared resources",
          "otherOptions": {}
        },
        "id": "deactivation-request",
        "name": "Deactivation Request",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          500,
          700
        ]
      }
    ],
    "connections": {
      "New Hire": {
        "main": [
          [
            {
              "node": "IT Setup Request",
              "type": "main",
              "index": 0
            },
            {
              "node": "Welcome Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Employee Exit": {
        "main": [
          [
            {
              "node": "Deactivation Request",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Recruitment AI Agent v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-j1g3zyp7s",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "content": "## ðŸ§‘â€ðŸ’¼ Recruitment AI Agent\nAutomated resume screening, candidate scoring, and interview scheduling assistant.",
          "height": 100,
          "width": 350,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "submit-application",
          "options": {}
        },
        "id": "webhook-app",
        "name": "New Application",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          400
        ],
        "webhookId": "submit-application"
      },
      {
        "parameters": {
          "jsCode": "const app = $input.item.json;\nconst resumeText = app.resume_text || '';\nconst jobDesc = app.job_description || '';\n\nreturn {\n  json: {\n    ...app,\n    resume_text_clean: resumeText.replace(/\\s+/g, ' ').trim(),\n    job_description_clean: jobDesc.replace(/\\s+/g, ' ').trim()\n  }\n};"
        },
        "id": "clean-text",
        "name": "Clean Text",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are an expert HR recruiter. Analyze the resume against the job description.\n\nOutput JSON:\n{\n  \"match_score\": 0-100,\n  \"skills_match\": [\"skill1\", \"skill2\"],\n  \"missing_skills\": [\"skill3\"],\n  \"experience_summary\": \"...\",\n  \"culture_fit_indicators\": \"...\",\n  \"recommendation\": \"interview/reject/hold\",\n  \"interview_questions\": [\"q1\", \"q2\", \"q3\"]\n}"
              },
              {
                "role": "user",
                "content": "Job Description:\n{{ $json.job_description_clean }}\n\nResume:\n{{ $json.resume_text_clean }}"
              }
            ]
          },
          "jsonOutput": true
        },
        "id": "ai-screen",
        "name": "AI Screen Resume",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          750,
          400
        ]
      },
      {
        "parameters": {
          "dataType": "string",
          "value1": "={{ $json.recommendation }}",
          "rules": {
            "rules": [
              {
                "value2": "interview",
                "output": 0
              },
              {
                "value2": "reject",
                "output": 1
              }
            ]
          },
          "fallbackOutput": 2
        },
        "id": "route-candidate",
        "name": "Route Candidate",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          1000,
          400
        ]
      },
      {
        "parameters": {
          "sendTo": "={{ $('New Application').first().json.email }}",
          "subject": "Interview Request: {{ $('New Application').first().json.position }}",
          "message": "=Hi {{ $('New Application').first().json.name }},\n\nWe were impressed by your profile! We'd like to invite you to an interview.\n\nPlease book a slot here: {{ $env.CALENDLY_URL }}\n\nBest,\nRecruiting Team",
          "options": {}
        },
        "id": "email-interview",
        "name": "Send Interview Invite",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          1250,
          300
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $env.N8N_BASE_URL }}/webhook/onboarding-prep",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={ \"candidate_name\": \"{{ $('New Application').first().json.name }}\", \"email\": \"{{ $('New Application').first().json.email }}\", \"position\": \"{{ $('New Application').first().json.position }}\", \"status\": \"interview_scheduled\" }"
        },
        "id": "trigger-onboarding",
        "name": "â†’ Prep Onboarding",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1500,
          300
        ]
      },
      {
        "parameters": {
          "sendTo": "={{ $('New Application').first().json.email }}",
          "subject": "Update on your application for {{ $('New Application').first().json.position }}",
          "message": "=Hi {{ $('New Application').first().json.name }},\n\nThank you for your interest. Unfortunately, we have decided to move forward with other candidates at this time.\n\nWe will keep your resume on file.\n\nBest,\nRecruiting Team",
          "options": {}
        },
        "id": "email-reject",
        "name": "Send Rejection",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          1250,
          450
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Candidates"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "name": "={{ $('New Application').first().json.name }}",
              "email": "={{ $('New Application').first().json.email }}",
              "score": "={{ $json.match_score }}",
              "recommendation": "={{ $json.recommendation }}",
              "interview_questions": "={{ $json.interview_questions.join('\\n') }}",
              "screened_at": "={{ $now.toISO() }}"
            }
          }
        },
        "id": "save-candidate",
        "name": "Save Candidate",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          1500,
          400
        ]
      },
      {
        "parameters": {
          "channel": "#hiring-updates",
          "text": "=ðŸ‘¤ **New Candidate Screened**\n\nName: {{ $('New Application').first().json.name }}\nPosition: {{ $('New Application').first().json.position }}\nScore: {{ $json.match_score }}/100\nResult: {{ $json.recommendation }}",
          "otherOptions": {}
        },
        "id": "slack-notify",
        "name": "Notify Hiring Mgr",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1750,
          400
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          750,
          650
        ]
      },
      {
        "parameters": {
          "channel": "#system-alerts",
          "text": "=ðŸš¨ Recruitment Agent Error\n\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1000,
          650
        ]
      }
    ],
    "connections": {
      "New Application": {
        "main": [
          [
            {
              "node": "Clean Text",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Clean Text": {
        "main": [
          [
            {
              "node": "AI Screen Resume",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Screen Resume": {
        "main": [
          [
            {
              "node": "Route Candidate",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Route Candidate": {
        "main": [
          [
            {
              "node": "Send Interview Invite",
              "type": "main",
              "index": 0
            },
            {
              "node": "Save Candidate",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Send Rejection",
              "type": "main",
              "index": 0
            },
            {
              "node": "Save Candidate",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Save Candidate",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Save Candidate": {
        "main": [
          [
            {
              "node": "Notify Hiring Mgr",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Trigger": {
        "main": [
          [
            {
              "node": "Error Alert",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Ticket Escalation Manager v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-0lvboj0tk",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "content": "## ðŸŽ« Ticket Escalation Manager\nMonitors support tickets and auto-escalates based on SLA breaches and priority.",
          "height": 100,
          "width": 350,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "minutes",
                "minutesInterval": 15
              }
            ]
          }
        },
        "id": "check-trigger",
        "name": "Check Every 15 Min",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.1,
        "position": [
          250,
          400
        ]
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Support_Tickets"
          }
        },
        "id": "get-tickets",
        "name": "Get Open Tickets",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "jsCode": "const ticket = $input.item.json;\nconst createdAt = new Date(ticket.created_at);\nconst now = new Date();\nconst hoursOpen = (now - createdAt) / (1000 * 60 * 60);\n\n// SLA thresholds by priority\nconst slaHours = {\n  'critical': 2,\n  'high': 4,\n  'medium': 8,\n  'low': 24\n};\n\nconst priority = ticket.priority || 'medium';\nconst slaBreached = hoursOpen > slaHours[priority];\nconst slaPercentage = Math.round((hoursOpen / slaHours[priority]) * 100);\n\nlet escalationLevel = 'none';\nif (slaPercentage >= 150) escalationLevel = 'manager';\nelse if (slaPercentage >= 100) escalationLevel = 'senior';\nelse if (slaPercentage >= 80) escalationLevel = 'warning';\n\nreturn {\n  json: {\n    ...ticket,\n    hours_open: Math.round(hoursOpen * 10) / 10,\n    sla_hours: slaHours[priority],\n    sla_breached: slaBreached,\n    sla_percentage: slaPercentage,\n    escalation_level: escalationLevel,\n    needs_escalation: escalationLevel !== 'none'\n  }\n};"
        },
        "id": "calc-sla",
        "name": "Calculate SLA",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          750,
          400
        ]
      },
      {
        "parameters": {
          "conditions": {
            "conditions": [
              {
                "leftValue": "={{ $json.needs_escalation }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "true"
                }
              }
            ]
          }
        },
        "id": "needs-escalation",
        "name": "Needs Escalation?",
        "type": "n8n-nodes-base.filter",
        "typeVersion": 2,
        "position": [
          1000,
          400
        ]
      },
      {
        "parameters": {
          "dataType": "string",
          "value1": "={{ $json.escalation_level }}",
          "rules": {
            "rules": [
              {
                "value2": "manager",
                "output": 0
              },
              {
                "value2": "senior",
                "output": 1
              }
            ]
          },
          "fallbackOutput": 2
        },
        "id": "route-escalation",
        "name": "Route Escalation",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          1250,
          400
        ]
      },
      {
        "parameters": {
          "channel": "#support-managers",
          "text": "=ðŸš¨ **CRITICAL ESCALATION**\n\nðŸŽ« Ticket: {{ $json.ticket_id }}\nâ±ï¸ Open: {{ $json.hours_open }} hours (SLA: {{ $json.sla_hours }}h)\nðŸ“Š SLA: {{ $json.sla_percentage }}%\n\nSubject: {{ $json.subject }}\nCustomer: {{ $json.customer_name }}\n\n_Immediate action required!_",
          "otherOptions": {}
        },
        "id": "notify-manager",
        "name": "Notify Manager",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1500,
          300
        ]
      },
      {
        "parameters": {
          "channel": "#support-escalations",
          "text": "=âš ï¸ **Ticket Escalated to Senior**\n\nðŸŽ« Ticket: {{ $json.ticket_id }}\nâ±ï¸ SLA: {{ $json.sla_percentage }}%\nSubject: {{ $json.subject }}",
          "otherOptions": {}
        },
        "id": "notify-senior",
        "name": "Notify Senior",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1500,
          450
        ]
      },
      {
        "parameters": {
          "channel": "#support",
          "text": "=âš¡ **SLA Warning**\n\nTicket {{ $json.ticket_id }} at {{ $json.sla_percentage }}% of SLA",
          "otherOptions": {}
        },
        "id": "notify-warning",
        "name": "SLA Warning",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1500,
          600
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          750,
          650
        ]
      },
      {
        "parameters": {
          "channel": "#system-alerts",
          "text": "=ðŸš¨ Ticket Escalation Error\n\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1000,
          650
        ]
      }
    ],
    "connections": {
      "Check Every 15 Min": {
        "main": [
          [
            {
              "node": "Get Open Tickets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Open Tickets": {
        "main": [
          [
            {
              "node": "Calculate SLA",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calculate SLA": {
        "main": [
          [
            {
              "node": "Needs Escalation?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Needs Escalation?": {
        "main": [
          [
            {
              "node": "Route Escalation",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Route Escalation": {
        "main": [
          [
            {
              "node": "Notify Manager",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Notify Senior",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "SLA Warning",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Trigger": {
        "main": [
          [
            {
              "node": "Error Alert",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Content Repurposing Engine v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-a6ozrl409",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {},
        "id": "webhook-content",
        "name": "Content Input",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          200,
          400
        ],
        "webhookId": "repurpose-content"
      },
      {
        "parameters": {
          "jsCode": "const input = $input.item.json;\nlet content = input.content || '';\nlet sourceType = input.source_type || 'text';\n\nif (input.youtube_url) {\n  sourceType = 'youtube';\n  content = input.youtube_url;\n}\n\nreturn {\n  json: {\n    content: content,\n    source_type: sourceType,\n    target_platforms: input.platforms || ['linkedin', 'twitter', 'instagram', 'blog'],\n    brand_voice: input.brand_voice || 'professional',\n    language: input.language || 'tr'\n  }\n};"
        },
        "id": "normalize-input",
        "name": "Normalize Input",
        "type": "n8n-nodes-base.code",
        "position": [
          400,
          400
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.openai.com/v1/audio/transcriptions",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "contentType": "multipart-form-data",
          "bodyParameters": {
            "parameters": [
              {
                "name": "model",
                "value": "whisper-1"
              },
              {
                "name": "file",
                "value": "={{ $json.audio_file }}"
              }
            ]
          }
        },
        "id": "transcribe-audio",
        "name": "Transcribe Audio",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          600,
          300
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Sen iÃ§erik dÃ¶nÃ¼ÅŸtÃ¼rme uzmanÄ±sÄ±n. Verilen uzun iÃ§eriÄŸi farklÄ± platformlar iÃ§in yeniden formatla.\n\nJSON dÃ¶ndÃ¼r:\n{\n  \"linkedin\": { \"post\": \"500 karakter\", \"hashtags\": [] },\n  \"twitter_thread\": [\"tweet1\", \"tweet2\", \"tweet3\"],\n  \"instagram\": { \"caption\": \"2000 karakter\", \"hashtags\": [] },\n  \"blog_outline\": { \"title\": \"\", \"sections\": [] },\n  \"key_quotes\": []\n}"
              },
              {
                "role": "user",
                "content": "=Content to repurpose:\n{{ $json.content.substring(0, 4000) }}\n\nBrand Voice: {{ $json.brand_voice }}\nLanguage: {{ $json.language }}"
              }
            ]
          }
        },
        "id": "ai-repurpose",
        "name": "AI Repurpose",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          800,
          400
        ],
        "typeVersion": 1.4
      },
      {
        "parameters": {
          "jsCode": "const input = $input.item.json;\nconst aiResponse = $('AI Repurpose').first()?.json?.message?.content;\n\nlet repurposed;\ntry {\n  repurposed = JSON.parse(aiResponse);\n} catch (e) {\n  repurposed = { error: 'Parse failed', raw: aiResponse };\n}\n\nreturn {\n  json: {\n    original_content: input.content?.substring(0, 500) + '...',\n    repurposed: repurposed,\n    platforms_generated: Object.keys(repurposed).filter(k => k !== 'error'),\n    created_at: new Date().toISOString()\n  }\n};"
        },
        "id": "parse-output",
        "name": "Parse Output",
        "type": "n8n-nodes-base.code",
        "position": [
          1000,
          400
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Repurposed_Content"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "original_preview": "={{ $json.original_content }}",
              "linkedin_post": "={{ $json.repurposed.linkedin?.post }}",
              "twitter_thread": "={{ JSON.stringify($json.repurposed.twitter_thread) }}",
              "instagram_caption": "={{ $json.repurposed.instagram?.caption }}",
              "blog_title": "={{ $json.repurposed.blog_outline?.title }}",
              "created_at": "={{ $json.created_at }}"
            }
          }
        },
        "id": "save-content",
        "name": "Save Content",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          1200,
          400
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "channel": "#content-ready",
          "text": "=ðŸ“ *Ä°Ã§erik DÃ¶nÃ¼ÅŸtÃ¼rÃ¼ldÃ¼!*\n\nâœ… Platformlar: {{ $json.platforms_generated.join(', ') }}\n\n*LinkedIn:*\n{{ $json.repurposed.linkedin?.post?.substring(0, 200) }}...\n\n*Twitter Thread:*\n{{ $json.repurposed.twitter_thread?.[0] }}\n\n_TÃ¼m iÃ§erikler Sheets'te mevcut._",
          "otherOptions": {}
        },
        "id": "notify-ready",
        "name": "Notify Ready",
        "type": "n8n-nodes-base.slack",
        "position": [
          1200,
          600
        ],
        "typeVersion": 2.1
      },
      {
        "parameters": {
          "content": "## â™»ï¸ Content Repurposing\nTransforms long-form content into LinkedIn, Twitter, Instagram, and blog formats.",
          "height": 100,
          "width": 300,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          250
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          600,
          750
        ]
      },
      {
        "parameters": {
          "channel": "#system-alerts",
          "text": "=ðŸš¨ Content Repurposing Error\n\nNode: {{ $json.execution.lastNodeExecuted }}\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          800,
          750
        ]
      }
    ],
    "connections": {
      "Content Input": {
        "main": [
          [
            {
              "node": "Normalize Input",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Normalize Input": {
        "main": [
          [
            {
              "node": "AI Repurpose",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Repurpose": {
        "main": [
          [
            {
              "node": "Parse Output",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Output": {
        "main": [
          [
            {
              "node": "Save Content",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Save Content": {
        "main": [
          [
            {
              "node": "Notify Ready",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "tags": [
      {
        "name": "content"
      },
      {
        "name": "agency"
      },
      {
        "name": "repurposing"
      }
    ]
  },
  {
    "name": "Grain Email Marketing Automation v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-otd5nklb4",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "email-trigger",
          "options": {}
        },
        "id": "webhook-new-sub",
        "name": "New Subscriber",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          300
        ],
        "webhookId": "email-marketing"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "hours",
                "hoursInterval": 24
              }
            ]
          }
        },
        "id": "daily-drip",
        "name": "Daily Drip Check",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.1,
        "position": [
          250,
          500
        ]
      },
      {
        "parameters": {
          "jsCode": "const sub = $input.item.json;\nconst daysSinceSignup = Math.floor((Date.now() - new Date(sub.signup_date).getTime()) / (1000 * 60 * 60 * 24));\nreturn {\n  json: {\n    ...sub,\n    days_since_signup: daysSinceSignup,\n    drip_stage: daysSinceSignup <= 1 ? 'welcome' : daysSinceSignup <= 3 ? 'education' : daysSinceSignup <= 7 ? 'offer' : 'nurture'\n  }\n};"
        },
        "id": "calc-drip-stage",
        "name": "Calculate Drip Stage",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          500,
          300
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Generate a personalized email subject line and body for a {{ $json.drip_stage }} stage email.\nTone: Friendly, engaging.\nGoal: {{ $json.drip_stage === 'welcome' ? 'Welcome and build trust' : $json.drip_stage === 'education' ? 'Educate on product value' : $json.drip_stage === 'offer' ? 'Present a limited-time offer' : 'Maintain engagement' }}\n\nOutput JSON: { \"subject\": \"...\", \"body\": \"...\" }"
              },
              {
                "role": "user",
                "content": "Subscriber: {{ $json.name }}\nProduct: {{ $json.product }}\nStage: {{ $json.drip_stage }}"
              }
            ]
          },
          "jsonOutput": true
        },
        "id": "ai-email-gen",
        "name": "AI Generate Email",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          750,
          300
        ]
      },
      {
        "parameters": {
          "sendTo": "={{ $json.email }}",
          "subject": "={{ $json.subject }}",
          "message": "={{ $json.body }}",
          "options": {}
        },
        "id": "send-email",
        "name": "Send Email",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          1000,
          300
        ]
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Email_Log"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "email": "={{ $json.email }}",
              "last_email_sent": "={{ $now.toISO() }}",
              "stage": "={{ $json.drip_stage }}"
            }
          }
        },
        "id": "log-email",
        "name": "Log to Sheet",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          1200,
          300
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          750,
          600
        ]
      },
      {
        "parameters": {
          "channel": "email-alerts",
          "text": "=ðŸš¨ Email Automation Error\n\nSubscriber: {{ $json.email }}\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-alert",
        "name": "Alert Error",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          950,
          600
        ]
      }
    ],
    "connections": {
      "New Subscriber": {
        "main": [
          [
            {
              "node": "Calculate Drip Stage",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Daily Drip Check": {
        "main": [
          [
            {
              "node": "Calculate Drip Stage",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Calculate Drip Stage": {
        "main": [
          [
            {
              "node": "AI Generate Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Generate Email": {
        "main": [
          [
            {
              "node": "Send Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send Email": {
        "main": [
          [
            {
              "node": "Log to Sheet",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Trigger": {
        "main": [
          [
            {
              "node": "Alert Error",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain GBP Auto Posting v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-o86djvbau",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 10 * * 1,3,5"
              }
            ]
          }
        },
        "id": "schedule-post",
        "name": "Schedule Post",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          200,
          400
        ],
        "typeVersion": 1.1
      },
      {
        "parameters": {},
        "id": "webhook-post",
        "name": "Manual Post",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          200,
          600
        ],
        "webhookId": "gbp-post"
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "GBP_Content_Calendar"
          },
          "options": {}
        },
        "id": "get-content",
        "name": "Get Content",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          400,
          400
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "conditions": {
            "conditions": [
              {
                "leftValue": "={{ $json.status }}",
                "rightValue": "scheduled",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              },
              {
                "leftValue": "={{ $json.scheduled_date }}",
                "rightValue": "={{ $now.format('YYYY-MM-DD') }}",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          }
        },
        "id": "filter-today",
        "name": "Filter Today",
        "type": "n8n-nodes-base.filter",
        "position": [
          600,
          400
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "model": "gpt-4o-mini",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Google Business Profile postu yaz. Local SEO iÃ§in optimize et.\n\nKurallar:\n- Max 1500 karakter\n- CTA ekle (Rezervasyon yap, Ara, Ziyaret et)\n- Emoji kullan ama abartma\n- Konum bazlÄ± kelimeler ekle\n\nJSON: {\"summary\": \"post metni\", \"cta_type\": \"BOOK/CALL/LEARN_MORE\"}"
              },
              {
                "role": "user",
                "content": "=Business: {{ $json.business_name }}\nTopic: {{ $json.topic }}\nType: {{ $json.post_type }}\nLocation: {{ $json.location }}"
              }
            ]
          }
        },
        "id": "ai-generate",
        "name": "AI Generate",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          800,
          400
        ],
        "typeVersion": 1.4
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://mybusiness.googleapis.com/v4/accounts/{{ $env.GBP_ACCOUNT_ID }}/locations/{{ $env.GBP_LOCATION_ID }}/localPosts",
          "authentication": "oAuth2",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"languageCode\": \"tr\",\n  \"summary\": \"{{ $('AI Generate').first().json.message.content.summary }}\",\n  \"callToAction\": {\n    \"actionType\": \"{{ $('AI Generate').first().json.message.content.cta_type }}\",\n    \"url\": \"{{ $json.cta_url || $env.BUSINESS_WEBSITE }}\"\n  },\n  \"topicType\": \"STANDARD\"\n}"
        },
        "id": "post-to-gbp",
        "name": "Post to GBP",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          1000,
          400
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "GBP_Content_Calendar"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "status": "published",
              "published_at": "={{ $now.toISO() }}",
              "post_id": "={{ $('Post to GBP').first().json.name }}"
            }
          }
        },
        "id": "update-status",
        "name": "Update Status",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          1200,
          400
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "channel": "#local-seo",
          "text": "=âœ… *GBP Post YayÄ±nlandÄ±*\n\nðŸ“ {{ $json.business_name }}\nðŸ“ {{ $json.topic }}\n\n_Google Maps'te gÃ¶rÃ¼nÃ¼r oldu._",
          "otherOptions": {}
        },
        "id": "notify",
        "name": "Notify",
        "type": "n8n-nodes-base.slack",
        "position": [
          1200,
          600
        ],
        "typeVersion": 2.1
      },
      {
        "parameters": {
          "content": "## ðŸ“ Local SEO Automation\nPosts to Google Business Profile on Mon/Wed/Fri at 10 AM. AI generates optimized content.",
          "height": 100,
          "width": 300,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          250
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          600,
          750
        ]
      },
      {
        "parameters": {
          "channel": "#system-alerts",
          "text": "=ðŸš¨ GBP Posting Error\n\nNode: {{ $json.execution.lastNodeExecuted }}\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          800,
          750
        ]
      }
    ],
    "connections": {
      "Schedule Post": {
        "main": [
          [
            {
              "node": "Get Content",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Manual Post": {
        "main": [
          [
            {
              "node": "Get Content",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Content": {
        "main": [
          [
            {
              "node": "Filter Today",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Filter Today": {
        "main": [
          [
            {
              "node": "AI Generate",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Generate": {
        "main": [
          [
            {
              "node": "Post to GBP",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Post to GBP": {
        "main": [
          [
            {
              "node": "Update Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Status": {
        "main": [
          [
            {
              "node": "Notify",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "tags": [
      {
        "name": "local-seo"
      },
      {
        "name": "gbp"
      },
      {
        "name": "hospitality"
      }
    ]
  },
  {
    "name": "Grain Google Search Console Hub v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-abzm7pdtr",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "content": "## ðŸ“Š Google Search Console Hub\nFree SEO data directly from GSC: impressions, clicks, CTR, position tracking.",
          "height": 100,
          "width": 350,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 8 * * 1"
              }
            ]
          }
        },
        "id": "weekly-trigger",
        "name": "Weekly Report",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.1,
        "position": [
          250,
          400
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://searchconsole.googleapis.com/webmasters/v3/sites/{{ encodeURIComponent($env.GSC_SITE_URL) }}/searchAnalytics/query",
          "authentication": "oAuth2",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"startDate\": \"{{ $now.minus({days: 28}).toFormat('yyyy-MM-dd') }}\",\n  \"endDate\": \"{{ $now.minus({days: 1}).toFormat('yyyy-MM-dd') }}\",\n  \"dimensions\": [\"query\"],\n  \"rowLimit\": 100,\n  \"dataState\": \"final\"\n}"
        },
        "id": "gsc-queries",
        "name": "Get Top Queries",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://searchconsole.googleapis.com/webmasters/v3/sites/{{ encodeURIComponent($env.GSC_SITE_URL) }}/searchAnalytics/query",
          "authentication": "oAuth2",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"startDate\": \"{{ $now.minus({days: 28}).toFormat('yyyy-MM-dd') }}\",\n  \"endDate\": \"{{ $now.minus({days: 1}).toFormat('yyyy-MM-dd') }}\",\n  \"dimensions\": [\"page\"],\n  \"rowLimit\": 50,\n  \"dataState\": \"final\"\n}"
        },
        "id": "gsc-pages",
        "name": "Get Top Pages",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          600
        ]
      },
      {
        "parameters": {
          "jsCode": "const queries = $('Get Top Queries').first().json.rows || [];\nconst pages = $('Get Top Pages').first().json.rows || [];\n\nconst topQueries = queries.slice(0, 20).map(q => ({\n  keyword: q.keys[0],\n  clicks: q.clicks,\n  impressions: q.impressions,\n  ctr: (q.ctr * 100).toFixed(2) + '%',\n  position: q.position.toFixed(1)\n}));\n\nconst lowHangingFruit = queries.filter(q => q.position >= 5 && q.position <= 20 && q.impressions > 100)\n  .slice(0, 10)\n  .map(q => ({ keyword: q.keys[0], position: q.position.toFixed(1), impressions: q.impressions }));\n\nconst topPages = pages.slice(0, 10).map(p => ({\n  url: p.keys[0],\n  clicks: p.clicks,\n  impressions: p.impressions,\n  ctr: (p.ctr * 100).toFixed(2) + '%'\n}));\n\nconst totalClicks = queries.reduce((a, b) => a + b.clicks, 0);\nconst totalImpressions = queries.reduce((a, b) => a + b.impressions, 0);\n\nreturn {\n  json: {\n    summary: { total_clicks: totalClicks, total_impressions: totalImpressions, avg_ctr: ((totalClicks / totalImpressions) * 100).toFixed(2) + '%' },\n    top_queries: topQueries,\n    low_hanging_fruit: lowHangingFruit,\n    top_pages: topPages\n  }\n};"
        },
        "id": "analyze-gsc",
        "name": "Analyze GSC Data",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          750,
          500
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are an SEO analyst. Based on GSC data, provide:\n\n1. Top 3 quick wins (keywords to optimize)\n2. Content gaps to address\n3. Pages that need CTR improvement\n4. Weekly action items\n\nBe specific and actionable."
              },
              {
                "role": "user",
                "content": "GSC Summary:\n{{ JSON.stringify($json.summary) }}\n\nLow Hanging Fruit (Position 5-20):\n{{ JSON.stringify($json.low_hanging_fruit) }}\n\nTop Pages:\n{{ JSON.stringify($json.top_pages) }}"
              }
            ]
          }
        },
        "id": "ai-recommendations",
        "name": "AI Recommendations",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          1000,
          500
        ]
      },
      {
        "parameters": {
          "channel": "#seo-weekly",
          "text": "=ðŸ“Š **Weekly GSC Report**\n\nðŸ“ˆ Summary:\nâ€¢ Clicks: {{ $('Analyze GSC Data').first().json.summary.total_clicks }}\nâ€¢ Impressions: {{ $('Analyze GSC Data').first().json.summary.total_impressions }}\nâ€¢ Avg CTR: {{ $('Analyze GSC Data').first().json.summary.avg_ctr }}\n\nðŸŽ¯ Low Hanging Fruit (Pos 5-20):\n{{ $('Analyze GSC Data').first().json.low_hanging_fruit.slice(0, 5).map(k => 'â€¢ ' + k.keyword + ' (Pos: ' + k.position + ')').join('\\n') }}\n\nðŸ’¡ AI Recommendations:\n{{ $json.message.content }}",
          "otherOptions": {}
        },
        "id": "slack-report",
        "name": "Send Weekly Report",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1250,
          500
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          500,
          750
        ]
      },
      {
        "parameters": {
          "channel": "#seo-alerts",
          "text": "=ðŸš¨ GSC Hub Error\n\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          750,
          750
        ]
      }
    ],
    "connections": {
      "Weekly Report": {
        "main": [
          [
            {
              "node": "Get Top Queries",
              "type": "main",
              "index": 0
            },
            {
              "node": "Get Top Pages",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Top Queries": {
        "main": [
          [
            {
              "node": "Analyze GSC Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Top Pages": {
        "main": [
          [
            {
              "node": "Analyze GSC Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Analyze GSC Data": {
        "main": [
          [
            {
              "node": "AI Recommendations",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Recommendations": {
        "main": [
          [
            {
              "node": "Send Weekly Report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Trigger": {
        "main": [
          [
            {
              "node": "Error Alert",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Influencer Outreach v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-mhuyholvd",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "influencer-campaign",
          "options": {}
        },
        "id": "webhook-campaign",
        "name": "New Campaign",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          300
        ],
        "webhookId": "influencer-outreach"
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Influencer_List"
          }
        },
        "id": "get-influencers",
        "name": "Get Influencer List",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          500,
          300
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "Write a personalized influencer outreach DM for {{ $json.influencer_name }}. Keep it casual, friendly, under 150 chars. Mention their niche: {{ $json.niche }}."
              },
              {
                "role": "user",
                "content": "Campaign: {{ $json.campaign_name }}\nProduct: {{ $json.product }}"
              }
            ]
          },
          "jsonOutput": false
        },
        "id": "ai-dm",
        "name": "Generate DM",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          750,
          300
        ]
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Influencer_List"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "status": "outreach_sent",
              "last_contacted": "={{ $now.toISO() }}"
            }
          }
        },
        "id": "update-status",
        "name": "Update Status",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          1000,
          300
        ]
      }
    ],
    "connections": {
      "New Campaign": {
        "main": [
          [
            {
              "node": "Get Influencer List",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Influencer List": {
        "main": [
          [
            {
              "node": "Generate DM",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate DM": {
        "main": [
          [
            {
              "node": "Update Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Keyword Gap Analysis v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-0j0lkaneo",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {},
        "id": "webhook-gap",
        "name": "Gap Analysis Request",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          200,
          400
        ],
        "webhookId": "keyword-gap"
      },
      {
        "parameters": {
          "jsCode": "const input = $input.item.json;\nreturn {\n  json: {\n    our_domain: input.our_domain,\n    competitors: input.competitors || [],\n    target_keywords: input.keywords || [],\n    country: input.country || 'tr'\n  }\n};"
        },
        "id": "normalize",
        "name": "Normalize",
        "type": "n8n-nodes-base.code",
        "position": [
          400,
          400
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "method": "GET",
          "url": "https://www.googleapis.com/webmasters/v3/sites/{{ encodeURIComponent('sc-domain:' + $json.our_domain) }}/searchAnalytics/query",
          "authentication": "oAuth2",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"startDate\": \"{{ $now.minus({days: 30}).format('YYYY-MM-DD') }}\",\n  \"endDate\": \"{{ $now.format('YYYY-MM-DD') }}\",\n  \"dimensions\": [\"query\"],\n  \"rowLimit\": 500\n}"
        },
        "id": "gsc-our-keywords",
        "name": "GSC Our Keywords",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          600,
          300
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://google.serper.dev/search",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\"q\": \"site:{{ $json.competitors[0] }}\", \"gl\": \"{{ $json.country }}\", \"num\": 100}"
        },
        "id": "competitor-keywords",
        "name": "Competitor Keywords",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          600,
          500
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "jsCode": "const ourKeywords = $('GSC Our Keywords').first()?.json?.rows?.map(r => r.keys[0].toLowerCase()) || [];\nconst competitorResults = $('Competitor Keywords').first()?.json?.organic || [];\n\n// Extract keywords from competitor titles/snippets\nconst competitorKeywords = new Set();\ncompetitorResults.forEach(r => {\n  const words = (r.title + ' ' + r.snippet).toLowerCase().split(/\\s+/);\n  words.filter(w => w.length > 3).forEach(w => competitorKeywords.add(w));\n});\n\n// Find gap (competitor has, we don't)\nconst ourSet = new Set(ourKeywords);\nconst gaps = [...competitorKeywords].filter(k => !ourSet.has(k)).slice(0, 50);\n\nreturn {\n  json: {\n    our_keyword_count: ourKeywords.length,\n    competitor_keyword_count: competitorKeywords.size,\n    keyword_gaps: gaps,\n    gap_count: gaps.length\n  }\n};"
        },
        "id": "find-gaps",
        "name": "Find Gaps",
        "type": "n8n-nodes-base.code",
        "position": [
          800,
          400
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "model": "gpt-4o-mini",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "SEO uzmanÄ±sÄ±n. Keyword gap listesini analiz et ve Ã¶nceliklendir.\n\nJSON dÃ¶ndÃ¼r:\n{\n  \"high_priority\": [{\"keyword\": \"\", \"reason\": \"\", \"content_type\": \"blog/page/category\"}],\n  \"medium_priority\": [],\n  \"quick_wins\": [],\n  \"content_plan\": [{\"title\": \"\", \"target_keyword\": \"\", \"word_count\": 0}]\n}"
              },
              {
                "role": "user",
                "content": "=Keyword Gaps Found: {{ $json.gap_count }}\n\nTop Gaps:\n{{ $json.keyword_gaps.slice(0, 30).join(', ') }}"
              }
            ]
          }
        },
        "id": "ai-prioritize",
        "name": "AI Prioritize",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          1000,
          400
        ],
        "typeVersion": 1.4
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Keyword_Gap_Analysis"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "analyzed_at": "={{ $now.toISO() }}",
              "our_keywords": "={{ $json.our_keyword_count }}",
              "gaps_found": "={{ $json.gap_count }}",
              "top_gaps": "={{ $json.keyword_gaps.slice(0, 20).join(', ') }}"
            }
          }
        },
        "id": "save-analysis",
        "name": "Save Analysis",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          1200,
          400
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "channel": "#seo-opportunities",
          "text": "=ðŸŽ¯ *Keyword Gap Analizi TamamlandÄ±*\n\nðŸ“Š Bizim Keyword: {{ $json.our_keyword_count }}\nðŸ” Bulunan AÃ§Ä±k: {{ $json.gap_count }}\n\n*En Ã–nemli FÄ±rsatlar:*\n{{ $json.keyword_gaps.slice(0, 10).map((k, i) => (i+1) + '. ' + k).join('\\n') }}",
          "otherOptions": {}
        },
        "id": "notify",
        "name": "Notify",
        "type": "n8n-nodes-base.slack",
        "position": [
          1200,
          600
        ],
        "typeVersion": 2.1
      },
      {
        "parameters": {
          "content": "## ðŸŽ¯ Keyword Gap Analysis\nCompares your GSC keywords vs competitor rankings to find content opportunities.",
          "height": 100,
          "width": 300,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          250
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          600,
          750
        ]
      },
      {
        "parameters": {
          "channel": "#system-alerts",
          "text": "=ðŸš¨ Keyword Gap Error\n\nNode: {{ $json.execution.lastNodeExecuted }}\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          800,
          750
        ]
      }
    ],
    "connections": {
      "Gap Analysis Request": {
        "main": [
          [
            {
              "node": "Normalize",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Normalize": {
        "main": [
          [
            {
              "node": "GSC Our Keywords",
              "type": "main",
              "index": 0
            },
            {
              "node": "Competitor Keywords",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "GSC Our Keywords": {
        "main": [
          [
            {
              "node": "Find Gaps",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Competitor Keywords": {
        "main": [
          [
            {
              "node": "Find Gaps",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Find Gaps": {
        "main": [
          [
            {
              "node": "AI Prioritize",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Prioritize": {
        "main": [
          [
            {
              "node": "Save Analysis",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Save Analysis": {
        "main": [
          [
            {
              "node": "Notify",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "tags": [
      {
        "name": "seo"
      },
      {
        "name": "competitor"
      },
      {
        "name": "keywords"
      }
    ]
  },
  {
    "name": "Grain Landing Page CRO Hub v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-8kcnuod0e",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "landing-page/generate",
          "options": {}
        },
        "id": "webhook-gen-lp",
        "name": "Generate Page Request",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          300
        ],
        "webhookId": "lp-generate"
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are a Landing Page Specialist. Generate a JSON structure for a high-converting landing page based on the product description.\nStructure: { \"hero_headline\": \"...\", \"hero_subhead\": \"...\", \"benefits\": [], \"features\": [], \"cta_primary\": \"...\", \"cta_secondary\": \"...\" }\nApply persuasion principles (Cialdini)."
              },
              {
                "role": "user",
                "content": "Product: {{ $json.body.product_name }}\nTarget Audience: {{ $json.body.audience }}\nValue Prop: {{ $json.body.value_prop }}"
              }
            ]
          },
          "jsonOutput": true
        },
        "id": "ai-lp-structure",
        "name": "AI Build Page Structure",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          450,
          300
        ]
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={{ $json }}",
          "options": {}
        },
        "id": "return-page",
        "name": "Return JSON",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1,
        "position": [
          700,
          300
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "landing-page/form-submit",
          "options": {}
        },
        "id": "webhook-form",
        "name": "Form Submission",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          500
        ],
        "webhookId": "lp-form-submit"
      },
      {
        "parameters": {
          "jsCode": "// Trigger Lead Funnel Workflow via API call or internal trigger\nreturn { json: { ...$input.item.json, source: \"landing_page\" } };"
        },
        "id": "trigger-funnel",
        "name": "Trigger Lead Funnel",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          450,
          500
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Form_Submissions"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "email": "={{ $json.body.email }}",
              "page_id": "={{ $json.body.page_id }}",
              "timestamp": "={{ $now.toISO() }}"
            }
          }
        },
        "id": "save-submission",
        "name": "Save Submission",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          700,
          500
        ]
      }
    ],
    "connections": {
      "Generate Page Request": {
        "main": [
          [
            {
              "node": "AI Build Page Structure",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Build Page Structure": {
        "main": [
          [
            {
              "node": "Return JSON",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Form Submission": {
        "main": [
          [
            {
              "node": "Trigger Lead Funnel",
              "type": "main",
              "index": 0
            },
            {
              "node": "Save Submission",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Multi-Platform Publisher v2",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-wq72ddale",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "minutes",
                "minutesInterval": 30
              }
            ]
          }
        },
        "id": "schedule-trigger",
        "name": "Every 30 Minutes",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.1,
        "position": [
          250,
          300
        ]
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Content_Calendar"
          },
          "options": {
            "range": "A:Z"
          }
        },
        "id": "read-calendar",
        "name": "Read Content Calendar",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          450,
          300
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "status-check",
                "leftValue": "={{ $json.status }}",
                "rightValue": "approved",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              },
              {
                "id": "published-check",
                "leftValue": "={{ $json.published }}",
                "rightValue": "FALSE",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          }
        },
        "id": "filter-posts",
        "name": "Filter Approved",
        "type": "n8n-nodes-base.filter",
        "typeVersion": 2,
        "position": [
          650,
          300
        ]
      },
      {
        "parameters": {
          "jsCode": "const now = new Date();\nconst scheduledTime = new Date($input.item.json.scheduled_datetime);\n\nif (scheduledTime <= now) {\n  return $input.item;\n}\nreturn [];"
        },
        "id": "check-time",
        "name": "Check Time",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          850,
          300
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are an expert social media manager. Generate optimized captions for the following platforms based on the input content. Return ONLY a JSON object with keys: instagram, facebook, twitter, linkedin, tiktok, threads, reddit, quora, pinterest.\n\nRules:\n- Instagram: engaging, emojis, 30 hashtags\n- Twitter: Max 280 chars, punchy\n- LinkedIn: Professional, business focus\n- TikTok: Viral style, trending tags\n- Reddit: Informative, no marketing fluff\n"
              },
              {
                "role": "user",
                "content": "Original Content: {{ $json.original_caption }}\nTopic: {{ $json.topic }}"
              }
            ]
          },
          "jsonOutput": true
        },
        "id": "ai-caption-gen",
        "name": "AI Generate Captions",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          1050,
          300
        ]
      },
      {
        "parameters": {
          "dataType": "string",
          "value1": "={{ $json.platforms }}",
          "rules": {
            "rules": [
              {
                "value2": "instagram",
                "output": 0
              },
              {
                "value2": "facebook",
                "output": 1
              },
              {
                "value2": "twitter",
                "output": 2
              },
              {
                "value2": "linkedin",
                "output": 3
              },
              {
                "value2": "tiktok",
                "output": 4
              }
            ]
          },
          "fallbackOutput": 5
        },
        "id": "platform-router",
        "name": "Platform Router",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          1300,
          300
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://graph.facebook.com/v19.0/{{ $env.IG_USER_ID }}/media",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "image_url",
                "value": "={{ $json.media_url }}"
              },
              {
                "name": "caption",
                "value": "={{ $json.captions.instagram }}"
              },
              {
                "name": "access_token",
                "value": "={{ $env.IG_ACCESS_TOKEN }}"
              }
            ]
          }
        },
        "id": "post-instagram",
        "name": "Post to Instagram",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1600,
          100
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://graph.facebook.com/v19.0/{{ $env.PAGE_ID }}/feed",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "message",
                "value": "={{ $json.captions.facebook }}"
              },
              {
                "name": "link",
                "value": "={{ $json.media_url }}"
              },
              {
                "name": "access_token",
                "value": "={{ $env.FB_ACCESS_TOKEN }}"
              }
            ]
          }
        },
        "id": "post-facebook",
        "name": "Post to Facebook",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1600,
          300
        ]
      },
      {
        "parameters": {
          "content": "Placeholder for Twitter/X V2 API Posting",
          "height": 100,
          "width": 300
        },
        "id": "twitter-stub",
        "name": "Sticky Note Twitter",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          1600,
          500
        ]
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Content_Calendar"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "published": "TRUE",
              "published_at": "={{ $now.toISO() }}"
            }
          }
        },
        "id": "update-status",
        "name": "Update Status",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          2000,
          300
        ]
      }
    ],
    "connections": {
      "Every 30 Minutes": {
        "main": [
          [
            {
              "node": "Read Content Calendar",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Read Content Calendar": {
        "main": [
          [
            {
              "node": "Filter Approved",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Filter Approved": {
        "main": [
          [
            {
              "node": "Check Time",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check Time": {
        "main": [
          [
            {
              "node": "AI Generate Captions",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Generate Captions": {
        "main": [
          [
            {
              "node": "Platform Router",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Platform Router": {
        "main": [
          [
            {
              "node": "Post to Instagram",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Post to Facebook",
              "type": "main",
              "index": 0
            }
          ],
          [],
          [],
          []
        ]
      },
      "Post to Instagram": {
        "main": [
          [
            {
              "node": "Update Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Post to Facebook": {
        "main": [
          [
            {
              "node": "Update Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain SEO Engine v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-wp9ba2wdh",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {},
        "id": "webhook-seo",
        "name": "SEO Request",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          200,
          400
        ],
        "webhookId": "seo-engine"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 8 * * 1"
              }
            ]
          }
        },
        "id": "weekly-audit",
        "name": "Weekly Audit",
        "type": "n8n-nodes-base.scheduleTrigger",
        "position": [
          200,
          600
        ],
        "typeVersion": 1.1
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://google.serper.dev/search",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\"q\": \"{{ $json.keyword }}\", \"gl\": \"{{ $json.country || 'tr' }}\", \"num\": 20}"
        },
        "id": "serp-check",
        "name": "SERP Check",
        "type": "n8n-nodes-base.httpRequest",
        "position": [
          450,
          400
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "jsCode": "const results = $input.item.json;\nconst domain = $env.PRIMARY_DOMAIN || 'example.com';\nconst organic = results.organic || [];\n\nconst ourRank = organic.findIndex(r => r.link?.includes(domain)) + 1;\nconst competitors = organic.slice(0, 10).map((r, i) => ({\n  rank: i + 1,\n  title: r.title,\n  domain: new URL(r.link).hostname,\n  snippet: r.snippet\n}));\n\nreturn {\n  json: {\n    keyword: results.searchParameters?.q,\n    our_position: ourRank || 'Not ranking',\n    top_competitors: competitors,\n    related_searches: results.relatedSearches?.map(r => r.query) || [],\n    people_also_ask: results.peopleAlsoAsk?.map(p => p.question) || []\n  }\n};"
        },
        "id": "analyze-serp",
        "name": "Analyze SERP",
        "type": "n8n-nodes-base.code",
        "position": [
          650,
          400
        ],
        "typeVersion": 2
      },
      {
        "parameters": {
          "model": "gpt-4o-mini",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "SEO uzmanÄ±sÄ±n. SERP verilerini analiz et ve JSON dÃ¶ndÃ¼r:\n{\"seo_score\": 0-100, \"opportunities\": [], \"content_recommendations\": [], \"quick_wins\": []}"
              },
              {
                "role": "user",
                "content": "=Keyword: {{ $json.keyword }}\nPosition: {{ $json.our_position }}\nCompetitors: {{ JSON.stringify($json.top_competitors.slice(0, 5)) }}\nRelated: {{ $json.related_searches.join(', ') }}"
              }
            ]
          }
        },
        "id": "ai-seo-analysis",
        "name": "AI SEO Analysis",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "position": [
          850,
          400
        ],
        "typeVersion": 1.4
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "SEO_Tracking"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "keyword": "={{ $json.keyword }}",
              "position": "={{ $json.our_position }}",
              "checked_at": "={{ $now.toISO() }}"
            }
          }
        },
        "id": "save-results",
        "name": "Save Results",
        "type": "n8n-nodes-base.googleSheets",
        "position": [
          1050,
          400
        ],
        "typeVersion": 4.2
      },
      {
        "parameters": {
          "channel": "#seo-alerts",
          "text": "=ðŸ“Š *SEO Report*\n\nKeyword: {{ $json.keyword }}\nPosition: {{ $json.our_position }}\n\n*Top Competitors:*\n{{ $json.top_competitors.slice(0, 3).map(c => c.rank + '. ' + c.domain).join('\\n') }}",
          "otherOptions": {}
        },
        "id": "slack-report",
        "name": "Slack Report",
        "type": "n8n-nodes-base.slack",
        "position": [
          1250,
          400
        ],
        "typeVersion": 2.1
      },
      {
        "parameters": {
          "content": "## ðŸ” SEO Engine\nWeekly SERP tracking with AI-powered recommendations. Uses Serper API for search data.",
          "height": 100,
          "width": 300,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          250
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          650,
          650
        ]
      },
      {
        "parameters": {
          "channel": "#system-alerts",
          "text": "=ðŸš¨ SEO Engine Error\n\nNode: {{ $json.execution.lastNodeExecuted }}\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          850,
          650
        ]
      }
    ],
    "connections": {
      "SEO Request": {
        "main": [
          [
            {
              "node": "SERP Check",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Weekly Audit": {
        "main": [
          [
            {
              "node": "SERP Check",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "SERP Check": {
        "main": [
          [
            {
              "node": "Analyze SERP",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Analyze SERP": {
        "main": [
          [
            {
              "node": "AI SEO Analysis",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI SEO Analysis": {
        "main": [
          [
            {
              "node": "Save Results",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Save Results": {
        "main": [
          [
            {
              "node": "Slack Report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "tags": [
      {
        "name": "seo"
      },
      {
        "name": "marketing"
      }
    ]
  },
  {
    "name": "Grain SEO Keyword Research Free v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-b9oinovqz",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "content": "## ðŸ” SEO Keyword Research (Free)\nAI-powered keyword research using Serper API + GPT-4o. No SEMrush required!",
          "height": 100,
          "width": 350,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "keyword-research",
          "options": {}
        },
        "id": "webhook-research",
        "name": "Research Request",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          400
        ],
        "webhookId": "keyword-research"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://google.serper.dev/search",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "X-API-KEY",
                "value": "={{ $env.SERPER_API_KEY }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={ \"q\": \"{{ $json.keyword }}\", \"gl\": \"{{ $json.country || 'us' }}\", \"num\": 20 }"
        },
        "id": "serper-search",
        "name": "Serper SERP",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://google.serper.dev/search",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "X-API-KEY",
                "value": "={{ $env.SERPER_API_KEY }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={ \"q\": \"{{ $('Research Request').first().json.keyword }}\", \"type\": \"autocomplete\" }"
        },
        "id": "serper-autocomplete",
        "name": "Related Keywords",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          500,
          600
        ]
      },
      {
        "parameters": {
          "jsCode": "const serp = $('Serper SERP').first().json;\nconst autocomplete = $('Related Keywords').first().json;\nconst keyword = $('Research Request').first().json.keyword;\n\nconst competitors = (serp.organic || []).slice(0, 10).map(r => ({\n  position: r.position,\n  title: r.title,\n  url: r.link,\n  snippet: r.snippet\n}));\n\nconst relatedKeywords = (autocomplete.suggestions || []).slice(0, 10);\nconst peopleAlsoAsk = (serp.peopleAlsoAsk || []).map(p => p.question);\n\nreturn {\n  json: {\n    keyword: keyword,\n    serp_results: competitors.length,\n    top_competitors: competitors,\n    related_keywords: relatedKeywords,\n    people_also_ask: peopleAlsoAsk,\n    search_features: {\n      has_featured_snippet: !!serp.answerBox,\n      has_knowledge_graph: !!serp.knowledgeGraph,\n      has_local_pack: !!serp.localResults\n    }\n  }\n};"
        },
        "id": "combine-data",
        "name": "Combine SERP Data",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          750,
          500
        ]
      },
      {
        "parameters": {
          "model": "gpt-4o",
          "messages": {
            "values": [
              {
                "role": "system",
                "content": "You are an SEO expert. Analyze the SERP data and provide:\n\n1. Keyword difficulty estimate (Easy/Medium/Hard) based on competitor quality\n2. Content type recommendation (blog, product page, tool, etc.)\n3. Estimated monthly search volume range\n4. 5 long-tail keyword suggestions\n5. Content outline for ranking\n\nReturn JSON format."
              },
              {
                "role": "user",
                "content": "Keyword: {{ $json.keyword }}\n\nTop 10 SERP Results:\n{{ JSON.stringify($json.top_competitors, null, 2) }}\n\nRelated Keywords: {{ $json.related_keywords.join(', ') }}\n\nPeople Also Ask: {{ $json.people_also_ask.join(', ') }}"
              }
            ]
          },
          "jsonOutput": true
        },
        "id": "ai-analyze",
        "name": "AI SEO Analysis",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          1000,
          500
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Keyword_Research"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "keyword": "={{ $('Research Request').first().json.keyword }}",
              "difficulty": "={{ $json.difficulty }}",
              "volume_range": "={{ $json.volume_estimate }}",
              "content_type": "={{ $json.content_type }}",
              "longtail_keywords": "={{ $json.long_tail_keywords?.join('; ') }}",
              "researched_at": "={{ $now.toISO() }}"
            }
          }
        },
        "id": "save-research",
        "name": "Save Research",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          1250,
          500
        ]
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={{ $json }}",
          "options": {}
        },
        "id": "respond",
        "name": "Respond",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1,
        "position": [
          1500,
          500
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          750,
          750
        ]
      },
      {
        "parameters": {
          "channel": "#seo-alerts",
          "text": "=ðŸš¨ Keyword Research Error\n\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1000,
          750
        ]
      }
    ],
    "connections": {
      "Research Request": {
        "main": [
          [
            {
              "node": "Serper SERP",
              "type": "main",
              "index": 0
            },
            {
              "node": "Related Keywords",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Serper SERP": {
        "main": [
          [
            {
              "node": "Combine SERP Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Related Keywords": {
        "main": [
          [
            {
              "node": "Combine SERP Data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Combine SERP Data": {
        "main": [
          [
            {
              "node": "AI SEO Analysis",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI SEO Analysis": {
        "main": [
          [
            {
              "node": "Save Research",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Save Research": {
        "main": [
          [
            {
              "node": "Respond",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Trigger": {
        "main": [
          [
            {
              "node": "Error Alert",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain SERP Rank Tracker Free v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-8x348wqpn",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "content": "## ðŸ“ˆ SERP Rank Tracker (Free)\nTrack your keyword rankings using Serper API. No Ahrefs required!",
          "height": 100,
          "width": 350,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "cronExpression",
                "expression": "0 7 * * *"
              }
            ]
          }
        },
        "id": "daily-check",
        "name": "Daily Rank Check",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.1,
        "position": [
          250,
          400
        ]
      },
      {
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Keywords_to_Track"
          }
        },
        "id": "get-keywords",
        "name": "Get Keywords",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://google.serper.dev/search",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "X-API-KEY",
                "value": "={{ $env.SERPER_API_KEY }}"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={ \"q\": \"{{ $json.keyword }}\", \"gl\": \"{{ $json.country || 'us' }}\", \"num\": 100 }"
        },
        "id": "check-serp",
        "name": "Check SERP",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          750,
          400
        ]
      },
      {
        "parameters": {
          "jsCode": "const serp = $input.item.json;\nconst keyword = $('Get Keywords').first().json.keyword;\nconst targetDomain = $env.TARGET_DOMAIN;\nconst previousPosition = parseInt($('Get Keywords').first().json.last_position) || 0;\n\nconst organic = serp.organic || [];\nlet currentPosition = 0;\nlet rankingUrl = '';\n\nfor (let i = 0; i < organic.length; i++) {\n  if (organic[i].link.includes(targetDomain)) {\n    currentPosition = i + 1;\n    rankingUrl = organic[i].link;\n    break;\n  }\n}\n\nconst change = previousPosition > 0 ? previousPosition - currentPosition : 0;\nconst status = currentPosition === 0 ? 'not_ranking' : change > 0 ? 'improved' : change < 0 ? 'dropped' : 'stable';\n\nreturn {\n  json: {\n    keyword: keyword,\n    current_position: currentPosition,\n    previous_position: previousPosition,\n    change: change,\n    status: status,\n    ranking_url: rankingUrl,\n    checked_at: new Date().toISOString()\n  }\n};"
        },
        "id": "find-position",
        "name": "Find Position",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1000,
          400
        ]
      },
      {
        "parameters": {
          "conditions": {
            "conditions": [
              {
                "leftValue": "={{ Math.abs($json.change) }}",
                "rightValue": 3,
                "operator": {
                  "type": "number",
                  "operation": "gte"
                }
              }
            ]
          }
        },
        "id": "significant-change",
        "name": "Big Change?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          1250,
          400
        ]
      },
      {
        "parameters": {
          "channel": "#seo-rankings",
          "text": "={{ $json.change > 0 ? 'ðŸ“ˆ' : 'ðŸ“‰' }} **Rank Change Alert**\n\nKeyword: {{ $json.keyword }}\nPosition: {{ $json.previous_position }} â†’ {{ $json.current_position }} ({{ $json.change > 0 ? '+' : '' }}{{ $json.change }})\nURL: {{ $json.ranking_url }}",
          "otherOptions": {}
        },
        "id": "alert-change",
        "name": "Alert Change",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1500,
          300
        ]
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Rank_History"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "keyword": "={{ $json.keyword }}",
              "position": "={{ $json.current_position }}",
              "change": "={{ $json.change }}",
              "status": "={{ $json.status }}",
              "checked_at": "={{ $json.checked_at }}"
            }
          }
        },
        "id": "save-history",
        "name": "Save History",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          1500,
          500
        ]
      },
      {
        "parameters": {},
        "id": "error-trigger",
        "name": "Error Trigger",
        "type": "n8n-nodes-base.errorTrigger",
        "typeVersion": 1,
        "position": [
          750,
          600
        ]
      },
      {
        "parameters": {
          "channel": "#seo-alerts",
          "text": "=ðŸš¨ Rank Tracker Error\n\nError: {{ $json.execution.error.message }}",
          "otherOptions": {}
        },
        "id": "error-notify",
        "name": "Error Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          1000,
          600
        ]
      }
    ],
    "connections": {
      "Daily Rank Check": {
        "main": [
          [
            {
              "node": "Get Keywords",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Keywords": {
        "main": [
          [
            {
              "node": "Check SERP",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check SERP": {
        "main": [
          [
            {
              "node": "Find Position",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Find Position": {
        "main": [
          [
            {
              "node": "Big Change?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Big Change?": {
        "main": [
          [
            {
              "node": "Alert Change",
              "type": "main",
              "index": 0
            },
            {
              "node": "Save History",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Save History",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Trigger": {
        "main": [
          [
            {
              "node": "Error Alert",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain Webinar Event Automation v1",
    "nodes": [
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "tenant_id",
                "value": "={{ $vars.GRAIN_TENANT_ID || 'default' }}"
              },
              {
                "name": "dry_run",
                "value": "={{ $vars.GRAIN_DRY_RUN || false }}"
              },
              {
                "name": "webhook_prefix",
                "value": "={{ $vars.GRAIN_WEBHOOK_PREFIX || '/webhook' }}/{{ $workflow.name.toLowerCase().replace(/[^a-z0-9]/g, '-') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "grain-config-8ky5v3fq0",
        "name": "GRAIN_CONFIG",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          -200,
          -200
        ],
        "notesInFlow": true,
        "notes": "ðŸ”§ Central Config"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "webinar-register",
          "options": {}
        },
        "id": "webhook-register",
        "name": "Registration",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          250,
          300
        ],
        "webhookId": "webinar-registration"
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "mode": "list",
            "value": ""
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "Registrations"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "email": "={{ $json.email }}",
              "name": "={{ $json.name }}",
              "event": "={{ $json.event_name }}",
              "registered_at": "={{ $now.toISO() }}"
            }
          }
        },
        "id": "save-registration",
        "name": "Save Registration",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.2,
        "position": [
          500,
          300
        ]
      },
      {
        "parameters": {
          "sendTo": "={{ $json.email }}",
          "subject": "KayÄ±t OnaylandÄ±: {{ $json.event_name }}",
          "message": "Merhaba {{ $json.name }},\n\n{{ $json.event_name }} etkinliÄŸine kaydÄ±nÄ±z alÄ±ndÄ±.\n\nTarih: {{ $json.event_date }}\nLink: {{ $json.join_url }}",
          "options": {}
        },
        "id": "confirm-email",
        "name": "Confirmation Email",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          750,
          300
        ]
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "hours",
                "hoursInterval": 24
              }
            ]
          }
        },
        "id": "daily-reminder-check",
        "name": "Daily Reminder Check",
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.1,
        "position": [
          250,
          550
        ]
      },
      {
        "parameters": {
          "jsCode": "// Check for events happening tomorrow\nconst eventDate = new Date($json.event_date);\nconst now = new Date();\nconst hoursUntil = (eventDate - now) / (1000 * 60 * 60);\nif (hoursUntil > 20 && hoursUntil < 28) {\n  return { json: { ...$json, send_reminder: true } };\n}\nreturn [];"
        },
        "id": "calc-reminder",
        "name": "Check Tomorrow Events",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          500,
          550
        ]
      },
      {
        "parameters": {
          "sendTo": "={{ $json.email }}",
          "subject": "â° YarÄ±n: {{ $json.event_name }}",
          "message": "Merhaba {{ $json.name }},\n\nYarÄ±n {{ $json.event_name }} etkinliÄŸimiz var!\n\nKatÄ±lÄ±m Linki: {{ $json.join_url }}",
          "options": {}
        },
        "id": "reminder-email",
        "name": "Reminder Email",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          750,
          550
        ]
      }
    ],
    "connections": {
      "Registration": {
        "main": [
          [
            {
              "node": "Save Registration",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Save Registration": {
        "main": [
          [
            {
              "node": "Confirmation Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Daily Reminder Check": {
        "main": [
          [
            {
              "node": "Check Tomorrow Events",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check Tomorrow Events": {
        "main": [
          [
            {
              "node": "Reminder Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain_Sub_AI_Executor",
    "nodes": [
      {
        "parameters": {
          "content": "## ðŸ§  Sub-workflow: AI Executor\nCentralized handling of AI requests to OpenAI/Anthropic/Ollama.",
          "height": 100,
          "width": 350,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "values": {
            "string": [
              {
                "name": "provider",
                "value": "={{ $json.provider || 'openai' }}"
              },
              {
                "name": "model",
                "value": "={{ $json.model || 'gpt-4o' }}"
              },
              {
                "name": "temperature",
                "value": "={{ $json.temperature || 0.7 }}"
              }
            ]
          },
          "options": {}
        },
        "id": "ai-config",
        "name": "AI Config",
        "type": "n8n-nodes-base.set",
        "typeVersion": 2,
        "position": [
          250,
          400
        ]
      },
      {
        "parameters": {
          "dataType": "string",
          "value1": "={{ $json.provider }}",
          "rules": {
            "rules": [
              {
                "value2": "openai",
                "output": 0
              },
              {
                "value2": "anthropic",
                "output": 1
              },
              {
                "value2": "ollama",
                "output": 2
              }
            ]
          }
        },
        "id": "provider-switch",
        "name": "Provider Switch",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          500,
          400
        ]
      },
      {
        "parameters": {
          "model": "={{ $json.model }}",
          "prompt": "={{ $json.prompt }}",
          "temperature": "={{ $json.temperature }}"
        },
        "id": "openai-call",
        "name": "OpenAI Call",
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1,
        "position": [
          750,
          300
        ]
      },
      {
        "parameters": {
          "jsCode": "return { response: $input.first().json.text, tokens_used: $input.first().json.usage?.total_tokens || 0, provider: $json.provider, timestamp: new Date().toISOString() };"
        },
        "id": "response-normalizer",
        "name": "Response Normalizer",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1000,
          400
        ]
      }
    ],
    "connections": {
      "AI Config": {
        "main": [
          [
            {
              "node": "Provider Switch",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Provider Switch": {
        "main": [
          [
            {
              "node": "OpenAI Call",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Call": {
        "main": [
          [
            {
              "node": "Response Normalizer",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain_Sub_Error_Handler",
    "nodes": [
      {
        "parameters": {
          "content": "## ðŸ›¡ï¸ Sub-workflow: Error Handler\nCentralized error logging and Slack/Email notifications.",
          "height": 100,
          "width": 350,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "rules": {
            "rules": [
              {
                "value2": "RATE_LIMIT",
                "output": 0
              },
              {
                "value2": "AUTH_ERROR",
                "output": 1
              },
              {
                "value2": "TIMEOUT",
                "output": 2
              },
              {
                "value2": "CRITICAL",
                "output": 3
              }
            ]
          }
        },
        "id": "error-classifier",
        "name": "Error Classifier",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          250,
          400
        ]
      },
      {
        "parameters": {
          "amount": 60,
          "unit": "seconds"
        },
        "id": "rate-limit-handler",
        "name": "Rate Limit Wait",
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1,
        "position": [
          500,
          300
        ]
      },
      {
        "parameters": {
          "channel": "={{ $env.SLACK_ALERTS_CHANNEL }}",
          "text": "=ðŸš¨ *Grain Workflow HatasÄ±*\n*Workflow:* {{ $json.workflow.name }}\n*Hata:* {{ $json.error.message }}\n*Zaman:* {{ $now.toISO() }}"
        },
        "id": "slack-alert",
        "name": "Slack Alert",
        "type": "n8n-nodes-base.slack",
        "typeVersion": 2.1,
        "position": [
          750,
          400
        ]
      }
    ],
    "connections": {
      "Error Classifier": {
        "main": [
          [
            {
              "node": "Rate Limit Wait",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Slack Alert",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Slack Alert",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Slack Alert",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    }
  },
  {
    "name": "Grain_Sub_Notification_Hub",
    "nodes": [
      {
        "parameters": {
          "content": "## ðŸ“¢ Sub-workflow: Notification Hub\nMulti-channel router for Slack, Email, WhatsApp, Discord.",
          "height": 100,
          "width": 350,
          "color": 4
        },
        "id": "note-overview",
        "name": "Note: Overview",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          180,
          200
        ]
      },
      {
        "parameters": {
          "rules": {
            "rules": [
              {
                "value2": "slack",
                "output": 0
              },
              {
                "value2": "email",
                "output": 1
              },
              {
                "value2": "whatsapp",
                "output": 2
              },
              {
                "value2": "sms",
                "output": 3
              },
              {
                "value2": "discord",
                "output": 4
              }
            ]
          }
        },
        "id": "channel-router",
        "name": "Channel Router",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          250,
          400
        ]
      }
    ],
    "connections": {}
  }
]